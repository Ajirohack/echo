<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets/app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:114,&quot;tests&quot;:207,&quot;passes&quot;:63,&quot;pending&quot;:3,&quot;failures&quot;:141,&quot;start&quot;:&quot;2025-07-04T23:11:11.402Z&quot;,&quot;end&quot;:&quot;2025-07-04T23:12:47.407Z&quot;,&quot;duration&quot;:96005,&quot;testsRegistered&quot;:263,&quot;passPercent&quot;:24.23076923076923,&quot;pendingPercent&quot;:1.1406844106463878,&quot;other&quot;:9,&quot;hasOther&quot;:true,&quot;skipped&quot;:56,&quot;hasSkipped&quot;:true},&quot;results&quot;:[{&quot;uuid&quot;:&quot;17613102-c48b-4c95-8775-25d691bde4fe&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: beforeEach in \&quot;{root}\&quot;&quot;,&quot;fullTitle&quot;:&quot;\&quot;before each\&quot; hook: beforeEach in \&quot;{root}\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Initialize sinon sandbox for each test\nthis.sandbox = sinon.createSandbox();\n// Make sandbox available globally for tests that need it\nglobal.sandbox = this.sandbox;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e07a4597-8d91-4d80-ab25-dfa1245d5e1b&quot;,&quot;parentUUID&quot;:&quot;17613102-c48b-4c95-8775-25d691bde4fe&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: afterEach in \&quot;{root}\&quot;&quot;,&quot;fullTitle&quot;:&quot;\&quot;after each\&quot; hook: afterEach in \&quot;{root}\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Clean up sandbox after each test\nif (this.sandbox) {\n  this.sandbox.restore();\n}\n// Clean up global sandbox reference\nif (global.sandbox) {\n  delete global.sandbox;\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;10fe1f49-378b-43f0-b7b9-45d930798453&quot;,&quot;parentUUID&quot;:&quot;17613102-c48b-4c95-8775-25d691bde4fe&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1fa908c8-0924-4a02-bb3c-44695c5aa4b0&quot;,&quot;title&quot;:&quot;Visual Regression Tests&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/visual/visual-regression.test.js&quot;,&quot;file&quot;:&quot;/tests/visual/visual-regression.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Visual Regression Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;Visual Regression Tests \&quot;before all\&quot; hook in \&quot;Visual Regression Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1259,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Launch browser\nbrowser = await puppeteer.launch({\n    headless: true, // Run headless for CI\n    args: [&#x27;--no-sandbox&#x27;, &#x27;--disable-setuid-sandbox&#x27;]\n});\n// Create new page\npage = await browser.newPage();\n// Set viewport\nawait page.setViewport({\n    width: 1280,\n    height: 800\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4b6c28c9-9989-4bf7-aa87-f54353b49534&quot;,&quot;parentUUID&quot;:&quot;1fa908c8-0924-4a02-bb3c-44695c5aa4b0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Visual Regression Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;Visual Regression Tests \&quot;after all\&quot; hook in \&quot;Visual Regression Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Close browser\nif (browser) {\n    await browser.close();\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6d0c561a-bdf9-4659-9cc2-c7c9f372c8fa&quot;,&quot;parentUUID&quot;:&quot;1fa908c8-0924-4a02-bb3c-44695c5aa4b0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;38f6e913-c15b-425b-a563-2eb0ef472bc4&quot;,&quot;title&quot;:&quot;Main Interface&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/visual/visual-regression.test.js&quot;,&quot;file&quot;:&quot;/tests/visual/visual-regression.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook for \&quot;should match baseline for initial UI\&quot;&quot;,&quot;fullTitle&quot;:&quot;Visual Regression Tests Main Interface \&quot;before each\&quot; hook for \&quot;should match baseline for initial UI\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6307,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Load application\nconst appPath = path.join(__dirname, &#x27;../../index.html&#x27;);\nawait page.goto(`file://${appPath}`);\n// Wait for app to initialize\nawait page.waitForSelector(&#x27;#app-container&#x27;, { timeout: 5000 });&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TimeoutError: Waiting for selector `#app-container` failed: Waiting failed: 5000ms exceeded&quot;,&quot;estack&quot;:&quot;TimeoutError: Waiting for selector `#app-container` failed: Waiting failed: 5000ms exceeded\n    at new WaitTask (node_modules/puppeteer-core/lib/cjs/puppeteer/common/WaitTask.js:48:34)\n    at IsolatedWorld.waitForFunction (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Realm.js:25:26)\n    at CSSQueryHandler.waitFor (node_modules/puppeteer-core/lib/cjs/puppeteer/common/QueryHandler.js:178:95)\n    at async CdpFrame.waitForSelector (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Frame.js:548:21)\n    at async CdpPage.waitForSelector (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Page.js:1377:20)\n    at async Context.&lt;anonymous&gt; (tests/visual/visual-regression.test.js:129:13)&quot;},&quot;uuid&quot;:&quot;678ae815-eedc-4f6c-9064-e4386ab6265e&quot;,&quot;parentUUID&quot;:&quot;38f6e913-c15b-425b-a563-2eb0ef472bc4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should match baseline for initial UI&quot;,&quot;fullTitle&quot;:&quot;Visual Regression Tests Main Interface should match baseline for initial UI&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Take screenshot\nawait takeScreenshot(&#x27;main-ui&#x27;, &#x27;#app-container&#x27;);\n// Compare with baseline\nconst match = await compareScreenshots(&#x27;main-ui&#x27;);\nexpect(match).to.be.true(&#x27;UI does not match baseline&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6ad4dc9e-096f-4122-976b-433f3531e79e&quot;,&quot;parentUUID&quot;:&quot;38f6e913-c15b-425b-a563-2eb0ef472bc4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should match baseline for language selection dropdown&quot;,&quot;fullTitle&quot;:&quot;Visual Regression Tests Main Interface should match baseline for language selection dropdown&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Open language dropdown\nawait page.click(&#x27;#language-select&#x27;);\n// Wait for dropdown to open\nawait page.waitForSelector(&#x27;.language-dropdown-open&#x27;, { timeout: 2000 });\n// Take screenshot\nawait takeScreenshot(&#x27;language-dropdown&#x27;, &#x27;#language-select-container&#x27;);\n// Compare with baseline\nconst match = await compareScreenshots(&#x27;language-dropdown&#x27;);\nexpect(match).to.be.true(&#x27;Language dropdown does not match baseline&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;acad5d72-4b01-4ca7-933e-9e58039f4405&quot;,&quot;parentUUID&quot;:&quot;38f6e913-c15b-425b-a563-2eb0ef472bc4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;6ad4dc9e-096f-4122-976b-433f3531e79e&quot;,&quot;acad5d72-4b01-4ca7-933e-9e58039f4405&quot;],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:30000},{&quot;uuid&quot;:&quot;33ec3d04-8cf4-48a6-be5a-c1cbc954e509&quot;,&quot;title&quot;:&quot;Translation Process&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/visual/visual-regression.test.js&quot;,&quot;file&quot;:&quot;/tests/visual/visual-regression.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook for \&quot;should match baseline for translation in progress\&quot;&quot;,&quot;fullTitle&quot;:&quot;Visual Regression Tests Translation Process \&quot;before each\&quot; hook for \&quot;should match baseline for translation in progress\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5109,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Load application\nconst appPath = path.join(__dirname, &#x27;../../index.html&#x27;);\nawait page.goto(`file://${appPath}`);\n// Wait for app to initialize\nawait page.waitForSelector(&#x27;#translation-form&#x27;, { timeout: 5000 });&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TimeoutError: Waiting for selector `#translation-form` failed: Waiting failed: 5000ms exceeded&quot;,&quot;estack&quot;:&quot;TimeoutError: Waiting for selector `#translation-form` failed: Waiting failed: 5000ms exceeded\n    at new WaitTask (node_modules/puppeteer-core/lib/cjs/puppeteer/common/WaitTask.js:48:34)\n    at IsolatedWorld.waitForFunction (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Realm.js:25:26)\n    at CSSQueryHandler.waitFor (node_modules/puppeteer-core/lib/cjs/puppeteer/common/QueryHandler.js:178:95)\n    at async CdpFrame.waitForSelector (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Frame.js:548:21)\n    at async CdpPage.waitForSelector (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Page.js:1377:20)\n    at async Context.&lt;anonymous&gt; (tests/visual/visual-regression.test.js:164:13)&quot;},&quot;uuid&quot;:&quot;1b928df5-429e-48a7-bd1f-53a338eff55e&quot;,&quot;parentUUID&quot;:&quot;33ec3d04-8cf4-48a6-be5a-c1cbc954e509&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should match baseline for translation in progress&quot;,&quot;fullTitle&quot;:&quot;Visual Regression Tests Translation Process should match baseline for translation in progress&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Enter text\nawait page.type(&#x27;#input-text&#x27;, &#x27;Hello world&#x27;);\n// Start translation\nawait page.click(&#x27;#translate-button&#x27;);\n// Capture loading state\nawait page.waitForSelector(&#x27;.loading-indicator&#x27;, { timeout: 2000 });\nawait takeScreenshot(&#x27;translation-loading&#x27;, &#x27;#translation-container&#x27;);\n// Compare with baseline\nconst match = await compareScreenshots(&#x27;translation-loading&#x27;);\nexpect(match).to.be.true(&#x27;Translation loading state does not match baseline&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f4e40e95-b418-4ceb-9bb5-87ab078efe6b&quot;,&quot;parentUUID&quot;:&quot;33ec3d04-8cf4-48a6-be5a-c1cbc954e509&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should match baseline for translation results&quot;,&quot;fullTitle&quot;:&quot;Visual Regression Tests Translation Process should match baseline for translation results&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Enter text\nawait page.type(&#x27;#input-text&#x27;, &#x27;Hello world&#x27;);\n// Start translation\nawait page.click(&#x27;#translate-button&#x27;);\n// Wait for results\nawait page.waitForSelector(&#x27;#translation-results:not(.loading)&#x27;, { timeout: 5000 });\n// Let animations complete\nawait new Promise(resolve =&gt; setTimeout(resolve, 500));\n// Take screenshot\nawait takeScreenshot(&#x27;translation-results&#x27;, &#x27;#translation-container&#x27;);\n// Compare with baseline\nconst match = await compareScreenshots(&#x27;translation-results&#x27;);\nexpect(match).to.be.true(&#x27;Translation results do not match baseline&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a6d3a066-58f2-4ad8-9df4-92a8f3b8c9ac&quot;,&quot;parentUUID&quot;:&quot;33ec3d04-8cf4-48a6-be5a-c1cbc954e509&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should match baseline for error state&quot;,&quot;fullTitle&quot;:&quot;Visual Regression Tests Translation Process should match baseline for error state&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Force error state\nawait page.evaluate(() =&gt; {\n    // Mock error in the app\n    window.showTranslationError(&#x27;Translation service unavailable&#x27;);\n});\n// Wait for error display\nawait page.waitForSelector(&#x27;.error-message&#x27;, { timeout: 2000 });\n// Take screenshot\nawait takeScreenshot(&#x27;translation-error&#x27;, &#x27;#translation-container&#x27;);\n// Compare with baseline\nconst match = await compareScreenshots(&#x27;translation-error&#x27;);\nexpect(match).to.be.true(&#x27;Error state does not match baseline&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;72f436c7-0898-4ab2-b29e-a6accae30e8c&quot;,&quot;parentUUID&quot;:&quot;33ec3d04-8cf4-48a6-be5a-c1cbc954e509&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;f4e40e95-b418-4ceb-9bb5-87ab078efe6b&quot;,&quot;a6d3a066-58f2-4ad8-9df4-92a8f3b8c9ac&quot;,&quot;72f436c7-0898-4ab2-b29e-a6accae30e8c&quot;],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:30000},{&quot;uuid&quot;:&quot;be10de1f-a43c-4ef7-a730-dbe101f60d79&quot;,&quot;title&quot;:&quot;Responsive Design&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/visual/visual-regression.test.js&quot;,&quot;file&quot;:&quot;/tests/visual/visual-regression.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should match baseline on mobile viewport&quot;,&quot;fullTitle&quot;:&quot;Visual Regression Tests Responsive Design should match baseline on mobile viewport&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5116,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Set viewport\nawait page.setViewport({\n    width: viewport.width,\n    height: viewport.height\n});\n// Load application\nconst appPath = path.join(__dirname, &#x27;../../index.html&#x27;);\nawait page.goto(`file://${appPath}`);\n// Wait for app to initialize\nawait page.waitForSelector(&#x27;#app-container&#x27;, { timeout: 5000 });\n// Take screenshot\nawait takeScreenshot(`responsive-${viewport.name}`, &#x27;#app-container&#x27;);\n// Compare with baseline\nconst match = await compareScreenshots(`responsive-${viewport.name}`);\nexpect(match).to.be.true(`UI on ${viewport.name} does not match baseline`);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TimeoutError: Waiting for selector `#app-container` failed: Waiting failed: 5000ms exceeded&quot;,&quot;estack&quot;:&quot;TimeoutError: Waiting for selector `#app-container` failed: Waiting failed: 5000ms exceeded\n    at new WaitTask (node_modules/puppeteer-core/lib/cjs/puppeteer/common/WaitTask.js:48:34)\n    at IsolatedWorld.waitForFunction (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Realm.js:25:26)\n    at CSSQueryHandler.waitFor (node_modules/puppeteer-core/lib/cjs/puppeteer/common/QueryHandler.js:178:95)\n    at async CdpFrame.waitForSelector (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Frame.js:548:21)\n    at async CdpPage.waitForSelector (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Page.js:1377:20)\n    at async Context.&lt;anonymous&gt; (tests/visual/visual-regression.test.js:243:17)&quot;},&quot;uuid&quot;:&quot;978fe3cc-9926-457f-a7b1-ef11f43a1582&quot;,&quot;parentUUID&quot;:&quot;be10de1f-a43c-4ef7-a730-dbe101f60d79&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should match baseline on tablet viewport&quot;,&quot;fullTitle&quot;:&quot;Visual Regression Tests Responsive Design should match baseline on tablet viewport&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5117,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Set viewport\nawait page.setViewport({\n    width: viewport.width,\n    height: viewport.height\n});\n// Load application\nconst appPath = path.join(__dirname, &#x27;../../index.html&#x27;);\nawait page.goto(`file://${appPath}`);\n// Wait for app to initialize\nawait page.waitForSelector(&#x27;#app-container&#x27;, { timeout: 5000 });\n// Take screenshot\nawait takeScreenshot(`responsive-${viewport.name}`, &#x27;#app-container&#x27;);\n// Compare with baseline\nconst match = await compareScreenshots(`responsive-${viewport.name}`);\nexpect(match).to.be.true(`UI on ${viewport.name} does not match baseline`);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TimeoutError: Waiting for selector `#app-container` failed: Waiting failed: 5000ms exceeded&quot;,&quot;estack&quot;:&quot;TimeoutError: Waiting for selector `#app-container` failed: Waiting failed: 5000ms exceeded\n    at new WaitTask (node_modules/puppeteer-core/lib/cjs/puppeteer/common/WaitTask.js:48:34)\n    at IsolatedWorld.waitForFunction (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Realm.js:25:26)\n    at CSSQueryHandler.waitFor (node_modules/puppeteer-core/lib/cjs/puppeteer/common/QueryHandler.js:178:95)\n    at async CdpFrame.waitForSelector (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Frame.js:548:21)\n    at async CdpPage.waitForSelector (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Page.js:1377:20)\n    at async Context.&lt;anonymous&gt; (tests/visual/visual-regression.test.js:243:17)&quot;},&quot;uuid&quot;:&quot;baefe0cb-f978-45e3-a3d5-075c417aac63&quot;,&quot;parentUUID&quot;:&quot;be10de1f-a43c-4ef7-a730-dbe101f60d79&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should match baseline on desktop viewport&quot;,&quot;fullTitle&quot;:&quot;Visual Regression Tests Responsive Design should match baseline on desktop viewport&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5130,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Set viewport\nawait page.setViewport({\n    width: viewport.width,\n    height: viewport.height\n});\n// Load application\nconst appPath = path.join(__dirname, &#x27;../../index.html&#x27;);\nawait page.goto(`file://${appPath}`);\n// Wait for app to initialize\nawait page.waitForSelector(&#x27;#app-container&#x27;, { timeout: 5000 });\n// Take screenshot\nawait takeScreenshot(`responsive-${viewport.name}`, &#x27;#app-container&#x27;);\n// Compare with baseline\nconst match = await compareScreenshots(`responsive-${viewport.name}`);\nexpect(match).to.be.true(`UI on ${viewport.name} does not match baseline`);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TimeoutError: Waiting for selector `#app-container` failed: Waiting failed: 5000ms exceeded&quot;,&quot;estack&quot;:&quot;TimeoutError: Waiting for selector `#app-container` failed: Waiting failed: 5000ms exceeded\n    at new WaitTask (node_modules/puppeteer-core/lib/cjs/puppeteer/common/WaitTask.js:48:34)\n    at IsolatedWorld.waitForFunction (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Realm.js:25:26)\n    at CSSQueryHandler.waitFor (node_modules/puppeteer-core/lib/cjs/puppeteer/common/QueryHandler.js:178:95)\n    at async CdpFrame.waitForSelector (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Frame.js:548:21)\n    at async CdpPage.waitForSelector (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Page.js:1377:20)\n    at async Context.&lt;anonymous&gt; (tests/visual/visual-regression.test.js:243:17)&quot;},&quot;uuid&quot;:&quot;622569d4-566c-4420-a4b9-48e4c622a233&quot;,&quot;parentUUID&quot;:&quot;be10de1f-a43c-4ef7-a730-dbe101f60d79&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;978fe3cc-9926-457f-a7b1-ef11f43a1582&quot;,&quot;baefe0cb-f978-45e3-a3d5-075c417aac63&quot;,&quot;622569d4-566c-4420-a4b9-48e4c622a233&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:15363,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:30000},{&quot;uuid&quot;:&quot;697d97d8-aaf5-4f5e-9176-bbd45922e34b&quot;,&quot;title&quot;:&quot;Themes&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/visual/visual-regression.test.js&quot;,&quot;file&quot;:&quot;/tests/visual/visual-regression.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should match baseline with light theme&quot;,&quot;fullTitle&quot;:&quot;Visual Regression Tests Themes should match baseline with light theme&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:246,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Load application\nconst appPath = path.join(__dirname, &#x27;../../index.html&#x27;);\nawait page.goto(`file://${appPath}`);\n// Wait for app to initialize\nawait page.waitForSelector(&#x27;#app-container&#x27;, { timeout: 5000 });\n// Set theme\nawait page.evaluate((themeName) =&gt; {\n    document.body.setAttribute(&#x27;data-theme&#x27;, themeName);\n}, theme);\n// Let theme change settle\nawait new Promise(resolve =&gt; setTimeout(resolve, 500));\n// Take screenshot\nawait takeScreenshot(`theme-${theme}`, &#x27;#app-container&#x27;);\n// Compare with baseline\nconst match = await compareScreenshots(`theme-${theme}`);\nexpect(match).to.be.true(`${theme} theme does not match baseline`);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Waiting for selector `#app-container` failed: waitForFunction failed: frame got detached.&quot;,&quot;estack&quot;:&quot;Error: Waiting for selector `#app-container` failed: waitForFunction failed: frame got detached.\n    at IsolatedWorld.dispose (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Realm.js:40:39)\n    at [nodejs.dispose] (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Realm.js:44:14)\n    at [nodejs.dispose] (node_modules/puppeteer-core/lib/cjs/puppeteer/cdp/IsolatedWorld.js:156:45)\n    at [nodejs.dispose] (node_modules/puppeteer-core/lib/cjs/puppeteer/cdp/Frame.js:331:92)\n    at #removeFramesRecursively (node_modules/puppeteer-core/lib/cjs/puppeteer/cdp/FrameManager.js:452:45)\n    at #onClientDisconnect (node_modules/puppeteer-core/lib/cjs/puppeteer/cdp/FrameManager.js:82:42)\n    at /Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/node_modules/puppeteer-core/lib/cjs/puppeteer/cdp/FrameManager.js:66:37\n    at onceHandler (node_modules/puppeteer-core/lib/cjs/puppeteer/common/EventEmitter.js:94:13)\n    at /Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/node_modules/puppeteer-core/lib/cjs/third_party/mitt/mitt.js:62:7\n    at Array.map (&lt;anonymous&gt;)\n    at Object.emit (node_modules/puppeteer-core/lib/cjs/third_party/mitt/mitt.js:61:20)\n    at CdpCDPSession.emit (node_modules/puppeteer-core/lib/cjs/puppeteer/common/EventEmitter.js:83:23)\n    at CdpCDPSession.onClosed (node_modules/puppeteer-core/lib/cjs/puppeteer/cdp/CdpSession.js:116:14)\n    at #onClose (node_modules/puppeteer-core/lib/cjs/puppeteer/cdp/Connection.js:181:21)\n    at WebSocket.&lt;anonymous&gt; (node_modules/puppeteer-core/lib/cjs/puppeteer/node/NodeWebSocketTransport.js:48:30)\n    at callListener (node_modules/ws/lib/event-target.js:290:14)\n    at WebSocket.onClose (node_modules/ws/lib/event-target.js:220:9)\n    at WebSocket.emit (node:events:518:28)\n    at WebSocket.emitClose (node_modules/ws/lib/websocket.js:272:10)\n    at Socket.socketOnClose (node_modules/ws/lib/websocket.js:1341:15)\n    at Socket.emit (node:events:518:28)\n    at TCP.&lt;anonymous&gt; (node:net:351:12)&quot;},&quot;uuid&quot;:&quot;f0e33071-0f2a-45b9-9533-e0c2251ef1c8&quot;,&quot;parentUUID&quot;:&quot;697d97d8-aaf5-4f5e-9176-bbd45922e34b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should match baseline with dark theme&quot;,&quot;fullTitle&quot;:&quot;Visual Regression Tests Themes should match baseline with dark theme&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Load application\nconst appPath = path.join(__dirname, &#x27;../../index.html&#x27;);\nawait page.goto(`file://${appPath}`);\n// Wait for app to initialize\nawait page.waitForSelector(&#x27;#app-container&#x27;, { timeout: 5000 });\n// Set theme\nawait page.evaluate((themeName) =&gt; {\n    document.body.setAttribute(&#x27;data-theme&#x27;, themeName);\n}, theme);\n// Let theme change settle\nawait new Promise(resolve =&gt; setTimeout(resolve, 500));\n// Take screenshot\nawait takeScreenshot(`theme-${theme}`, &#x27;#app-container&#x27;);\n// Compare with baseline\nconst match = await compareScreenshots(`theme-${theme}`);\nexpect(match).to.be.true(`${theme} theme does not match baseline`);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Attempted to use detached Frame &#x27;79B6A68E9402EF901EBD86A412EEC698&#x27;.&quot;,&quot;estack&quot;:&quot;Error: Attempted to use detached Frame &#x27;79B6A68E9402EF901EBD86A412EEC698&#x27;.\n    at CdpFrame.&lt;anonymous&gt; (node_modules/puppeteer-core/lib/cjs/puppeteer/util/decorators.js:107:23)\n    at CdpPage.goto (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Page.js:574:43)\n    at Context.&lt;anonymous&gt; (tests/visual/visual-regression.test.js:262:28)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;425b838f-75ed-4bc1-8892-53bf0483f92c&quot;,&quot;parentUUID&quot;:&quot;697d97d8-aaf5-4f5e-9176-bbd45922e34b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should match baseline with high-contrast theme&quot;,&quot;fullTitle&quot;:&quot;Visual Regression Tests Themes should match baseline with high-contrast theme&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Load application\nconst appPath = path.join(__dirname, &#x27;../../index.html&#x27;);\nawait page.goto(`file://${appPath}`);\n// Wait for app to initialize\nawait page.waitForSelector(&#x27;#app-container&#x27;, { timeout: 5000 });\n// Set theme\nawait page.evaluate((themeName) =&gt; {\n    document.body.setAttribute(&#x27;data-theme&#x27;, themeName);\n}, theme);\n// Let theme change settle\nawait new Promise(resolve =&gt; setTimeout(resolve, 500));\n// Take screenshot\nawait takeScreenshot(`theme-${theme}`, &#x27;#app-container&#x27;);\n// Compare with baseline\nconst match = await compareScreenshots(`theme-${theme}`);\nexpect(match).to.be.true(`${theme} theme does not match baseline`);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Attempted to use detached Frame &#x27;79B6A68E9402EF901EBD86A412EEC698&#x27;.&quot;,&quot;estack&quot;:&quot;Error: Attempted to use detached Frame &#x27;79B6A68E9402EF901EBD86A412EEC698&#x27;.\n    at CdpFrame.&lt;anonymous&gt; (node_modules/puppeteer-core/lib/cjs/puppeteer/util/decorators.js:107:23)\n    at CdpPage.goto (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Page.js:574:43)\n    at Context.&lt;anonymous&gt; (tests/visual/visual-regression.test.js:262:28)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;a6c52126-adb5-4e57-973a-91c74ee57b8f&quot;,&quot;parentUUID&quot;:&quot;697d97d8-aaf5-4f5e-9176-bbd45922e34b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;f0e33071-0f2a-45b9-9533-e0c2251ef1c8&quot;,&quot;425b838f-75ed-4bc1-8892-53bf0483f92c&quot;,&quot;a6c52126-adb5-4e57-973a-91c74ee57b8f&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:247,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:30000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:30000},{&quot;uuid&quot;:&quot;b7369f35-3366-404b-bba3-70dd4e25a426&quot;,&quot;title&quot;:&quot;Accessibility Tests&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/accessibility/ui-accessibility.test.js&quot;,&quot;file&quot;:&quot;/tests/accessibility/ui-accessibility.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Accessibility Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;Accessibility Tests \&quot;before all\&quot; hook in \&quot;Accessibility Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1011,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Launch browser\nbrowser = await puppeteer.launch({\n    headless: true, // Run headless for CI\n    args: [&#x27;--no-sandbox&#x27;, &#x27;--disable-setuid-sandbox&#x27;]\n});\n// Create new page\npage = await browser.newPage();\n// Set viewport\nawait page.setViewport({\n    width: 1280,\n    height: 800\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;47b5890d-2e81-42de-9ad3-f4e214782f32&quot;,&quot;parentUUID&quot;:&quot;b7369f35-3366-404b-bba3-70dd4e25a426&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Accessibility Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;Accessibility Tests \&quot;after all\&quot; hook in \&quot;Accessibility Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:239,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Close browser\nif (browser) {\n    await browser.close();\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;10899e9d-e488-4c5b-bd85-f27d8ccba1ad&quot;,&quot;parentUUID&quot;:&quot;b7369f35-3366-404b-bba3-70dd4e25a426&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b9ea9e6a-f67c-4a88-b214-43ab6c1f8dec&quot;,&quot;title&quot;:&quot;Main Interface&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/accessibility/ui-accessibility.test.js&quot;,&quot;file&quot;:&quot;/tests/accessibility/ui-accessibility.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook for \&quot;should have no critical accessibility violations\&quot;&quot;,&quot;fullTitle&quot;:&quot;Accessibility Tests Main Interface \&quot;before each\&quot; hook for \&quot;should have no critical accessibility violations\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6109,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Load application\n// For local testing, use the file:// protocol to load the app directly\nconst appPath = path.join(__dirname, &#x27;../../index.html&#x27;);\nawait page.goto(`file://${appPath}`);\n// Wait for app to initialize\nawait page.waitForSelector(&#x27;#app-container&#x27;, { timeout: 5000 });&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TimeoutError: Waiting for selector `#app-container` failed: Waiting failed: 5000ms exceeded&quot;,&quot;estack&quot;:&quot;TimeoutError: Waiting for selector `#app-container` failed: Waiting failed: 5000ms exceeded\n    at new WaitTask (node_modules/puppeteer-core/lib/cjs/puppeteer/common/WaitTask.js:48:34)\n    at IsolatedWorld.waitForFunction (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Realm.js:25:26)\n    at CSSQueryHandler.waitFor (node_modules/puppeteer-core/lib/cjs/puppeteer/common/QueryHandler.js:178:95)\n    at async CdpFrame.waitForSelector (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Frame.js:548:21)\n    at async CdpPage.waitForSelector (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Page.js:1377:20)\n    at async Context.&lt;anonymous&gt; (tests/accessibility/ui-accessibility.test.js:68:13)&quot;},&quot;uuid&quot;:&quot;ea76cf52-a7bf-4bbe-8a08-61df940e7bed&quot;,&quot;parentUUID&quot;:&quot;b9ea9e6a-f67c-4a88-b214-43ab6c1f8dec&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should have no critical accessibility violations&quot;,&quot;fullTitle&quot;:&quot;Accessibility Tests Main Interface should have no critical accessibility violations&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Run accessibility analysis\nconst results = await analyzeAccessibility(page);\n// Log violations for debugging\nif (results.violations.length &gt; 0) {\n    console.log(&#x27;Accessibility violations:&#x27;, JSON.stringify(results.violations, null, 2));\n}\n// Filter for critical violations only\nconst criticalViolations = results.violations.filter(v =&gt; v.impact === &#x27;critical&#x27;);\n// Should have no critical violations\nexpect(criticalViolations.length).to.equal(0, &#x27;Critical accessibility violations found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fc63419b-774c-4e90-a5cc-eeb40f8beb24&quot;,&quot;parentUUID&quot;:&quot;b9ea9e6a-f67c-4a88-b214-43ab6c1f8dec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should have appropriate ARIA attributes&quot;,&quot;fullTitle&quot;:&quot;Accessibility Tests Main Interface should have appropriate ARIA attributes&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Run accessibility analysis focused on ARIA\nconst results = await analyzeAccessibility(page, {\n    rules: {\n        &#x27;aria-*&#x27;: { enabled: true }\n    }\n});\n// Check ARIA violations\nconst ariaViolations = results.violations.filter(v =&gt; v.id.startsWith(&#x27;aria-&#x27;));\n// Should have no ARIA violations\nexpect(ariaViolations.length).to.equal(0, &#x27;ARIA violations found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e4f6ee97-071a-437d-a1c3-ebcd4269eb58&quot;,&quot;parentUUID&quot;:&quot;b9ea9e6a-f67c-4a88-b214-43ab6c1f8dec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should have sufficient color contrast&quot;,&quot;fullTitle&quot;:&quot;Accessibility Tests Main Interface should have sufficient color contrast&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Run accessibility analysis focused on color contrast\nconst results = await analyzeAccessibility(page, {\n    rules: {\n        &#x27;color-contrast&#x27;: { enabled: true }\n    }\n});\n// Check color contrast violations\nconst contrastViolations = results.violations.filter(v =&gt; v.id === &#x27;color-contrast&#x27;);\n// Should have no contrast violations\nexpect(contrastViolations.length).to.equal(0, &#x27;Color contrast issues found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6542cb2f-9d2f-41ae-bcc3-1cf8e81f8254&quot;,&quot;parentUUID&quot;:&quot;b9ea9e6a-f67c-4a88-b214-43ab6c1f8dec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;fc63419b-774c-4e90-a5cc-eeb40f8beb24&quot;,&quot;e4f6ee97-071a-437d-a1c3-ebcd4269eb58&quot;,&quot;6542cb2f-9d2f-41ae-bcc3-1cf8e81f8254&quot;],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;1e0b3f96-3357-4547-b772-b535e2b00e5f&quot;,&quot;title&quot;:&quot;Translation Form&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/accessibility/ui-accessibility.test.js&quot;,&quot;file&quot;:&quot;/tests/accessibility/ui-accessibility.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook for \&quot;should have accessible form controls\&quot;&quot;,&quot;fullTitle&quot;:&quot;Accessibility Tests Translation Form \&quot;before each\&quot; hook for \&quot;should have accessible form controls\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5122,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Load application\nconst appPath = path.join(__dirname, &#x27;../../index.html&#x27;);\nawait page.goto(`file://${appPath}`);\n// Wait for app to initialize\nawait page.waitForSelector(&#x27;#translation-form&#x27;, { timeout: 5000 });&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TimeoutError: Waiting for selector `#translation-form` failed: Waiting failed: 5000ms exceeded&quot;,&quot;estack&quot;:&quot;TimeoutError: Waiting for selector `#translation-form` failed: Waiting failed: 5000ms exceeded\n    at new WaitTask (node_modules/puppeteer-core/lib/cjs/puppeteer/common/WaitTask.js:48:34)\n    at IsolatedWorld.waitForFunction (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Realm.js:25:26)\n    at CSSQueryHandler.waitFor (node_modules/puppeteer-core/lib/cjs/puppeteer/common/QueryHandler.js:178:95)\n    at async CdpFrame.waitForSelector (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Frame.js:548:21)\n    at async CdpPage.waitForSelector (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Page.js:1377:20)\n    at async Context.&lt;anonymous&gt; (tests/accessibility/ui-accessibility.test.js:125:13)&quot;},&quot;uuid&quot;:&quot;9ca3c478-bd66-4119-8bd7-47cc6e1d26dd&quot;,&quot;parentUUID&quot;:&quot;1e0b3f96-3357-4547-b772-b535e2b00e5f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should have accessible form controls&quot;,&quot;fullTitle&quot;:&quot;Accessibility Tests Translation Form should have accessible form controls&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Find all form controls\nconst formControls = await page.$$eval(&#x27;input, select, textarea, button&#x27;, elements =&gt; {\n    return elements.map(el =&gt; ({\n        type: el.tagName.toLowerCase(),\n        id: el.id,\n        hasLabel: !!el.labels &amp;&amp; el.labels.length &gt; 0,\n        hasAriaLabel: !!el.getAttribute(&#x27;aria-label&#x27;),\n        hasAriaLabelledBy: !!el.getAttribute(&#x27;aria-labelledby&#x27;)\n    }));\n});\n// Check that all form controls have accessible labels\nfor (const control of formControls) {\n    const hasAccessibleLabel = control.hasLabel ||\n        control.hasAriaLabel ||\n        control.hasAriaLabelledBy;\n    expect(hasAccessibleLabel).to.be.true(\n        `Form control ${control.type}#${control.id} has no accessible label`\n    );\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b6c4e391-f765-4904-8b12-88cb995660f5&quot;,&quot;parentUUID&quot;:&quot;1e0b3f96-3357-4547-b772-b535e2b00e5f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should be keyboard navigable&quot;,&quot;fullTitle&quot;:&quot;Accessibility Tests Translation Form should be keyboard navigable&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Ensure focusable elements can be tabbed through\nawait page.keyboard.press(&#x27;Tab&#x27;);\n// Get the active element\nlet activeElementCount = 0;\n// Press tab multiple times and count unique focused elements\nconst focusedElements = new Set();\nfor (let i = 0; i &lt; 10; i++) {\n    const focusedElement = await page.evaluate(() =&gt; {\n        const active = document.activeElement;\n        return active ? active.tagName + (active.id ? &#x27;#&#x27; + active.id : &#x27;&#x27;) : null;\n    });\n    if (focusedElement &amp;&amp; focusedElement !== &#x27;BODY&#x27;) {\n        focusedElements.add(focusedElement);\n    }\n    await page.keyboard.press(&#x27;Tab&#x27;);\n}\n// Should have focused several elements\nexpect(focusedElements.size).to.be.greaterThan(3, &#x27;Not enough focusable elements found&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;64bb6603-c80a-46f1-8f05-8697b56717b8&quot;,&quot;parentUUID&quot;:&quot;1e0b3f96-3357-4547-b772-b535e2b00e5f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;b6c4e391-f765-4904-8b12-88cb995660f5&quot;,&quot;64bb6603-c80a-46f1-8f05-8697b56717b8&quot;],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;ea9e7c31-09c4-4100-92a7-0ab1a56570a2&quot;,&quot;title&quot;:&quot;Results Display&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/accessibility/ui-accessibility.test.js&quot;,&quot;file&quot;:&quot;/tests/accessibility/ui-accessibility.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook for \&quot;should have screen reader accessible results\&quot;&quot;,&quot;fullTitle&quot;:&quot;Accessibility Tests Results Display \&quot;before each\&quot; hook for \&quot;should have screen reader accessible results\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5143,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Load application\nconst appPath = path.join(__dirname, &#x27;../../index.html&#x27;);\nawait page.goto(`file://${appPath}`);\n// Wait for app to initialize\nawait page.waitForSelector(&#x27;#translation-form&#x27;, { timeout: 5000 });\n// Trigger a translation\nawait page.type(&#x27;#input-text&#x27;, &#x27;Hello world&#x27;);\nawait page.click(&#x27;#translate-button&#x27;);\n// Wait for results\nawait page.waitForSelector(&#x27;#translation-results&#x27;, { timeout: 5000 });&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TimeoutError: Waiting for selector `#translation-form` failed: Waiting failed: 5000ms exceeded&quot;,&quot;estack&quot;:&quot;TimeoutError: Waiting for selector `#translation-form` failed: Waiting failed: 5000ms exceeded\n    at new WaitTask (node_modules/puppeteer-core/lib/cjs/puppeteer/common/WaitTask.js:48:34)\n    at IsolatedWorld.waitForFunction (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Realm.js:25:26)\n    at CSSQueryHandler.waitFor (node_modules/puppeteer-core/lib/cjs/puppeteer/common/QueryHandler.js:178:95)\n    at async CdpFrame.waitForSelector (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Frame.js:548:21)\n    at async CdpPage.waitForSelector (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Page.js:1377:20)\n    at async Context.&lt;anonymous&gt; (tests/accessibility/ui-accessibility.test.js:187:13)&quot;},&quot;uuid&quot;:&quot;871d32e7-42f4-4290-84fa-f3aa6774c3b0&quot;,&quot;parentUUID&quot;:&quot;ea9e7c31-09c4-4100-92a7-0ab1a56570a2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should have screen reader accessible results&quot;,&quot;fullTitle&quot;:&quot;Accessibility Tests Results Display should have screen reader accessible results&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Check for appropriate ARIA roles\nconst hasAriaLive = await page.$eval(&#x27;#translation-results&#x27;, el =&gt; {\n    return el.getAttribute(&#x27;aria-live&#x27;) === &#x27;polite&#x27;;\n});\nexpect(hasAriaLive).to.be.true(&#x27;Translation results should have aria-live attribute&#x27;);\n// Check for appropriate heading structure\nconst headingsStructure = await page.$$eval(&#x27;h1, h2, h3, h4, h5, h6&#x27;, headings =&gt; {\n    return headings.map(h =&gt; ({\n        level: parseInt(h.tagName.substring(1)),\n        text: h.textContent\n    }));\n});\n// Should have logical heading structure\nlet previousLevel = 0;\nlet headingLevelsValid = true;\nfor (const heading of headingsStructure) {\n    if (previousLevel &gt; 0 &amp;&amp; heading.level &gt; previousLevel + 1) {\n        headingLevelsValid = false;\n        break;\n    }\n    previousLevel = heading.level;\n}\nexpect(headingLevelsValid).to.be.true(&#x27;Heading structure should not skip levels&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;51538b0b-ad19-42c0-b3fa-74ba74cc51bd&quot;,&quot;parentUUID&quot;:&quot;ea9e7c31-09c4-4100-92a7-0ab1a56570a2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;51538b0b-ad19-42c0-b3fa-74ba74cc51bd&quot;],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;f9d9d597-b5f9-412e-8a4d-9053749fbef9&quot;,&quot;title&quot;:&quot;Responsive Design&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/accessibility/ui-accessibility.test.js&quot;,&quot;file&quot;:&quot;/tests/accessibility/ui-accessibility.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should be accessible on mobile viewport&quot;,&quot;fullTitle&quot;:&quot;Accessibility Tests Responsive Design should be accessible on mobile viewport&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5283,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Set mobile viewport\nawait page.setViewport({\n    width: 375,\n    height: 667,\n    isMobile: true\n});\n// Load application\nconst appPath = path.join(__dirname, &#x27;../../index.html&#x27;);\nawait page.goto(`file://${appPath}`);\n// Wait for app to initialize\nawait page.waitForSelector(&#x27;#app-container&#x27;, { timeout: 5000 });\n// Run accessibility analysis\nconst results = await analyzeAccessibility(page);\n// Should have no critical violations\nconst criticalViolations = results.violations.filter(v =&gt; v.impact === &#x27;critical&#x27;);\nexpect(criticalViolations.length).to.equal(0, &#x27;Critical accessibility violations found on mobile viewport&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TimeoutError: Waiting for selector `#app-container` failed: Waiting failed: 5000ms exceeded&quot;,&quot;estack&quot;:&quot;TimeoutError: Waiting for selector `#app-container` failed: Waiting failed: 5000ms exceeded\n    at new WaitTask (node_modules/puppeteer-core/lib/cjs/puppeteer/common/WaitTask.js:48:34)\n    at IsolatedWorld.waitForFunction (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Realm.js:25:26)\n    at CSSQueryHandler.waitFor (node_modules/puppeteer-core/lib/cjs/puppeteer/common/QueryHandler.js:178:95)\n    at async CdpFrame.waitForSelector (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Frame.js:548:21)\n    at async CdpPage.waitForSelector (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Page.js:1377:20)\n    at async Context.&lt;anonymous&gt; (tests/accessibility/ui-accessibility.test.js:243:13)&quot;},&quot;uuid&quot;:&quot;8fc522d9-35b8-46a2-a134-32cd8017efd8&quot;,&quot;parentUUID&quot;:&quot;f9d9d597-b5f9-412e-8a4d-9053749fbef9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should maintain touch target sizes on mobile&quot;,&quot;fullTitle&quot;:&quot;Accessibility Tests Responsive Design should maintain touch target sizes on mobile&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5111,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Set mobile viewport\nawait page.setViewport({\n    width: 375,\n    height: 667,\n    isMobile: true\n});\n// Load application\nconst appPath = path.join(__dirname, &#x27;../../index.html&#x27;);\nawait page.goto(`file://${appPath}`);\n// Wait for app to initialize\nawait page.waitForSelector(&#x27;#translation-form&#x27;, { timeout: 5000 });\n// Measure size of touch targets\nconst touchTargetSizes = await page.$$eval(&#x27;button, a, input, select&#x27;, elements =&gt; {\n    return elements.map(el =&gt; {\n        const rect = el.getBoundingClientRect();\n        return {\n            tag: el.tagName.toLowerCase(),\n            id: el.id,\n            width: rect.width,\n            height: rect.height\n        };\n    });\n});\n// WCAG 2.1 recommends touch targets of at least 44x44px\nconst minWidth = 44;\nconst minHeight = 44;\n// Filter for small touch targets\nconst smallTouchTargets = touchTargetSizes.filter(\n    target =&gt; target.width &lt; minWidth || target.height &lt; minHeight\n);\n// Allow some exemptions for specific types of controls\nconst exemptTypes = [&#x27;hidden&#x27;];\nconst nonExemptSmallTargets = smallTouchTargets.filter(\n    target =&gt; !exemptTypes.includes(target.tag)\n);\nexpect(nonExemptSmallTargets.length).to.equal(0, &#x27;Touch targets too small for mobile&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TimeoutError: Waiting for selector `#translation-form` failed: Waiting failed: 5000ms exceeded&quot;,&quot;estack&quot;:&quot;TimeoutError: Waiting for selector `#translation-form` failed: Waiting failed: 5000ms exceeded\n    at new WaitTask (node_modules/puppeteer-core/lib/cjs/puppeteer/common/WaitTask.js:48:34)\n    at IsolatedWorld.waitForFunction (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Realm.js:25:26)\n    at CSSQueryHandler.waitFor (node_modules/puppeteer-core/lib/cjs/puppeteer/common/QueryHandler.js:178:95)\n    at async CdpFrame.waitForSelector (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Frame.js:548:21)\n    at async CdpPage.waitForSelector (node_modules/puppeteer-core/lib/cjs/puppeteer/api/Page.js:1377:20)\n    at async Context.&lt;anonymous&gt; (tests/accessibility/ui-accessibility.test.js:266:13)&quot;},&quot;uuid&quot;:&quot;058c7406-b8c4-4026-bfb3-eff05f501a64&quot;,&quot;parentUUID&quot;:&quot;f9d9d597-b5f9-412e-8a4d-9053749fbef9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;8fc522d9-35b8-46a2-a134-32cd8017efd8&quot;,&quot;058c7406-b8c4-4026-bfb3-eff05f501a64&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:10394,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;87d08d90-2197-4abe-bb2b-08b158a92812&quot;,&quot;title&quot;:&quot;Azure Translator API Tests&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/api/azure-api.test.js&quot;,&quot;file&quot;:&quot;/tests/api/azure-api.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Azure Translator API Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;Azure Translator API Tests \&quot;before each\&quot; hook in \&quot;Azure Translator API Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Disable real HTTP requests\nnock.disableNetConnect();\nsandbox = sinon.createSandbox();\n// Create service with test credentials\ntranslator = new AzureTranslator({\n    apiKey: &#x27;test-api-key&#x27;,\n    endpoint: &#x27;https://api.cognitive.microsofttranslator.com&#x27;,\n    region: &#x27;eastus&#x27;\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;dbc38377-7465-4ba4-99ad-077b4824a708&quot;,&quot;parentUUID&quot;:&quot;87d08d90-2197-4abe-bb2b-08b158a92812&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Azure Translator API Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;Azure Translator API Tests \&quot;after each\&quot; hook in \&quot;Azure Translator API Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.restore();\nnock.cleanAll();\nnock.enableNetConnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;09cea7fa-f729-4348-8b52-8a31a8df2c94&quot;,&quot;parentUUID&quot;:&quot;87d08d90-2197-4abe-bb2b-08b158a92812&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;52df9332-4583-47ad-930b-2f6b04f97e02&quot;,&quot;title&quot;:&quot;Translation API&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/api/azure-api.test.js&quot;,&quot;file&quot;:&quot;/tests/api/azure-api.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should make correct API calls to translate text&quot;,&quot;fullTitle&quot;:&quot;Azure Translator API Tests Translation API should make correct API calls to translate text&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Set up mock API response\nnock(&#x27;https://api.cognitive.microsofttranslator.com&#x27;)\n    .post(&#x27;/translate&#x27;)\n    .query(q =&gt; q.to === &#x27;es&#x27; &amp;&amp; q[&#x27;api-version&#x27;] === &#x27;3.0&#x27;)\n    .reply(200, [\n        {\n            detectedLanguage: {\n                language: &#x27;en&#x27;,\n                score: 0.91\n            },\n            translations: [\n                {\n                    text: &#x27;Hola mundo&#x27;,\n                    to: &#x27;es&#x27;\n                }\n            ]\n        }\n    ]);\n// Mock UUID generation for deterministic testing\nsandbox.stub(require(&#x27;uuid&#x27;), &#x27;v4&#x27;).returns(&#x27;test-uuid&#x27;);\n// Initialize translator\nawait translator.initialize();\n// Call translation method\nconst result = await translator.translate(&#x27;Hello world&#x27;, &#x27;en&#x27;, &#x27;es&#x27;);\nexpect(result.translation).to.equal(&#x27;Hola mundo&#x27;);\nexpect(result.service).to.equal(&#x27;azure&#x27;);\nexpect(result.detectedLanguage).to.equal(&#x27;en&#x27;);\n// Verify all nock mocks were called\nexpect(nock.isDone()).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Descriptor for property v4 is non-configurable and non-writable&quot;,&quot;estack&quot;:&quot;TypeError: Descriptor for property v4 is non-configurable and non-writable\n    at assertValidPropertyDescriptor (node_modules/sinon/lib/sinon/stub.js:138:15)\n    at Function.stub (node_modules/sinon/lib/sinon/stub.js:89:5)\n    at Sandbox.stub (node_modules/sinon/lib/sinon/sandbox.js:389:39)\n    at Context.&lt;anonymous&gt; (tests/api/azure-api.test.js:55:21)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;45530a6e-1fa1-4e9b-9b15-124ae1b6d138&quot;,&quot;parentUUID&quot;:&quot;52df9332-4583-47ad-930b-2f6b04f97e02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle API errors correctly&quot;,&quot;fullTitle&quot;:&quot;Azure Translator API Tests Translation API should handle API errors correctly&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Set up mock API error response\nnock(&#x27;https://api.cognitive.microsofttranslator.com&#x27;)\n    .post(&#x27;/translate&#x27;)\n    .query(true)\n    .reply(401, {\n        error: {\n            code: 401000,\n            message: &#x27;The request is not authorized because credentials are missing or invalid.&#x27;\n        }\n    });\n// Initialize translator\nawait translator.initialize();\n// Call translation method\ntry {\n    await translator.translate(&#x27;Hello world&#x27;, &#x27;en&#x27;, &#x27;es&#x27;);\n    expect.fail(&#x27;Should have thrown an error&#x27;);\n} catch (error) {\n    expect(error.message).to.include(&#x27;credentials are missing or invalid&#x27;);\n}\n// Verify all nock mocks were called\nexpect(nock.isDone()).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Azure Translator connection test failed: Azure Translator error: The request is not authorized because credentials are missing or invalid.&quot;,&quot;estack&quot;:&quot;Error: Azure Translator connection test failed: Azure Translator error: The request is not authorized because credentials are missing or invalid.\n    at AzureTranslator.testConnection (src/services/translation/azure-translator.js:79:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async AzureTranslator.initialize (src/services/translation/azure-translator.js:51:13)\n    at async Context.&lt;anonymous&gt; (tests/api/azure-api.test.js:84:13)&quot;},&quot;uuid&quot;:&quot;91a0ff9a-0220-4517-bede-d81f25c98b11&quot;,&quot;parentUUID&quot;:&quot;52df9332-4583-47ad-930b-2f6b04f97e02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle network errors gracefully&quot;,&quot;fullTitle&quot;:&quot;Azure Translator API Tests Translation API should handle network errors gracefully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Set up mock network error\nnock(&#x27;https://api.cognitive.microsofttranslator.com&#x27;)\n    .post(&#x27;/translate&#x27;)\n    .query(true)\n    .replyWithError(&#x27;Connection refused&#x27;);\n// Initialize translator\nawait translator.initialize();\n// Call translation method\ntry {\n    await translator.translate(&#x27;Hello world&#x27;, &#x27;en&#x27;, &#x27;es&#x27;);\n    expect.fail(&#x27;Should have thrown an error&#x27;);\n} catch (error) {\n    expect(error.message).to.include(&#x27;Connection refused&#x27;);\n}\n// Verify all nock mocks were called\nexpect(nock.isDone()).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Azure Translator connection test failed: Azure Translator error: Connection refused&quot;,&quot;estack&quot;:&quot;Error: Azure Translator connection test failed: Azure Translator error: Connection refused\n    at AzureTranslator.testConnection (src/services/translation/azure-translator.js:79:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async AzureTranslator.initialize (src/services/translation/azure-translator.js:51:13)\n    at async Context.&lt;anonymous&gt; (tests/api/azure-api.test.js:106:13)&quot;},&quot;uuid&quot;:&quot;cd653114-f2d3-4b5d-ac30-d3b1111c0d2e&quot;,&quot;parentUUID&quot;:&quot;52df9332-4583-47ad-930b-2f6b04f97e02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;45530a6e-1fa1-4e9b-9b15-124ae1b6d138&quot;,&quot;91a0ff9a-0220-4517-bede-d81f25c98b11&quot;,&quot;cd653114-f2d3-4b5d-ac30-d3b1111c0d2e&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:18,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;1d7ef47b-191a-4faa-8231-46379f9e6ffc&quot;,&quot;title&quot;:&quot;Language Detection API&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/api/azure-api.test.js&quot;,&quot;file&quot;:&quot;/tests/api/azure-api.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should detect language correctly&quot;,&quot;fullTitle&quot;:&quot;Azure Translator API Tests Language Detection API should detect language correctly&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Set up mock API response\nnock(&#x27;https://api.cognitive.microsofttranslator.com&#x27;)\n    .post(&#x27;/detect&#x27;)\n    .query(q =&gt; q[&#x27;api-version&#x27;] === &#x27;3.0&#x27;)\n    .reply(200, [\n        {\n            language: &#x27;fr&#x27;,\n            score: 0.95,\n            isTranslationSupported: true,\n            isTransliterationSupported: false\n        }\n    ]);\n// Initialize translator\nawait translator.initialize();\n// Call detection method\nconst result = await translator.detectLanguage(&#x27;Bonjour le monde&#x27;);\nexpect(result.language).to.equal(&#x27;fr&#x27;);\nexpect(result.confidence).to.equal(0.95);\nexpect(result.isTranslationSupported).to.be.true;\n// Verify all nock mocks were called\nexpect(nock.isDone()).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Azure Translator connection test failed: Azure Translator error: Nock: No match for request {\n  \&quot;method\&quot;: \&quot;POST\&quot;,\n  \&quot;url\&quot;: \&quot;https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&amp;to=es&amp;category=general&amp;profanityAction=NoAction&amp;includeAlignment=false&amp;includeSentenceLength=false&amp;textType=plain&amp;from=en\&quot;,\n  \&quot;headers\&quot;: {\n    \&quot;accept\&quot;: \&quot;application/json, text/plain, */*\&quot;,\n    \&quot;content-type\&quot;: \&quot;application/json\&quot;,\n    \&quot;ocp-apim-subscription-key\&quot;: \&quot;test-api-key\&quot;,\n    \&quot;ocp-apim-subscription-region\&quot;: \&quot;eastus\&quot;,\n    \&quot;x-clienttraceid\&quot;: \&quot;0bc08047-8852-4f8e-a2d1-8760f4c392d8\&quot;,\n    \&quot;user-agent\&quot;: \&quot;axios/1.10.0\&quot;,\n    \&quot;content-length\&quot;: \&quot;18\&quot;,\n    \&quot;accept-encoding\&quot;: \&quot;gzip, compress, deflate, br\&quot;\n  },\n  \&quot;body\&quot;: \&quot;[{\\\&quot;text\\\&quot;:\\\&quot;Hello\\\&quot;}]\&quot;\n}&quot;,&quot;estack&quot;:&quot;Error: Azure Translator connection test failed: Azure Translator error: Nock: No match for request {\n  \&quot;method\&quot;: \&quot;POST\&quot;,\n  \&quot;url\&quot;: \&quot;https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&amp;to=es&amp;category=general&amp;profanityAction=NoAction&amp;includeAlignment=false&amp;includeSentenceLength=false&amp;textType=plain&amp;from=en\&quot;,\n  \&quot;headers\&quot;: {\n    \&quot;accept\&quot;: \&quot;application/json, text/plain, */*\&quot;,\n    \&quot;content-type\&quot;: \&quot;application/json\&quot;,\n    \&quot;ocp-apim-subscription-key\&quot;: \&quot;test-api-key\&quot;,\n    \&quot;ocp-apim-subscription-region\&quot;: \&quot;eastus\&quot;,\n    \&quot;x-clienttraceid\&quot;: \&quot;0bc08047-8852-4f8e-a2d1-8760f4c392d8\&quot;,\n    \&quot;user-agent\&quot;: \&quot;axios/1.10.0\&quot;,\n    \&quot;content-length\&quot;: \&quot;18\&quot;,\n    \&quot;accept-encoding\&quot;: \&quot;gzip, compress, deflate, br\&quot;\n  },\n  \&quot;body\&quot;: \&quot;[{\\\&quot;text\\\&quot;:\\\&quot;Hello\\\&quot;}]\&quot;\n}\n    at AzureTranslator.testConnection (src/services/translation/azure-translator.js:79:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async AzureTranslator.initialize (src/services/translation/azure-translator.js:51:13)\n    at async Context.&lt;anonymous&gt; (tests/api/azure-api.test.js:137:13)&quot;},&quot;uuid&quot;:&quot;2e5f5a3f-1d59-4e2b-b8ca-152c2f6bd4db&quot;,&quot;parentUUID&quot;:&quot;1d7ef47b-191a-4faa-8231-46379f9e6ffc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;2e5f5a3f-1d59-4e2b-b8ca-152c2f6bd4db&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;271952a8-40a1-40f8-89b4-737455752372&quot;,&quot;title&quot;:&quot;Supported Languages API&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/api/azure-api.test.js&quot;,&quot;file&quot;:&quot;/tests/api/azure-api.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should retrieve supported languages&quot;,&quot;fullTitle&quot;:&quot;Azure Translator API Tests Supported Languages API should retrieve supported languages&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Set up mock API response\nnock(&#x27;https://api.cognitive.microsofttranslator.com&#x27;)\n    .get(&#x27;/languages&#x27;)\n    .query(q =&gt; q[&#x27;api-version&#x27;] === &#x27;3.0&#x27; &amp;&amp; q.scope === &#x27;translation&#x27;)\n    .reply(200, {\n        translation: {\n            en: {\n                name: &#x27;English&#x27;,\n                nativeName: &#x27;English&#x27;,\n                dir: &#x27;ltr&#x27;\n            },\n            es: {\n                name: &#x27;Spanish&#x27;,\n                nativeName: &#x27;Espaol&#x27;,\n                dir: &#x27;ltr&#x27;\n            },\n            fr: {\n                name: &#x27;French&#x27;,\n                nativeName: &#x27;Franais&#x27;,\n                dir: &#x27;ltr&#x27;\n            }\n        }\n    });\n// Call the load languages method\nawait translator.loadSupportedLanguages();\nexpect(translator.supportedLanguages).to.be.an(&#x27;array&#x27;);\nexpect(translator.supportedLanguages).to.include.members([&#x27;en&#x27;, &#x27;es&#x27;, &#x27;fr&#x27;]);\n// Verify all nock mocks were called\nexpect(nock.isDone()).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;69c58036-c707-4f8d-8066-4904d331ab5e&quot;,&quot;parentUUID&quot;:&quot;271952a8-40a1-40f8-89b4-737455752372&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;69c58036-c707-4f8d-8066-4904d331ab5e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:5,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;8a5a8d84-da65-4dff-89ac-e9c879de0f29&quot;,&quot;title&quot;:&quot;Authentication&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/api/azure-api.test.js&quot;,&quot;file&quot;:&quot;/tests/api/azure-api.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should include correct authentication headers&quot;,&quot;fullTitle&quot;:&quot;Azure Translator API Tests Authentication should include correct authentication headers&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Set up header verification\nlet capturedHeaders = {};\nnock(&#x27;https://api.cognitive.microsofttranslator.com&#x27;)\n    .post(&#x27;/translate&#x27;)\n    .query(true)\n    .reply(function (uri, requestBody) {\n        // Capture the headers for verification\n        capturedHeaders = this.req.headers;\n        return [200, [{\n            translations: [{ text: &#x27;Hola&#x27;, to: &#x27;es&#x27; }]\n        }]];\n    });\n// Initialize translator\nawait translator.initialize();\n// Call translation method\nawait translator.translate(&#x27;Hello&#x27;, &#x27;en&#x27;, &#x27;es&#x27;);\n// Verify authentication headers\nexpect(capturedHeaders).to.have.property(&#x27;ocp-apim-subscription-key&#x27;);\nexpect(capturedHeaders[&#x27;ocp-apim-subscription-key&#x27;][0]).to.equal(&#x27;test-api-key&#x27;);\nexpect(capturedHeaders).to.have.property(&#x27;ocp-apim-subscription-region&#x27;);\nexpect(capturedHeaders[&#x27;ocp-apim-subscription-region&#x27;][0]).to.equal(&#x27;eastus&#x27;);\n// Verify all nock mocks were called\nexpect(nock.isDone()).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Azure Translator error: Nock: No match for request {\n  \&quot;method\&quot;: \&quot;POST\&quot;,\n  \&quot;url\&quot;: \&quot;https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&amp;to=es&amp;category=general&amp;profanityAction=NoAction&amp;includeAlignment=false&amp;includeSentenceLength=false&amp;textType=plain&amp;from=en\&quot;,\n  \&quot;headers\&quot;: {\n    \&quot;accept\&quot;: \&quot;application/json, text/plain, */*\&quot;,\n    \&quot;content-type\&quot;: \&quot;application/json\&quot;,\n    \&quot;ocp-apim-subscription-key\&quot;: \&quot;test-api-key\&quot;,\n    \&quot;ocp-apim-subscription-region\&quot;: \&quot;eastus\&quot;,\n    \&quot;x-clienttraceid\&quot;: \&quot;126db50b-b966-4060-aa56-c38c44fb6248\&quot;,\n    \&quot;user-agent\&quot;: \&quot;axios/1.10.0\&quot;,\n    \&quot;content-length\&quot;: \&quot;18\&quot;,\n    \&quot;accept-encoding\&quot;: \&quot;gzip, compress, deflate, br\&quot;\n  },\n  \&quot;body\&quot;: \&quot;[{\\\&quot;text\\\&quot;:\\\&quot;Hello\\\&quot;}]\&quot;\n}&quot;,&quot;estack&quot;:&quot;Error: Azure Translator error: Nock: No match for request {\n  \&quot;method\&quot;: \&quot;POST\&quot;,\n  \&quot;url\&quot;: \&quot;https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&amp;to=es&amp;category=general&amp;profanityAction=NoAction&amp;includeAlignment=false&amp;includeSentenceLength=false&amp;textType=plain&amp;from=en\&quot;,\n  \&quot;headers\&quot;: {\n    \&quot;accept\&quot;: \&quot;application/json, text/plain, */*\&quot;,\n    \&quot;content-type\&quot;: \&quot;application/json\&quot;,\n    \&quot;ocp-apim-subscription-key\&quot;: \&quot;test-api-key\&quot;,\n    \&quot;ocp-apim-subscription-region\&quot;: \&quot;eastus\&quot;,\n    \&quot;x-clienttraceid\&quot;: \&quot;126db50b-b966-4060-aa56-c38c44fb6248\&quot;,\n    \&quot;user-agent\&quot;: \&quot;axios/1.10.0\&quot;,\n    \&quot;content-length\&quot;: \&quot;18\&quot;,\n    \&quot;accept-encoding\&quot;: \&quot;gzip, compress, deflate, br\&quot;\n  },\n  \&quot;body\&quot;: \&quot;[{\\\&quot;text\\\&quot;:\\\&quot;Hello\\\&quot;}]\&quot;\n}\n    at AzureTranslator.translateText (src/services/translation/azure-translator.js:223:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async AzureTranslator.translate (src/services/translation/azure-translator.js:129:20)\n    at async Context.&lt;anonymous&gt; (tests/api/azure-api.test.js:208:13)&quot;},&quot;uuid&quot;:&quot;d64bd4d8-2afb-48bd-9ce5-46500e183bb1&quot;,&quot;parentUUID&quot;:&quot;8a5a8d84-da65-4dff-89ac-e9c879de0f29&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;d64bd4d8-2afb-48bd-9ce5-46500e183bb1&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:7,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;2630654b-2ebb-4fe8-a2ed-ddbc4a587a02&quot;,&quot;title&quot;:&quot;End-to-End Tests&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/e2e/app.e2e.test.js&quot;,&quot;file&quot;:&quot;/tests/e2e/app.e2e.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should be implemented with Playwright&quot;,&quot;fullTitle&quot;:&quot;End-to-End Tests should be implemented with Playwright&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;pending&quot;,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:true,&quot;code&quot;:&quot;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8b572bf0-c0ff-40d0-9c35-81f07cee33f1&quot;,&quot;parentUUID&quot;:&quot;2630654b-2ebb-4fe8-a2ed-ddbc4a587a02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[&quot;8b572bf0-c0ff-40d0-9c35-81f07cee33f1&quot;],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;239cb8ff-0c5e-493f-9c70-f409087a681b&quot;,&quot;title&quot;:&quot;E2E Test Placeholder&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/e2e/app.e2e.test.js&quot;,&quot;file&quot;:&quot;/tests/e2e/app.e2e.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should pass&quot;,&quot;fullTitle&quot;:&quot;E2E Test Placeholder should pass&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(true).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9a8287c2-f99d-40a5-a4a7-8fc5ef6e66d6&quot;,&quot;parentUUID&quot;:&quot;239cb8ff-0c5e-493f-9c70-f409087a681b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9a8287c2-f99d-40a5-a4a7-8fc5ef6e66d6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;c14ff37a-da46-4eb2-88db-e7b231b08d46&quot;,&quot;title&quot;:&quot;Translation App E2E Tests&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/e2e/translationApp.e2e.test.js&quot;,&quot;file&quot;:&quot;/tests/e2e/translationApp.e2e.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should perform a complete translation flow&quot;,&quot;fullTitle&quot;:&quot;Translation App E2E Tests should perform a complete translation flow&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;pending&quot;,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:true,&quot;code&quot;:&quot;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;81976ab3-5fe2-4dd3-ac77-6717d631a3c6&quot;,&quot;parentUUID&quot;:&quot;c14ff37a-da46-4eb2-88db-e7b231b08d46&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle errors gracefully&quot;,&quot;fullTitle&quot;:&quot;Translation App E2E Tests should handle errors gracefully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;pending&quot;,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:true,&quot;code&quot;:&quot;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;eff08d11-9b60-4263-a07b-1f1e8ab140ea&quot;,&quot;parentUUID&quot;:&quot;c14ff37a-da46-4eb2-88db-e7b231b08d46&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[&quot;81976ab3-5fe2-4dd3-ac77-6717d631a3c6&quot;,&quot;eff08d11-9b60-4263-a07b-1f1e8ab140ea&quot;],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;6501b327-9f95-4dfd-a91a-0af3b2538390&quot;,&quot;title&quot;:&quot;E2E Test Placeholder&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/e2e/translationApp.e2e.test.js&quot;,&quot;file&quot;:&quot;/tests/e2e/translationApp.e2e.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should pass&quot;,&quot;fullTitle&quot;:&quot;E2E Test Placeholder should pass&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(true).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c9420949-018c-4216-8c01-56338eca975c&quot;,&quot;parentUUID&quot;:&quot;6501b327-9f95-4dfd-a91a-0af3b2538390&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c9420949-018c-4216-8c01-56338eca975c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;c0c6a904-0db8-47be-b73a-1b5f5b048211&quot;,&quot;title&quot;:&quot;Example Test Suite&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/example.test.js&quot;,&quot;file&quot;:&quot;/tests/example.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should pass a simple test&quot;,&quot;fullTitle&quot;:&quot;Example Test Suite should pass a simple test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(true).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2c4f1caf-80e7-4678-84d7-d4eb5d6673de&quot;,&quot;parentUUID&quot;:&quot;c0c6a904-0db8-47be-b73a-1b5f5b048211&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should demonstrate sinon stub&quot;,&quot;fullTitle&quot;:&quot;Example Test Suite should demonstrate sinon stub&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const stub = sinon.stub().returns(42);\nexpect(stub()).to.equal(42);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6df343e2-959e-45be-9463-987bd3f2a01d&quot;,&quot;parentUUID&quot;:&quot;c0c6a904-0db8-47be-b73a-1b5f5b048211&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2c4f1caf-80e7-4678-84d7-d4eb5d6673de&quot;,&quot;6df343e2-959e-45be-9463-987bd3f2a01d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;84e209ea-26b8-485a-ae34-63a5edf9fb35&quot;,&quot;title&quot;:&quot;Complete Pipeline Integration Tests&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/integration/complete-pipeline.test.js&quot;,&quot;file&quot;:&quot;/tests/integration/complete-pipeline.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Complete Pipeline Integration Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;Complete Pipeline Integration Tests \&quot;before each\&quot; hook in \&quot;Complete Pipeline Integration Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox = sinon.createSandbox();\n// Initialize managers with mock services\ntranslationManager = new TranslationManager();\ntranslationManager.services = {\n    deepl: new MockDeepLService(),\n    gpt4o: new MockGPT4oTranslator(),\n    google: new MockGoogleTranslate(),\n    azure: new MockAzureTranslator()\n};\n// Create STT and TTS managers (or mocks if needed)\nsttManager = new STTManager();\nttsManager = new TTSManager();\n// Mock filesystem operations\nsandbox.stub(fs, &#x27;writeFileSync&#x27;);\nsandbox.stub(fs, &#x27;readFileSync&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;32568c4a-b9ab-4e13-946a-06c230abee7d&quot;,&quot;parentUUID&quot;:&quot;84e209ea-26b8-485a-ae34-63a5edf9fb35&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Complete Pipeline Integration Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;Complete Pipeline Integration Tests \&quot;after each\&quot; hook in \&quot;Complete Pipeline Integration Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.restore();\nif (translationManager) translationManager.destroy();\nif (sttManager) sttManager.destroy();\nif (ttsManager) ttsManager.destroy();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a1414355-18eb-4d03-b06c-1a2624bf954e&quot;,&quot;parentUUID&quot;:&quot;84e209ea-26b8-485a-ae34-63a5edf9fb35&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;386acefa-1a80-40d0-acb8-1c332717820a&quot;,&quot;title&quot;:&quot;End-to-end audio translation pipeline&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/integration/complete-pipeline.test.js&quot;,&quot;file&quot;:&quot;/tests/integration/complete-pipeline.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should process audio through the complete pipeline&quot;,&quot;fullTitle&quot;:&quot;Complete Pipeline Integration Tests End-to-end audio translation pipeline should process audio through the complete pipeline&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:363,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// This test might take longer\nthis.timeout(10000);\n// Initialize all components\nawait translationManager.initialize();\n// Mock STT transcription\nsandbox.stub(sttManager, &#x27;transcribeAudio&#x27;).resolves({\n    text: &#x27;Hello, this is a test of the translation system.&#x27;,\n    confidence: 0.95,\n    language: &#x27;en&#x27;,\n    service: &#x27;whisper&#x27;\n});\n// Mock TTS synthesis\nsandbox.stub(ttsManager, &#x27;synthesizeSpeech&#x27;).resolves({\n    audioFile: &#x27;/path/to/mock/output.wav&#x27;,\n    duration: 2.5,\n    service: &#x27;elevenlabs&#x27;,\n    voice: &#x27;default&#x27;\n});\n// Step 1: Speech-to-Text\nconst sttResult = await sttManager.transcribeAudio(&#x27;/path/to/mock/input.wav&#x27;);\nexpect(sttResult.text).to.equal(&#x27;Hello, this is a test of the translation system.&#x27;);\nexpect(sttResult.language).to.equal(&#x27;en&#x27;);\n// Step 2: Translation\nconst translationResult = await translationManager.translate(\n    sttResult.text,\n    sttResult.language,\n    &#x27;es&#x27;,\n    { context: &#x27;System test&#x27; }\n);\nexpect(translationResult.success).to.be.true;\nexpect(translationResult.translation).to.be.a(&#x27;string&#x27;);\nexpect(translationResult.service).to.be.oneOf([&#x27;deepl&#x27;, &#x27;gpt4o&#x27;, &#x27;google&#x27;, &#x27;azure&#x27;]);\n// Step 3: Text-to-Speech\nconst ttsResult = await ttsManager.synthesizeSpeech(\n    translationResult.translation,\n    &#x27;es&#x27;,\n    { voice: &#x27;default&#x27; }\n);\nexpect(ttsResult.audioFile).to.equal(&#x27;/path/to/mock/output.wav&#x27;);\nexpect(ttsResult.service).to.equal(&#x27;elevenlabs&#x27;);\n// Verify the complete flow works as expected\nexpect(sttManager.transcribeAudio.calledOnce).to.be.true;\nexpect(ttsManager.synthesizeSpeech.calledOnce).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: this.languagePairOptimizer.initialize is not a function&quot;,&quot;estack&quot;:&quot;TypeError: this.languagePairOptimizer.initialize is not a function\n    at TranslationManager.initialize (src/services/translation/translation-manager.js:79:46)\n    at async Context.&lt;anonymous&gt; (tests/integration/complete-pipeline.test.js:61:13)&quot;},&quot;uuid&quot;:&quot;fd9b42b4-b90d-4fdf-a3d3-f349a8ccfbe7&quot;,&quot;parentUUID&quot;:&quot;386acefa-1a80-40d0-acb8-1c332717820a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle service failover in the pipeline&quot;,&quot;fullTitle&quot;:&quot;Complete Pipeline Integration Tests End-to-end audio translation pipeline should handle service failover in the pipeline&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(10000);\n// Set up a failing STT service\nsandbox.stub(sttManager, &#x27;transcribeAudio&#x27;)\n    .onFirstCall().rejects(new Error(&#x27;Service unavailable&#x27;))\n    .onSecondCall().resolves({\n        text: &#x27;Hello, this is a test with failover.&#x27;,\n        confidence: 0.9,\n        language: &#x27;en&#x27;,\n        service: &#x27;google&#x27; // Fallback service\n    });\n// Mock other components\nsandbox.stub(translationManager, &#x27;translate&#x27;).resolves({\n    success: true,\n    translation: &#x27;Hola, esta es una prueba con conmutacin por error.&#x27;,\n    service: &#x27;google&#x27;,\n    confidence: 0.85,\n    fromLanguage: &#x27;en&#x27;,\n    toLanguage: &#x27;es&#x27;\n});\nsandbox.stub(ttsManager, &#x27;synthesizeSpeech&#x27;).resolves({\n    audioFile: &#x27;/path/to/mock/output.wav&#x27;,\n    duration: 3.0,\n    service: &#x27;google&#x27;,\n    voice: &#x27;default&#x27;\n});\n// Execute pipeline with retry logic\nlet sttResult;\ntry {\n    // First attempt will fail\n    sttResult = await sttManager.transcribeAudio(&#x27;/path/to/mock/input.wav&#x27;);\n} catch (error) {\n    // Retry with fallback service\n    sttResult = await sttManager.transcribeAudio(&#x27;/path/to/mock/input.wav&#x27;);\n}\nexpect(sttResult.text).to.equal(&#x27;Hello, this is a test with failover.&#x27;);\nexpect(sttResult.service).to.equal(&#x27;google&#x27;); // Should use fallback\n// Continue with translation and TTS\nconst translationResult = await translationManager.translate(\n    sttResult.text,\n    sttResult.language,\n    &#x27;es&#x27;\n);\nconst ttsResult = await ttsManager.synthesizeSpeech(\n    translationResult.translation,\n    &#x27;es&#x27;\n);\nexpect(translationResult.success).to.be.true;\nexpect(ttsResult.audioFile).to.be.a(&#x27;string&#x27;);\n// Verify the STT service was called twice (initial failure + retry)\nexpect(sttManager.transcribeAudio.calledTwice).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot stub non-existent property transcribeAudio&quot;,&quot;estack&quot;:&quot;TypeError: Cannot stub non-existent property transcribeAudio\n    at Function.stub (node_modules/sinon/lib/sinon/stub.js:82:15)\n    at Sandbox.stub (node_modules/sinon/lib/sinon/sandbox.js:389:39)\n    at Context.&lt;anonymous&gt; (tests/integration/complete-pipeline.test.js:116:21)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;16370513-58d0-43d1-99e1-1be994ec5c78&quot;,&quot;parentUUID&quot;:&quot;386acefa-1a80-40d0-acb8-1c332717820a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should maintain conversation context across multiple exchanges&quot;,&quot;fullTitle&quot;:&quot;Complete Pipeline Integration Tests End-to-end audio translation pipeline should maintain conversation context across multiple exchanges&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:364,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(15000);\n// Initialize all components\nawait translationManager.initialize();\n// Mock STT for multiple utterances\nconst mockUtterances = [\n    { text: &#x27;Hello, how are you today?&#x27;, language: &#x27;en&#x27; },\n    { text: &#x27;I would like to schedule a meeting tomorrow.&#x27;, language: &#x27;en&#x27; },\n    { text: &#x27;Does 2 PM work for you?&#x27;, language: &#x27;en&#x27; }\n];\nconst sttStub = sandbox.stub(sttManager, &#x27;transcribeAudio&#x27;);\nmockUtterances.forEach((utterance, index) =&gt; {\n    sttStub.onCall(index).resolves({\n        text: utterance.text,\n        confidence: 0.95,\n        language: utterance.language,\n        service: &#x27;whisper&#x27;\n    });\n});\n// Mock TTS\nsandbox.stub(ttsManager, &#x27;synthesizeSpeech&#x27;).resolves({\n    audioFile: &#x27;/path/to/mock/output.wav&#x27;,\n    duration: 2.0,\n    service: &#x27;elevenlabs&#x27;\n});\n// Create conversation ID for context tracking\nconst conversationId = &#x27;test-conversation-&#x27; + Date.now();\n// Process each utterance through the pipeline\nfor (let i = 0; i &lt; mockUtterances.length; i++) {\n    // Step 1: Speech-to-Text\n    const sttResult = await sttManager.transcribeAudio(`/path/to/mock/input${i}.wav`);\n    // Step 2: Translation with conversation context\n    const translationResult = await translationManager.translate(\n        sttResult.text,\n        sttResult.language,\n        &#x27;es&#x27;,\n        {\n            conversationId: conversationId,\n            domain: &#x27;business&#x27;\n        }\n    );\n    // Step 3: Text-to-Speech\n    await ttsManager.synthesizeSpeech(\n        translationResult.translation,\n        &#x27;es&#x27;\n    );\n    expect(translationResult.success).to.be.true;\n}\n// Verify all utterances were processed\nexpect(sttManager.transcribeAudio.callCount).to.equal(mockUtterances.length);\nexpect(ttsManager.synthesizeSpeech.callCount).to.equal(mockUtterances.length);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: this.languagePairOptimizer.initialize is not a function&quot;,&quot;estack&quot;:&quot;TypeError: this.languagePairOptimizer.initialize is not a function\n    at TranslationManager.initialize (src/services/translation/translation-manager.js:79:46)\n    at async Context.&lt;anonymous&gt; (tests/integration/complete-pipeline.test.js:178:13)&quot;},&quot;uuid&quot;:&quot;418a5773-ee8a-427d-b135-34e40da76b96&quot;,&quot;parentUUID&quot;:&quot;386acefa-1a80-40d0-acb8-1c332717820a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;fd9b42b4-b90d-4fdf-a3d3-f349a8ccfbe7&quot;,&quot;16370513-58d0-43d1-99e1-1be994ec5c78&quot;,&quot;418a5773-ee8a-427d-b135-34e40da76b96&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:728,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;d70e07b9-84e4-4671-a1bc-3eb40bcead24&quot;,&quot;title&quot;:&quot;Translation Integration Tests&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/integration/stt-translation.test.js&quot;,&quot;file&quot;:&quot;/tests/integration/stt-translation.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Translation Integration Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;Translation Integration Tests \&quot;before each\&quot; hook in \&quot;Translation Integration Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox = sinon.createSandbox();\n// Create a translation manager with mock services\ntranslationManager = new TranslationManager();\n// Replace real services with mocks\ntranslationManager.services = {\n    deepl: new MockDeepLService(),\n    gpt4o: new MockGPT4oTranslator(),\n    google: new MockGoogleTranslate(),\n    azure: new MockAzureTranslator()\n};&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bbbfec33-0165-4909-9e02-d1ca97afe5f3&quot;,&quot;parentUUID&quot;:&quot;d70e07b9-84e4-4671-a1bc-3eb40bcead24&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Translation Integration Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;Translation Integration Tests \&quot;after each\&quot; hook in \&quot;Translation Integration Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.restore();\ntranslationManager.destroy();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;636b573a-f310-451c-a28f-f6106c25f527&quot;,&quot;parentUUID&quot;:&quot;d70e07b9-84e4-4671-a1bc-3eb40bcead24&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;80a307b9-f349-41ea-be46-75b994997c2c&quot;,&quot;title&quot;:&quot;End-to-end translation workflow&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/integration/stt-translation.test.js&quot;,&quot;file&quot;:&quot;/tests/integration/stt-translation.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should complete the full translation pipeline&quot;,&quot;fullTitle&quot;:&quot;Translation Integration Tests End-to-end translation workflow should complete the full translation pipeline&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:365,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Initialize the translation manager\nawait translationManager.initialize();\n// Verify all services initialized\nexpect(translationManager.isInitialized).to.be.true;\nexpect(Object.values(translationManager.serviceHealth).every(s =&gt; s.healthy)).to.be.true;\n// Get supported language pairs\nconst supportedPairs = await translationManager.getSupportedLanguagePairs();\nexpect(supportedPairs).to.be.an(&#x27;array&#x27;).that.is.not.empty;\n// Test basic translation\nconst result1 = await translationManager.translate(&#x27;Hello world&#x27;, &#x27;en&#x27;, &#x27;es&#x27;);\nexpect(result1.success).to.be.true;\nexpect(result1.translation).to.equal(&#x27;Hola mundo&#x27;);\nexpect(result1.service).to.be.oneOf([&#x27;deepl&#x27;, &#x27;gpt4o&#x27;, &#x27;google&#x27;, &#x27;azure&#x27;]);\n// Test translation with context\nconst result2 = await translationManager.translate(\n    &#x27;How are you?&#x27;,\n    &#x27;en&#x27;,\n    &#x27;fr&#x27;,\n    {\n        context: &#x27;Casual conversation between friends&#x27;,\n        domain: &#x27;casual&#x27;\n    }\n);\nexpect(result2.success).to.be.true;\nexpect(result2.translation).to.equal(&#x27;Comment allez-vous?&#x27;);\n// Test translation with conversation context\nconst result3 = await translationManager.translate(\n    &#x27;Thank you&#x27;,\n    &#x27;en&#x27;,\n    &#x27;de&#x27;,\n    {\n        conversationId: &#x27;test-conversation&#x27;,\n        domain: &#x27;business&#x27;\n    }\n);\nexpect(result3.success).to.be.true;\nexpect(result3.translation).to.equal(&#x27;Danke&#x27;);\n// Test translation cache\nconst result4 = await translationManager.translate(\n    &#x27;Hello world&#x27;,\n    &#x27;en&#x27;,\n    &#x27;es&#x27;,\n    { useCache: true }\n);\nexpect(result4.success).to.be.true;\nexpect(result4.cached).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: this.languagePairOptimizer.initialize is not a function&quot;,&quot;estack&quot;:&quot;TypeError: this.languagePairOptimizer.initialize is not a function\n    at TranslationManager.initialize (src/services/translation/translation-manager.js:79:46)\n    at async Context.&lt;anonymous&gt; (tests/integration/stt-translation.test.js:38:13)&quot;},&quot;uuid&quot;:&quot;b7a2634c-c9ec-4403-a23c-d10a07d83dad&quot;,&quot;parentUUID&quot;:&quot;80a307b9-f349-41ea-be46-75b994997c2c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle service failover correctly&quot;,&quot;fullTitle&quot;:&quot;Translation Integration Tests End-to-end translation workflow should handle service failover correctly&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:364,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Create translation manager with one failing service\ntranslationManager.services.deepl = new MockDeepLService({ failureRate: 1.0 });\nawait translationManager.initialize();\n// Verify service health reflects the failure\nexpect(translationManager.serviceHealth.deepl.healthy).to.be.false;\n// Test that translation still works using a different service\nconst result = await translationManager.translate(&#x27;Hello world&#x27;, &#x27;en&#x27;, &#x27;es&#x27;);\nexpect(result.success).to.be.true;\nexpect(result.translation).to.equal(&#x27;Hola mundo&#x27;);\nexpect(result.service).to.not.equal(&#x27;deepl&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: this.languagePairOptimizer.initialize is not a function&quot;,&quot;estack&quot;:&quot;TypeError: this.languagePairOptimizer.initialize is not a function\n    at TranslationManager.initialize (src/services/translation/translation-manager.js:79:46)\n    at async Context.&lt;anonymous&gt; (tests/integration/stt-translation.test.js:98:13)&quot;},&quot;uuid&quot;:&quot;c2fba0b9-9c8e-44a4-9fec-dbc9c86b27b6&quot;,&quot;parentUUID&quot;:&quot;80a307b9-f349-41ea-be46-75b994997c2c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should maintain conversation context between translations&quot;,&quot;fullTitle&quot;:&quot;Translation Integration Tests End-to-end translation workflow should maintain conversation context between translations&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:364,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await translationManager.initialize();\n// Perform a series of translations in the same conversation\nconst conversationId = &#x27;test-conversation-context&#x27;;\n// First message\nawait translationManager.translate(\n    &#x27;Hello, how are you today?&#x27;,\n    &#x27;en&#x27;,\n    &#x27;es&#x27;,\n    { conversationId }\n);\n// Second message\nawait translationManager.translate(\n    &#x27;I am fine, thank you!&#x27;,\n    &#x27;en&#x27;,\n    &#x27;es&#x27;,\n    { conversationId }\n);\n// Test that the context is used\nconst contextSpy = sandbox.spy(translationManager.contextManager, &#x27;getConversationContext&#x27;);\nawait translationManager.translate(\n    &#x27;Would you like to meet for coffee?&#x27;,\n    &#x27;en&#x27;,\n    &#x27;es&#x27;,\n    { conversationId }\n);\nexpect(contextSpy.calledOnce).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: this.languagePairOptimizer.initialize is not a function&quot;,&quot;estack&quot;:&quot;TypeError: this.languagePairOptimizer.initialize is not a function\n    at TranslationManager.initialize (src/services/translation/translation-manager.js:79:46)\n    at async Context.&lt;anonymous&gt; (tests/integration/stt-translation.test.js:112:13)&quot;},&quot;uuid&quot;:&quot;af73dcb7-c57e-4870-b18b-5eda94de3105&quot;,&quot;parentUUID&quot;:&quot;80a307b9-f349-41ea-be46-75b994997c2c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle different priority settings&quot;,&quot;fullTitle&quot;:&quot;Translation Integration Tests End-to-end translation workflow should handle different priority settings&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:366,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await translationManager.initialize();\n// Test quality-focused translation\nconst qualityResult = await translationManager.translate(\n    &#x27;Good morning&#x27;,\n    &#x27;en&#x27;,\n    &#x27;fr&#x27;,\n    { priority: &#x27;quality&#x27; }\n);\n// Test speed-focused translation\nconst speedResult = await translationManager.translate(\n    &#x27;Good morning&#x27;,\n    &#x27;en&#x27;,\n    &#x27;fr&#x27;,\n    { priority: &#x27;speed&#x27; }\n);\n// These might use different services based on the routing logic\nexpect(qualityResult.translation).to.equal(&#x27;Bonjour&#x27;);\nexpect(speedResult.translation).to.equal(&#x27;Bonjour&#x27;);\n// Test cost-focused translation\nconst costResult = await translationManager.translate(\n    &#x27;Good evening&#x27;,\n    &#x27;en&#x27;,\n    &#x27;fr&#x27;,\n    { priority: &#x27;cost&#x27; }\n);\nexpect(costResult.translation).to.equal(&#x27;Bonsoir&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: this.languagePairOptimizer.initialize is not a function&quot;,&quot;estack&quot;:&quot;TypeError: this.languagePairOptimizer.initialize is not a function\n    at TranslationManager.initialize (src/services/translation/translation-manager.js:79:46)\n    at async Context.&lt;anonymous&gt; (tests/integration/stt-translation.test.js:147:13)&quot;},&quot;uuid&quot;:&quot;1fc37b6e-fddf-44ce-a96d-fe1191984acc&quot;,&quot;parentUUID&quot;:&quot;80a307b9-f349-41ea-be46-75b994997c2c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;b7a2634c-c9ec-4403-a23c-d10a07d83dad&quot;,&quot;c2fba0b9-9c8e-44a4-9fec-dbc9c86b27b6&quot;,&quot;af73dcb7-c57e-4870-b18b-5eda94de3105&quot;,&quot;1fc37b6e-fddf-44ce-a96d-fe1191984acc&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1459,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;5ca365d4-feb0-4cbc-9fc3-d2b85dcfcee4&quot;,&quot;title&quot;:&quot;Translation Performance Tests&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/performance/translation-performance.test.js&quot;,&quot;file&quot;:&quot;/tests/performance/translation-performance.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Translation Performance Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;Translation Performance Tests \&quot;before all\&quot; hook in \&quot;Translation Performance Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Load test data\ntestData = loadTestData(&#x27;translation-test-data.json&#x27;);\n// Create sandbox\nsandbox = sinon.createSandbox();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;620ea973-63fc-4d07-bb9c-6e9a503d2581&quot;,&quot;parentUUID&quot;:&quot;5ca365d4-feb0-4cbc-9fc3-d2b85dcfcee4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook for \&quot;should measure individual service latency\&quot;&quot;,&quot;fullTitle&quot;:&quot;Translation Performance Tests \&quot;before each\&quot; hook for \&quot;should measure individual service latency\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:365,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Create and initialize managers with mock services\ntranslationManager = new TranslationManager();\ntranslationManager.services = createMockServices();\nsttManager = new STTManager();\nttsManager = new TTSManager();\n// Initialize components\nawait translationManager.initialize();\nawait sttManager.initialize();\nawait ttsManager.initialize();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: this.languagePairOptimizer.initialize is not a function&quot;,&quot;estack&quot;:&quot;TypeError: this.languagePairOptimizer.initialize is not a function\n    at TranslationManager.initialize (src/services/translation/translation-manager.js:79:46)\n    at async Context.&lt;anonymous&gt; (tests/performance/translation-performance.test.js:52:9)&quot;},&quot;uuid&quot;:&quot;e22025c5-6c26-48a8-a87d-b6f6f8abde8d&quot;,&quot;parentUUID&quot;:&quot;5ca365d4-feb0-4cbc-9fc3-d2b85dcfcee4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Translation Performance Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;Translation Performance Tests \&quot;after each\&quot; hook in \&quot;Translation Performance Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.restore();\nif (translationManager) translationManager.destroy();\nif (sttManager) sttManager.destroy();\nif (ttsManager) ttsManager.destroy();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e18c3594-62fd-499f-bf7b-1e34accd28b1&quot;,&quot;parentUUID&quot;:&quot;5ca365d4-feb0-4cbc-9fc3-d2b85dcfcee4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1d685735-fdc7-4177-9cf4-e13913414d5c&quot;,&quot;title&quot;:&quot;Translation Service Latency&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/performance/translation-performance.test.js&quot;,&quot;file&quot;:&quot;/tests/performance/translation-performance.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should measure individual service latency&quot;,&quot;fullTitle&quot;:&quot;Translation Performance Tests Translation Service Latency should measure individual service latency&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const results = {\n    deepl: [],\n    gpt4o: [],\n    google: [],\n    azure: []\n};\n// Test text to translate\nconst text = &#x27;Hello world, this is a performance test for the translation system.&#x27;;\nconst iterations = 5;\n// Measure latency for each service\nfor (const service of Object.keys(results)) {\n    for (let i = 0; i &lt; iterations; i++) {\n        const startTime = Date.now();\n        try {\n            const result = await translationManager.attemptTranslation(\n                service,\n                text,\n                &#x27;en&#x27;,\n                &#x27;es&#x27;\n            );\n            const endTime = Date.now();\n            const latency = endTime - startTime;\n            results[service].push({\n                latency,\n                success: result.success,\n                iteration: i\n            });\n        } catch (error) {\n            results[service].push({\n                latency: Date.now() - startTime,\n                success: false,\n                error: error.message,\n                iteration: i\n            });\n        }\n        // Small delay between tests\n        await delay(100);\n    }\n}\n// Calculate and report average latencies\nconst averages = {};\nfor (const [service, measurements] of Object.entries(results)) {\n    const successfulMeasurements = measurements.filter(m =&gt; m.success);\n    if (successfulMeasurements.length &gt; 0) {\n        const totalLatency = successfulMeasurements.reduce((sum, m) =&gt; sum + m.latency, 0);\n        averages[service] = totalLatency / successfulMeasurements.length;\n    } else {\n        averages[service] = null; // All attempts failed\n    }\n}\nconsole.log(&#x27;Average service latencies (ms):&#x27;, averages);\n// Verify all services completed successfully at least once\nfor (const service of Object.keys(results)) {\n    const successCount = results[service].filter(m =&gt; m.success).length;\n    expect(successCount).to.be.greaterThan(0, `${service} should succeed at least once`);\n}\n// Verify latencies are within acceptable ranges\n// These thresholds should be adjusted based on your performance requirements\nexpect(averages.deepl).to.be.lessThan(500, &#x27;DeepL latency should be under 500ms&#x27;);\nexpect(averages.google).to.be.lessThan(500, &#x27;Google latency should be under 500ms&#x27;);\nexpect(averages.azure).to.be.lessThan(500, &#x27;Azure latency should be under 500ms&#x27;);\n// GPT-4o is expected to be slower\nexpect(averages.gpt4o).to.be.lessThan(1000, &#x27;GPT-4o latency should be under 1000ms&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6bab216b-337a-4076-9ccc-cd72c5a1744f&quot;,&quot;parentUUID&quot;:&quot;1d685735-fdc7-4177-9cf4-e13913414d5c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;6bab216b-337a-4076-9ccc-cd72c5a1744f&quot;],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:30000},{&quot;uuid&quot;:&quot;b5fac312-f738-4586-8494-54228e89305a&quot;,&quot;title&quot;:&quot;Translation Pipeline Throughput&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/performance/translation-performance.test.js&quot;,&quot;file&quot;:&quot;/tests/performance/translation-performance.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should handle multiple concurrent translation requests&quot;,&quot;fullTitle&quot;:&quot;Translation Performance Tests Translation Pipeline Throughput should handle multiple concurrent translation requests&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Number of concurrent requests\nconst concurrentRequests = 10;\n// Sample texts to translate\nconst texts = testData.testCases.map(tc =&gt; tc.text);\n// Create array of translation promises\nconst translationPromises = [];\nconst startTime = Date.now();\n// Launch concurrent translations\nfor (let i = 0; i &lt; concurrentRequests; i++) {\n    const textIndex = i % texts.length;\n    const promise = translationManager.translate(\n        texts[textIndex],\n        &#x27;en&#x27;,\n        &#x27;es&#x27;,\n        { priority: &#x27;speed&#x27; } // Prioritize speed for throughput test\n    );\n    translationPromises.push(promise);\n}\n// Wait for all translations to complete\nconst results = await Promise.all(translationPromises);\nconst endTime = Date.now();\nconst totalTime = endTime - startTime;\n// Calculate metrics\nconst successCount = results.filter(r =&gt; r.success).length;\nconst throughput = (successCount / totalTime) * 1000; // translations per second\nconsole.log(`Throughput: ${throughput.toFixed(2)} translations/second`);\nconsole.log(`Total time for ${concurrentRequests} requests: ${totalTime}ms`);\n// Verify all translations succeeded\nexpect(successCount).to.equal(concurrentRequests, &#x27;All translations should succeed&#x27;);\n// Verify minimum throughput\n// This threshold should be adjusted based on your performance requirements\nexpect(throughput).to.be.greaterThan(5, &#x27;Throughput should be at least 5 translations/second&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;23a84185-a3ff-41af-8323-118f6bd63edd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;23a84185-a3ff-41af-8323-118f6bd63edd&quot;],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:30000},{&quot;uuid&quot;:&quot;6a620fa6-7cc8-4f18-8e17-48150ed5db87&quot;,&quot;title&quot;:&quot;Complete Pipeline Performance&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/performance/translation-performance.test.js&quot;,&quot;file&quot;:&quot;/tests/performance/translation-performance.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should measure end-to-end pipeline latency&quot;,&quot;fullTitle&quot;:&quot;Translation Performance Tests Complete Pipeline Performance should measure end-to-end pipeline latency&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock the STT and TTS components\nsandbox.stub(sttManager, &#x27;transcribeAudio&#x27;).callsFake(async () =&gt; {\n    await delay(300); // Simulate STT processing time\n    return {\n        text: &#x27;Hello, this is a test of the translation system.&#x27;,\n        confidence: 0.95,\n        language: &#x27;en&#x27;,\n        service: &#x27;whisper&#x27;\n    };\n});\nsandbox.stub(ttsManager, &#x27;synthesizeSpeech&#x27;).callsFake(async (text, language) =&gt; {\n    await delay(500); // Simulate TTS processing time\n    return {\n        audioFile: &#x27;/path/to/mock/output.wav&#x27;,\n        duration: 2.5,\n        service: &#x27;elevenlabs&#x27;,\n        voice: &#x27;default&#x27;\n    };\n});\nconst iterations = 3;\nconst results = [];\nfor (let i = 0; i &lt; iterations; i++) {\n    const startTime = Date.now();\n    // Step 1: Speech-to-Text\n    const sttResult = await sttManager.transcribeAudio(&#x27;/path/to/mock/input.wav&#x27;);\n    const sttTime = Date.now();\n    // Step 2: Translation\n    const translationResult = await translationManager.translate(\n        sttResult.text,\n        sttResult.language,\n        &#x27;es&#x27;,\n        { context: &#x27;System test&#x27; }\n    );\n    const translationTime = Date.now();\n    // Step 3: Text-to-Speech\n    const ttsResult = await ttsManager.synthesizeSpeech(\n        translationResult.translation,\n        &#x27;es&#x27;,\n        { voice: &#x27;default&#x27; }\n    );\n    const endTime = Date.now();\n    // Calculate component latencies\n    const sttLatency = sttTime - startTime;\n    const translationLatency = translationTime - sttTime;\n    const ttsLatency = endTime - translationTime;\n    const totalLatency = endTime - startTime;\n    results.push({\n        iteration: i,\n        sttLatency,\n        translationLatency,\n        ttsLatency,\n        totalLatency\n    });\n    // Small delay between iterations\n    await delay(200);\n}\n// Calculate averages\nconst avgSttLatency = results.reduce((sum, r) =&gt; sum + r.sttLatency, 0) / iterations;\nconst avgTranslationLatency = results.reduce((sum, r) =&gt; sum + r.translationLatency, 0) / iterations;\nconst avgTtsLatency = results.reduce((sum, r) =&gt; sum + r.ttsLatency, 0) / iterations;\nconst avgTotalLatency = results.reduce((sum, r) =&gt; sum + r.totalLatency, 0) / iterations;\nconsole.log(&#x27;Average STT latency:&#x27;, avgSttLatency.toFixed(2), &#x27;ms&#x27;);\nconsole.log(&#x27;Average Translation latency:&#x27;, avgTranslationLatency.toFixed(2), &#x27;ms&#x27;);\nconsole.log(&#x27;Average TTS latency:&#x27;, avgTtsLatency.toFixed(2), &#x27;ms&#x27;);\nconsole.log(&#x27;Average Total latency:&#x27;, avgTotalLatency.toFixed(2), &#x27;ms&#x27;);\n// Verify performance meets requirements\nexpect(avgSttLatency).to.be.lessThan(1000, &#x27;STT should complete within 1000ms&#x27;);\nexpect(avgTranslationLatency).to.be.lessThan(500, &#x27;Translation should complete within 500ms&#x27;);\nexpect(avgTtsLatency).to.be.lessThan(1500, &#x27;TTS should complete within 1500ms&#x27;);\nexpect(avgTotalLatency).to.be.lessThan(4000, &#x27;Complete pipeline should finish within 4000ms&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;977f7fd7-9716-4a4a-82e9-64d3d21c4660&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;977f7fd7-9716-4a4a-82e9-64d3d21c4660&quot;],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:30000},{&quot;uuid&quot;:&quot;0de128f8-a631-49bf-af64-93152f1ff179&quot;,&quot;title&quot;:&quot;Resource Utilization&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/performance/translation-performance.test.js&quot;,&quot;file&quot;:&quot;/tests/performance/translation-performance.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should measure memory usage during translation&quot;,&quot;fullTitle&quot;:&quot;Translation Performance Tests Resource Utilization should measure memory usage during translation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Skip this test in CI environments where memory measurement may be unreliable\nif (process.env.CI) {\n    this.skip();\n    return;\n}\n// Get initial memory usage\nconst initialMemory = process.memoryUsage();\n// Number of translations to perform\nconst iterations = 50;\n// Perform multiple translations\nfor (let i = 0; i &lt; iterations; i++) {\n    const result = await translationManager.translate(\n        `Test message ${i} for memory usage measurement.`,\n        &#x27;en&#x27;,\n        &#x27;es&#x27;\n    );\n    // Verify translation succeeded\n    expect(result.success).to.be.true;\n}\n// Measure final memory usage\nconst finalMemory = process.memoryUsage();\n// Calculate memory increase\nconst heapIncrease = finalMemory.heapUsed - initialMemory.heapUsed;\nconst rssIncrease = finalMemory.rss - initialMemory.rss;\nconsole.log(`Memory usage after ${iterations} translations:`);\nconsole.log(`Heap increase: ${(heapIncrease / 1024 / 1024).toFixed(2)} MB`);\nconsole.log(`RSS increase: ${(rssIncrease / 1024 / 1024).toFixed(2)} MB`);\n// Verify memory increase is within acceptable limits\n// These thresholds should be adjusted based on your resource constraints\nexpect(heapIncrease).to.be.lessThan(50 * 1024 * 1024, &#x27;Heap increase should be less than 50MB&#x27;);\nexpect(rssIncrease).to.be.lessThan(100 * 1024 * 1024, &#x27;RSS increase should be less than 100MB&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;329d5c4c-9676-44b2-afcd-f3c9765ddb6e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;329d5c4c-9676-44b2-afcd-f3c9765ddb6e&quot;],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:30000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:30000},{&quot;uuid&quot;:&quot;210c7207-4cbd-49bd-acda-510001590d35&quot;,&quot;title&quot;:&quot;Translation Cache Performance&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/performance/translation-performance.test.js&quot;,&quot;file&quot;:&quot;/tests/performance/translation-performance.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook for \&quot;should improve performance with caching\&quot;&quot;,&quot;fullTitle&quot;:&quot;Translation Cache Performance \&quot;before each\&quot; hook for \&quot;should improve performance with caching\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:363,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox = sinon.createSandbox();\n// Create and initialize translation manager\ntranslationManager = new TranslationManager();\ntranslationManager.services = createMockServices();\nawait translationManager.initialize();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: this.languagePairOptimizer.initialize is not a function&quot;,&quot;estack&quot;:&quot;TypeError: this.languagePairOptimizer.initialize is not a function\n    at TranslationManager.initialize (src/services/translation/translation-manager.js:79:46)\n    at async Context.&lt;anonymous&gt; (tests/performance/translation-performance.test.js:331:9)&quot;},&quot;uuid&quot;:&quot;db2c6303-2915-4c83-9668-24c723eea943&quot;,&quot;parentUUID&quot;:&quot;210c7207-4cbd-49bd-acda-510001590d35&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Translation Cache Performance\&quot;&quot;,&quot;fullTitle&quot;:&quot;Translation Cache Performance \&quot;after each\&quot; hook in \&quot;Translation Cache Performance\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.restore();\nif (translationManager) translationManager.destroy();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ed8fb32c-3e18-46b7-9f23-b7aa7b6a98b6&quot;,&quot;parentUUID&quot;:&quot;210c7207-4cbd-49bd-acda-510001590d35&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should improve performance with caching&quot;,&quot;fullTitle&quot;:&quot;Translation Cache Performance should improve performance with caching&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Texts to translate\nconst texts = [\n    &#x27;Hello world&#x27;,\n    &#x27;How are you today?&#x27;,\n    &#x27;The weather is beautiful&#x27;\n];\n// First round - without cache\nconst firstRoundTimes = [];\nfor (const text of texts) {\n    const startTime = Date.now();\n    const result = await translationManager.translate(text, &#x27;en&#x27;, &#x27;es&#x27;, { useCache: false });\n    const endTime = Date.now();\n    firstRoundTimes.push(endTime - startTime);\n    expect(result.success).to.be.true;\n}\n// Second round - with cache\nconst secondRoundTimes = [];\nfor (const text of texts) {\n    const startTime = Date.now();\n    const result = await translationManager.translate(text, &#x27;en&#x27;, &#x27;es&#x27;, { useCache: true });\n    const endTime = Date.now();\n    secondRoundTimes.push(endTime - startTime);\n    expect(result.success).to.be.true;\n    expect(result.cached).to.be.true;\n}\n// Calculate average times\nconst avgFirstRound = firstRoundTimes.reduce((sum, t) =&gt; sum + t, 0) / firstRoundTimes.length;\nconst avgSecondRound = secondRoundTimes.reduce((sum, t) =&gt; sum + t, 0) / secondRoundTimes.length;\nconsole.log(&#x27;Average time without cache:&#x27;, avgFirstRound.toFixed(2), &#x27;ms&#x27;);\nconsole.log(&#x27;Average time with cache:&#x27;, avgSecondRound.toFixed(2), &#x27;ms&#x27;);\nconsole.log(&#x27;Performance improvement:&#x27;, ((avgFirstRound - avgSecondRound) / avgFirstRound * 100).toFixed(2), &#x27;%&#x27;);\n// Verify cache provides significant performance improvement\nexpect(avgSecondRound).to.be.lessThan(avgFirstRound * 0.5, &#x27;Cache should reduce latency by at least 50%&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;55ee026a-b5be-489a-b28a-ea14c3bdca62&quot;,&quot;parentUUID&quot;:&quot;210c7207-4cbd-49bd-acda-510001590d35&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;55ee026a-b5be-489a-b28a-ea14c3bdca62&quot;],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;de7de7f6-0c7b-4294-bbea-1ed8530e6930&quot;,&quot;title&quot;:&quot;API Key Security&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/security/api-key-security.test.js&quot;,&quot;file&quot;:&quot;/tests/security/api-key-security.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;API Key Security\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Key Security \&quot;before each\&quot; hook in \&quot;API Key Security\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox = sinon.createSandbox();\n// Mock fs functions\nsandbox.stub(fs, &#x27;readFileSync&#x27;);\nsandbox.stub(fs, &#x27;writeFileSync&#x27;);\nsandbox.stub(fs, &#x27;existsSync&#x27;).returns(true);\n// Mock encryption/decryption functions\nmockConfig = {\n    encryptionKey: &#x27;test-encryption-key&#x27;,\n    configDir: &#x27;/mock/config/dir&#x27;\n};\napiKeyManager = new ApiKeyManager(mockConfig);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;88c665b9-6414-4a60-b6d6-d8f2e8572732&quot;,&quot;parentUUID&quot;:&quot;de7de7f6-0c7b-4294-bbea-1ed8530e6930&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;API Key Security\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Key Security \&quot;after each\&quot; hook in \&quot;API Key Security\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f9c601db-ceda-44a0-ba2e-bac207bbe4b6&quot;,&quot;parentUUID&quot;:&quot;de7de7f6-0c7b-4294-bbea-1ed8530e6930&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;02134c16-ef07-477f-938a-d8fe43999ceb&quot;,&quot;title&quot;:&quot;API key storage&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/security/api-key-security.test.js&quot;,&quot;file&quot;:&quot;/tests/security/api-key-security.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should encrypt API keys before storing&quot;,&quot;fullTitle&quot;:&quot;API Key Security API key storage should encrypt API keys before storing&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Set up test data\nconst serviceId = &#x27;deepl&#x27;;\nconst apiKey = &#x27;test-api-key-12345&#x27;;\n// Call store API key\napiKeyManager.storeApiKey(serviceId, apiKey);\n// Check that writeFileSync was called with encrypted data\nexpect(fs.writeFileSync.calledOnce).to.be.true;\nconst writeCall = fs.writeFileSync.firstCall;\nconst encryptedData = writeCall.args[1];\n// Verify data is encrypted (not plain text)\nexpect(encryptedData).to.not.include(apiKey);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: apiKeyManager.storeApiKey is not a function&quot;,&quot;estack&quot;:&quot;TypeError: apiKeyManager.storeApiKey is not a function\n    at Context.&lt;anonymous&gt; (tests/security/api-key-security.test.js:46:27)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;eadea8ee-6332-4806-80c4-de3fc2d20613&quot;,&quot;parentUUID&quot;:&quot;02134c16-ef07-477f-938a-d8fe43999ceb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should store API keys in the correct location&quot;,&quot;fullTitle&quot;:&quot;API Key Security API key storage should store API keys in the correct location&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Set up test data\nconst serviceId = &#x27;deepl&#x27;;\nconst apiKey = &#x27;test-api-key-12345&#x27;;\n// Call store API key\napiKeyManager.storeApiKey(serviceId, apiKey);\n// Check that the file path is correct\nconst expectedPath = path.join(mockConfig.configDir, `${serviceId}.key`);\nexpect(fs.writeFileSync.firstCall.args[0]).to.equal(expectedPath);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: apiKeyManager.storeApiKey is not a function&quot;,&quot;estack&quot;:&quot;TypeError: apiKeyManager.storeApiKey is not a function\n    at Context.&lt;anonymous&gt; (tests/security/api-key-security.test.js:64:27)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;abac0e5d-6fa3-4597-bd6d-c8fd16cb3bcc&quot;,&quot;parentUUID&quot;:&quot;02134c16-ef07-477f-938a-d8fe43999ceb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not store API keys in plain text&quot;,&quot;fullTitle&quot;:&quot;API Key Security API key storage should not store API keys in plain text&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Set up test data\nconst serviceId = &#x27;deepl&#x27;;\nconst apiKey = &#x27;test-api-key-12345&#x27;;\n// Spy on console to check for logging\nconst consoleSpy = sandbox.spy(console, &#x27;log&#x27;);\n// Call store API key\napiKeyManager.storeApiKey(serviceId, apiKey);\n// Verify key is not logged\nexpect(consoleSpy.neverCalledWith(sinon.match(apiKey))).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: apiKeyManager.storeApiKey is not a function&quot;,&quot;estack&quot;:&quot;TypeError: apiKeyManager.storeApiKey is not a function\n    at Context.&lt;anonymous&gt; (tests/security/api-key-security.test.js:80:27)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;f115b223-beae-4a8a-a669-89b682c09ea6&quot;,&quot;parentUUID&quot;:&quot;02134c16-ef07-477f-938a-d8fe43999ceb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;eadea8ee-6332-4806-80c4-de3fc2d20613&quot;,&quot;abac0e5d-6fa3-4597-bd6d-c8fd16cb3bcc&quot;,&quot;f115b223-beae-4a8a-a669-89b682c09ea6&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;48f61efe-9e83-46ec-82af-4f94dcc0ce62&quot;,&quot;title&quot;:&quot;API key retrieval&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/security/api-key-security.test.js&quot;,&quot;file&quot;:&quot;/tests/security/api-key-security.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should decrypt API keys when retrieving&quot;,&quot;fullTitle&quot;:&quot;API Key Security API key retrieval should decrypt API keys when retrieving&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Set up test data\nconst serviceId = &#x27;deepl&#x27;;\nconst apiKey = &#x27;test-api-key-12345&#x27;;\n// Mock encryption and decryption\napiKeyManager.encryptData = sandbox.stub().returns(&#x27;encrypted-data&#x27;);\napiKeyManager.decryptData = sandbox.stub().returns(apiKey);\n// Mock readFileSync to return encrypted data\nfs.readFileSync.returns(&#x27;encrypted-data&#x27;);\n// Call retrieve API key\nconst retrievedKey = apiKeyManager.getApiKey(serviceId);\n// Check that decryption was called\nexpect(apiKeyManager.decryptData.calledOnce).to.be.true;\nexpect(retrievedKey).to.equal(apiKey);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: apiKeyManager.getApiKey is not a function&quot;,&quot;estack&quot;:&quot;TypeError: apiKeyManager.getApiKey is not a function\n    at Context.&lt;anonymous&gt; (tests/security/api-key-security.test.js:101:48)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;971b9d44-7651-478e-a588-98078dfb7aa9&quot;,&quot;parentUUID&quot;:&quot;48f61efe-9e83-46ec-82af-4f94dcc0ce62&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle missing API keys gracefully&quot;,&quot;fullTitle&quot;:&quot;API Key Security API key retrieval should handle missing API keys gracefully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock file not existing\nfs.existsSync.returns(false);\n// Call retrieve API key for non-existent service\nconst retrievedKey = apiKeyManager.getApiKey(&#x27;nonexistent-service&#x27;);\n// Should return null, not throw\nexpect(retrievedKey).to.be.null;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: apiKeyManager.getApiKey is not a function&quot;,&quot;estack&quot;:&quot;TypeError: apiKeyManager.getApiKey is not a function\n    at Context.&lt;anonymous&gt; (tests/security/api-key-security.test.js:113:48)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;8161cc45-94f9-46fe-a38f-5eede0cc3b96&quot;,&quot;parentUUID&quot;:&quot;48f61efe-9e83-46ec-82af-4f94dcc0ce62&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle decryption errors securely&quot;,&quot;fullTitle&quot;:&quot;API Key Security API key retrieval should handle decryption errors securely&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock readFileSync to return data\nfs.readFileSync.returns(&#x27;corrupted-data&#x27;);\n// Mock decryption to throw error\napiKeyManager.decryptData = sandbox.stub().throws(new Error(&#x27;Decryption failed&#x27;));\n// Call retrieve API key\ntry {\n    apiKeyManager.getApiKey(&#x27;deepl&#x27;);\n    expect.fail(&#x27;Should have thrown an error&#x27;);\n} catch (error) {\n    // Should throw a generic error without exposing sensitive info\n    expect(error.message).to.not.include(&#x27;corrupted-data&#x27;);\n    expect(error.message).to.include(&#x27;retrieve API key&#x27;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;apiKeyManager.getApiKey is not a func&#x27; to include &#x27;retrieve API key&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;apiKeyManager.getApiKey is not a func&#x27; to include &#x27;retrieve API key&#x27;\n    at Context.&lt;anonymous&gt; (tests/security/api-key-security.test.js:133:42)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;419e0754-0866-4175-8124-39661a1c461a&quot;,&quot;parentUUID&quot;:&quot;48f61efe-9e83-46ec-82af-4f94dcc0ce62&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;971b9d44-7651-478e-a588-98078dfb7aa9&quot;,&quot;8161cc45-94f9-46fe-a38f-5eede0cc3b96&quot;,&quot;419e0754-0866-4175-8124-39661a1c461a&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;af42b358-0a82-4c96-ba40-beed31d5098d&quot;,&quot;title&quot;:&quot;API key validation&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/security/api-key-security.test.js&quot;,&quot;file&quot;:&quot;/tests/security/api-key-security.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should validate API key format&quot;,&quot;fullTitle&quot;:&quot;API Key Security API key validation should validate API key format&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Valid API keys\nexpect(apiKeyManager.isValidApiKeyFormat(&#x27;deepl&#x27;, &#x27;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&#x27;)).to.be.true;\nexpect(apiKeyManager.isValidApiKeyFormat(&#x27;gpt4o&#x27;, &#x27;sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#x27;)).to.be.true;\n// Invalid API keys\nexpect(apiKeyManager.isValidApiKeyFormat(&#x27;deepl&#x27;, &#x27;invalid-format&#x27;)).to.be.false;\nexpect(apiKeyManager.isValidApiKeyFormat(&#x27;gpt4o&#x27;, &#x27;invalid-format&#x27;)).to.be.false;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: apiKeyManager.isValidApiKeyFormat is not a function&quot;,&quot;estack&quot;:&quot;TypeError: apiKeyManager.isValidApiKeyFormat is not a function\n    at Context.&lt;anonymous&gt; (tests/security/api-key-security.test.js:141:34)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;55a11841-0030-40e8-87ff-32badcb0d111&quot;,&quot;parentUUID&quot;:&quot;af42b358-0a82-4c96-ba40-beed31d5098d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should detect potentially compromised API keys&quot;,&quot;fullTitle&quot;:&quot;API Key Security API key validation should detect potentially compromised API keys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Set up mock compromised key database\napiKeyManager.compromisedKeyHashes = new Set([&#x27;hash-of-compromised-key&#x27;]);\napiKeyManager.hashApiKey = sandbox.stub().returns(&#x27;hash-of-compromised-key&#x27;);\n// Should detect compromised key\nexpect(apiKeyManager.isCompromisedApiKey(&#x27;compromised-key&#x27;)).to.be.true;\n// Change hash result for safe key\napiKeyManager.hashApiKey.returns(&#x27;hash-of-safe-key&#x27;);\n// Should not flag safe key\nexpect(apiKeyManager.isCompromisedApiKey(&#x27;safe-key&#x27;)).to.be.false;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: apiKeyManager.isCompromisedApiKey is not a function&quot;,&quot;estack&quot;:&quot;TypeError: apiKeyManager.isCompromisedApiKey is not a function\n    at Context.&lt;anonymous&gt; (tests/security/api-key-security.test.js:155:34)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;d29e9206-ef69-462b-a4e8-927dabe90158&quot;,&quot;parentUUID&quot;:&quot;af42b358-0a82-4c96-ba40-beed31d5098d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;55a11841-0030-40e8-87ff-32badcb0d111&quot;,&quot;d29e9206-ef69-462b-a4e8-927dabe90158&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;43631e13-cca4-4b79-8cf5-e7b38f686824&quot;,&quot;title&quot;:&quot;API key rotation&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/security/api-key-security.test.js&quot;,&quot;file&quot;:&quot;/tests/security/api-key-security.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should support API key rotation&quot;,&quot;fullTitle&quot;:&quot;API Key Security API key rotation should support API key rotation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Set up test data\nconst serviceId = &#x27;deepl&#x27;;\nconst oldApiKey = &#x27;old-api-key&#x27;;\nconst newApiKey = &#x27;new-api-key&#x27;;\n// Mock API key storage\napiKeyManager.storeApiKey = sandbox.spy();\napiKeyManager.getApiKey = sandbox.stub().returns(oldApiKey);\n// Mock service client\nconst mockServiceClient = {\n    validateApiKey: sandbox.stub().resolves(true)\n};\n// Call rotate API key\nawait apiKeyManager.rotateApiKey(serviceId, newApiKey, mockServiceClient);\n// Should store new key\nexpect(apiKeyManager.storeApiKey.calledWith(serviceId, newApiKey)).to.be.true;\n// Should validate new key\nexpect(mockServiceClient.validateApiKey.calledWith(newApiKey)).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: apiKeyManager.rotateApiKey is not a function&quot;,&quot;estack&quot;:&quot;TypeError: apiKeyManager.rotateApiKey is not a function\n    at Context.&lt;anonymous&gt; (tests/security/api-key-security.test.js:182:33)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;82570b22-bf08-4c16-80b2-f16032260e90&quot;,&quot;parentUUID&quot;:&quot;43631e13-cca4-4b79-8cf5-e7b38f686824&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not store invalid API keys during rotation&quot;,&quot;fullTitle&quot;:&quot;API Key Security API key rotation should not store invalid API keys during rotation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Set up test data\nconst serviceId = &#x27;deepl&#x27;;\nconst oldApiKey = &#x27;old-api-key&#x27;;\nconst invalidApiKey = &#x27;invalid-api-key&#x27;;\n// Mock API key storage\napiKeyManager.storeApiKey = sandbox.spy();\napiKeyManager.getApiKey = sandbox.stub().returns(oldApiKey);\n// Mock service client with validation failure\nconst mockServiceClient = {\n    validateApiKey: sandbox.stub().resolves(false)\n};\n// Call rotate API key\ntry {\n    await apiKeyManager.rotateApiKey(serviceId, invalidApiKey, mockServiceClient);\n    expect.fail(&#x27;Should have thrown an error&#x27;);\n} catch (error) {\n    // Should not store invalid key\n    expect(apiKeyManager.storeApiKey.neverCalledWith(serviceId, invalidApiKey)).to.be.true;\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a017af24-c471-495e-a327-1be4d9a1bc69&quot;,&quot;parentUUID&quot;:&quot;43631e13-cca4-4b79-8cf5-e7b38f686824&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a017af24-c471-495e-a327-1be4d9a1bc69&quot;],&quot;failures&quot;:[&quot;82570b22-bf08-4c16-80b2-f16032260e90&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;fe78a67b-ac48-445b-ac9f-d5e3586cc27c&quot;,&quot;title&quot;:&quot;App Security&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/security/api-key-security.test.js&quot;,&quot;file&quot;:&quot;/tests/security/api-key-security.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;App Security\&quot;&quot;,&quot;fullTitle&quot;:&quot;App Security \&quot;before each\&quot; hook in \&quot;App Security\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox = sinon.createSandbox();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;67ea6009-4cc1-4f71-b1c8-8ab06a7a67e7&quot;,&quot;parentUUID&quot;:&quot;fe78a67b-ac48-445b-ac9f-d5e3586cc27c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;App Security\&quot;&quot;,&quot;fullTitle&quot;:&quot;App Security \&quot;after each\&quot; hook in \&quot;App Security\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3ad2d306-fe83-4b5b-a7e5-4bb5098da9f3&quot;,&quot;parentUUID&quot;:&quot;fe78a67b-ac48-445b-ac9f-d5e3586cc27c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2968bd15-7d02-42d9-ae5e-3f2f14649052&quot;,&quot;title&quot;:&quot;Input sanitization&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/security/api-key-security.test.js&quot;,&quot;file&quot;:&quot;/tests/security/api-key-security.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should sanitize user inputs to prevent injection attacks&quot;,&quot;fullTitle&quot;:&quot;App Security Input sanitization should sanitize user inputs to prevent injection attacks&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Import the sanitization module\nconst { sanitizeInput } = require(&#x27;../../src/services/security/input-sanitizer&#x27;);\n// Test potentially malicious inputs\nconst malicious = &#x27;&lt;script&gt;alert(\&quot;XSS\&quot;)&lt;/script&gt;&#x27;;\nconst sanitized = sanitizeInput(malicious);\n// Should remove script tags\nexpect(sanitized).to.not.include(&#x27;&lt;script&gt;&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Cannot find module &#x27;../../src/services/security/input-sanitizer&#x27;\nRequire stack:\n- /Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/security/api-key-security.test.js&quot;,&quot;estack&quot;:&quot;Error: Cannot find module &#x27;../../src/services/security/input-sanitizer&#x27;\nRequire stack:\n- /Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/security/api-key-security.test.js\n    at Function._resolveFilename (node:internal/modules/cjs/loader:1225:15)\n    at Function._load (node:internal/modules/cjs/loader:1055:27)\n    at TracingChannel.traceSync (node:diagnostics_channel:322:14)\n    at wrapModuleLoad (node:internal/modules/cjs/loader:220:24)\n    at Module.require (node:internal/modules/cjs/loader:1311:12)\n    at require (node:internal/modules/helpers:136:16)\n    at Context.&lt;anonymous&gt; (tests/security/api-key-security.test.js:232:39)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;6c3181df-f014-4964-b05a-b7d56acf8999&quot;,&quot;parentUUID&quot;:&quot;2968bd15-7d02-42d9-ae5e-3f2f14649052&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should sanitize file paths to prevent path traversal&quot;,&quot;fullTitle&quot;:&quot;App Security Input sanitization should sanitize file paths to prevent path traversal&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Import the sanitization module\nconst { sanitizePath } = require(&#x27;../../src/services/security/input-sanitizer&#x27;);\n// Test potentially malicious paths\nconst malicious = &#x27;../../../etc/passwd&#x27;;\nconst sanitized = sanitizePath(malicious);\n// Should remove directory traversal\nexpect(sanitized).to.not.include(&#x27;../&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Cannot find module &#x27;../../src/services/security/input-sanitizer&#x27;\nRequire stack:\n- /Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/security/api-key-security.test.js&quot;,&quot;estack&quot;:&quot;Error: Cannot find module &#x27;../../src/services/security/input-sanitizer&#x27;\nRequire stack:\n- /Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/security/api-key-security.test.js\n    at Function._resolveFilename (node:internal/modules/cjs/loader:1225:15)\n    at Function._load (node:internal/modules/cjs/loader:1055:27)\n    at TracingChannel.traceSync (node:diagnostics_channel:322:14)\n    at wrapModuleLoad (node:internal/modules/cjs/loader:220:24)\n    at Module.require (node:internal/modules/cjs/loader:1311:12)\n    at require (node:internal/modules/helpers:136:16)\n    at Context.&lt;anonymous&gt; (tests/security/api-key-security.test.js:244:38)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;c46508db-c9a4-4256-b19c-aa7643c7dad9&quot;,&quot;parentUUID&quot;:&quot;2968bd15-7d02-42d9-ae5e-3f2f14649052&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;6c3181df-f014-4964-b05a-b7d56acf8999&quot;,&quot;c46508db-c9a4-4256-b19c-aa7643c7dad9&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;f439e209-9857-4026-8aae-94a5917641ba&quot;,&quot;title&quot;:&quot;Content Security Policy&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/security/api-key-security.test.js&quot;,&quot;file&quot;:&quot;/tests/security/api-key-security.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should validate CSP headers&quot;,&quot;fullTitle&quot;:&quot;App Security Content Security Policy should validate CSP headers&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Import the CSP module\nconst { getCSPHeaders } = require(&#x27;../../src/services/security/content-security&#x27;);\nconst headers = getCSPHeaders();\n// Should have required CSP directives\nexpect(headers[&#x27;Content-Security-Policy&#x27;]).to.include(\&quot;default-src &#x27;self&#x27;\&quot;);\nexpect(headers[&#x27;Content-Security-Policy&#x27;]).to.include(\&quot;script-src &#x27;self&#x27;\&quot;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Cannot find module &#x27;../../src/services/security/content-security&#x27;\nRequire stack:\n- /Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/security/api-key-security.test.js&quot;,&quot;estack&quot;:&quot;Error: Cannot find module &#x27;../../src/services/security/content-security&#x27;\nRequire stack:\n- /Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/security/api-key-security.test.js\n    at Function._resolveFilename (node:internal/modules/cjs/loader:1225:15)\n    at Function._load (node:internal/modules/cjs/loader:1055:27)\n    at TracingChannel.traceSync (node:diagnostics_channel:322:14)\n    at wrapModuleLoad (node:internal/modules/cjs/loader:220:24)\n    at Module.require (node:internal/modules/cjs/loader:1311:12)\n    at require (node:internal/modules/helpers:136:16)\n    at Context.&lt;anonymous&gt; (tests/security/api-key-security.test.js:258:39)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;107fb483-c51a-4d9a-8340-2324237cffad&quot;,&quot;parentUUID&quot;:&quot;f439e209-9857-4026-8aae-94a5917641ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;107fb483-c51a-4d9a-8340-2324237cffad&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;10fed9dc-239e-4561-9e0f-44147099bb4c&quot;,&quot;title&quot;:&quot;Secure storage&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/security/api-key-security.test.js&quot;,&quot;file&quot;:&quot;/tests/security/api-key-security.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should use secure storage for sensitive data&quot;,&quot;fullTitle&quot;:&quot;App Security Secure storage should use secure storage for sensitive data&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Import the secure storage module\nconst SecureStorage = require(&#x27;../../src/services/security/secure-storage&#x27;);\nconst secureStorage = new SecureStorage();\n// Test storing sensitive data\nconst testData = { username: &#x27;test&#x27;, password: &#x27;secret&#x27; };\nsecureStorage.storeSecurely(&#x27;credentials&#x27;, testData);\n// Verify data is not stored in plain text\nconst storedData = secureStorage.retrieveSecurely(&#x27;credentials&#x27;);\n// Data should be retrieved correctly\nexpect(storedData).to.deep.equal(testData);\n// But internal storage should be encrypted\nexpect(JSON.stringify(secureStorage.storage)).to.not.include(&#x27;secret&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Cannot find module &#x27;../../src/services/security/secure-storage&#x27;\nRequire stack:\n- /Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/security/api-key-security.test.js&quot;,&quot;estack&quot;:&quot;Error: Cannot find module &#x27;../../src/services/security/secure-storage&#x27;\nRequire stack:\n- /Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/security/api-key-security.test.js\n    at Function._resolveFilename (node:internal/modules/cjs/loader:1225:15)\n    at Function._load (node:internal/modules/cjs/loader:1055:27)\n    at TracingChannel.traceSync (node:diagnostics_channel:322:14)\n    at wrapModuleLoad (node:internal/modules/cjs/loader:220:24)\n    at Module.require (node:internal/modules/cjs/loader:1311:12)\n    at require (node:internal/modules/helpers:136:16)\n    at Context.&lt;anonymous&gt; (tests/security/api-key-security.test.js:271:35)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;42b22c28-15f7-4f42-9cac-49c1e31a03f6&quot;,&quot;parentUUID&quot;:&quot;10fed9dc-239e-4561-9e0f-44147099bb4c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;42b22c28-15f7-4f42-9cac-49c1e31a03f6&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;44bda08a-e72a-43cc-b0de-8bcded8942ca&quot;,&quot;title&quot;:&quot;Network Security&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/security/api-key-security.test.js&quot;,&quot;file&quot;:&quot;/tests/security/api-key-security.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Network Security\&quot;&quot;,&quot;fullTitle&quot;:&quot;Network Security \&quot;before each\&quot; hook in \&quot;Network Security\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox = sinon.createSandbox();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;65ffe0e3-c6a3-4f0e-836a-b8c66730ccee&quot;,&quot;parentUUID&quot;:&quot;44bda08a-e72a-43cc-b0de-8bcded8942ca&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Network Security\&quot;&quot;,&quot;fullTitle&quot;:&quot;Network Security \&quot;after each\&quot; hook in \&quot;Network Security\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;706cdff8-a03b-4eb3-87bf-75c24932a9dd&quot;,&quot;parentUUID&quot;:&quot;44bda08a-e72a-43cc-b0de-8bcded8942ca&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ef1c9942-3bfc-4538-a0ef-84e600eab67a&quot;,&quot;title&quot;:&quot;HTTPS verification&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/security/api-key-security.test.js&quot;,&quot;file&quot;:&quot;/tests/security/api-key-security.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should verify HTTPS certificates by default&quot;,&quot;fullTitle&quot;:&quot;Network Security HTTPS verification should verify HTTPS certificates by default&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Import the HTTP client\nconst HttpClient = require(&#x27;../../src/services/network/http-client&#x27;);\n// Create client\nconst client = new HttpClient();\n// Check default config\nexpect(client.config.rejectUnauthorized).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Cannot find module &#x27;../../src/services/network/http-client&#x27;\nRequire stack:\n- /Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/security/api-key-security.test.js&quot;,&quot;estack&quot;:&quot;Error: Cannot find module &#x27;../../src/services/network/http-client&#x27;\nRequire stack:\n- /Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/security/api-key-security.test.js\n    at Function._resolveFilename (node:internal/modules/cjs/loader:1225:15)\n    at Function._load (node:internal/modules/cjs/loader:1055:27)\n    at TracingChannel.traceSync (node:diagnostics_channel:322:14)\n    at wrapModuleLoad (node:internal/modules/cjs/loader:220:24)\n    at Module.require (node:internal/modules/cjs/loader:1311:12)\n    at require (node:internal/modules/helpers:136:16)\n    at Context.&lt;anonymous&gt; (tests/security/api-key-security.test.js:305:32)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;d2f0e470-8316-40a3-8520-bd4b96555b07&quot;,&quot;parentUUID&quot;:&quot;ef1c9942-3bfc-4538-a0ef-84e600eab67a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should detect and prevent SSL stripping&quot;,&quot;fullTitle&quot;:&quot;Network Security HTTPS verification should detect and prevent SSL stripping&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Import the HTTP client\nconst HttpClient = require(&#x27;../../src/services/network/http-client&#x27;);\n// Create client\nconst client = new HttpClient();\n// Mock request options\nconst options = {\n    url: &#x27;http://api.example.com&#x27;, // Non-HTTPS URL\n};\n// Should throw error for non-HTTPS URLs\nexpect(() =&gt; client.get(options)).to.throw(/HTTPS required/);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Cannot find module &#x27;../../src/services/network/http-client&#x27;\nRequire stack:\n- /Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/security/api-key-security.test.js&quot;,&quot;estack&quot;:&quot;Error: Cannot find module &#x27;../../src/services/network/http-client&#x27;\nRequire stack:\n- /Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/security/api-key-security.test.js\n    at Function._resolveFilename (node:internal/modules/cjs/loader:1225:15)\n    at Function._load (node:internal/modules/cjs/loader:1055:27)\n    at TracingChannel.traceSync (node:diagnostics_channel:322:14)\n    at wrapModuleLoad (node:internal/modules/cjs/loader:220:24)\n    at Module.require (node:internal/modules/cjs/loader:1311:12)\n    at require (node:internal/modules/helpers:136:16)\n    at Context.&lt;anonymous&gt; (tests/security/api-key-security.test.js:316:32)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;73ba293a-2e47-42d2-a863-db9cba28e86e&quot;,&quot;parentUUID&quot;:&quot;ef1c9942-3bfc-4538-a0ef-84e600eab67a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;d2f0e470-8316-40a3-8520-bd4b96555b07&quot;,&quot;73ba293a-2e47-42d2-a863-db9cba28e86e&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;fc63ceaa-c7c6-491b-abbe-2bc457ef8151&quot;,&quot;title&quot;:&quot;Authentication header handling&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/security/api-key-security.test.js&quot;,&quot;file&quot;:&quot;/tests/security/api-key-security.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should safely handle authentication headers&quot;,&quot;fullTitle&quot;:&quot;Network Security Authentication header handling should safely handle authentication headers&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Import the HTTP client\nconst HttpClient = require(&#x27;../../src/services/network/http-client&#x27;);\n// Create client\nconst client = new HttpClient();\n// Mock logging function\nconst originalLog = console.log;\nconst logs = [];\nconsole.log = (message) =&gt; logs.push(message);\n// Make request with auth header\nclient.get({\n    url: &#x27;https://api.example.com&#x27;,\n    headers: {\n        &#x27;Authorization&#x27;: &#x27;Bearer secret-token-value&#x27;\n    }\n}).catch(() =&gt; { }); // Ignore actual network error\n// Restore console.log\nconsole.log = originalLog;\n// Check that auth header value is not logged\nconst hasAuthHeaderValue = logs.some(log =&gt; log.includes(&#x27;secret-token-value&#x27;));\nexpect(hasAuthHeaderValue).to.be.false;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Cannot find module &#x27;../../src/services/network/http-client&#x27;\nRequire stack:\n- /Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/security/api-key-security.test.js&quot;,&quot;estack&quot;:&quot;Error: Cannot find module &#x27;../../src/services/network/http-client&#x27;\nRequire stack:\n- /Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/security/api-key-security.test.js\n    at Function._resolveFilename (node:internal/modules/cjs/loader:1225:15)\n    at Function._load (node:internal/modules/cjs/loader:1055:27)\n    at TracingChannel.traceSync (node:diagnostics_channel:322:14)\n    at wrapModuleLoad (node:internal/modules/cjs/loader:220:24)\n    at Module.require (node:internal/modules/cjs/loader:1311:12)\n    at require (node:internal/modules/helpers:136:16)\n    at Context.&lt;anonymous&gt; (tests/security/api-key-security.test.js:334:32)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;84c115ae-2489-4941-a209-4ea01b4e37b4&quot;,&quot;parentUUID&quot;:&quot;fc63ceaa-c7c6-491b-abbe-2bc457ef8151&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;84c115ae-2489-4941-a209-4ea01b4e37b4&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;09f9802f-b177-4778-9766-7053d4d1bb39&quot;,&quot;title&quot;:&quot;Complete Translation Pipeline&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/core/complete-pipeline.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/core/complete-pipeline.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook for \&quot;should initialize pipeline with default settings\&quot;&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline \&quot;before each\&quot; hook for \&quot;should initialize pipeline with default settings\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Create mocks for all dependencies\nmockAudioManager = {\n  startCapture: sinon.stub(),\n  stopCapture: sinon.stub(),\n  setInputDevice: sinon.stub(),\n  setOutputDevice: sinon.stub(),\n  getAudioDevices: sinon.stub(),\n  isCapturing: sinon.stub().returns(false)\n};\nmockTranslationManager = {\n  translate: sinon.stub(),\n  setSourceLanguage: sinon.stub(),\n  setTargetLanguage: sinon.stub(),\n  setService: sinon.stub(),\n  getSupportedLanguages: sinon.stub(),\n  getAvailableServices: sinon.stub()\n};\nmockSTTManager = {\n  transcribe: sinon.stub(),\n  setLanguage: sinon.stub(),\n  setService: sinon.stub(),\n  isListening: sinon.stub().returns(false)\n};\nmockTTSManager = {\n  synthesize: sinon.stub(),\n  setVoice: sinon.stub(),\n  setLanguage: sinon.stub(),\n  setService: sinon.stub(),\n  playAudio: sinon.stub()\n};\nmockPlatformDetector = {\n  detectActiveApps: sinon.stub(),\n  configureAudioRouting: sinon.stub(),\n  getSupportedApps: sinon.stub(),\n  isMonitoring: sinon.stub().returns(false)\n};\nmockLogger = {\n  info: sinon.stub(),\n  error: sinon.stub(),\n  warn: sinon.stub(),\n  debug: sinon.stub()\n};\n// Mock the complete pipeline\ncompletePipeline = proxyquire(&#x27;../../../src/core/complete-pipeline&#x27;, {\n  &#x27;../audio/AudioManager&#x27;: mockAudioManager,\n  &#x27;../services/translation/translation-manager&#x27;: mockTranslationManager,\n  &#x27;../services/stt/STTManager&#x27;: mockSTTManager,\n  &#x27;../services/tts/TTSManager&#x27;: mockTTSManager,\n  &#x27;../services/platform-detector&#x27;: mockPlatformDetector,\n  &#x27;../utils/logger&#x27;: mockLogger\n});&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Cannot find module &#x27;../services/stt/stt-manager&#x27; from &#x27;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/src/core&#x27;&quot;,&quot;estack&quot;:&quot;Error: Cannot find module &#x27;../services/stt/stt-manager&#x27; from &#x27;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/src/core&#x27;\n    at Function.resolveSync [as sync] (node_modules/resolve/lib/sync.js:111:15)\n    at Proxyquire._resolveModule (node_modules/proxyquire/lib/proxyquire.js:137:20)\n    at Proxyquire._require (node_modules/proxyquire/lib/proxyquire.js:179:27)\n    at require (node:internal/modules/helpers:136:16)\n    at Object.&lt;anonymous&gt; (src/core/complete-pipeline.js:6:20)\n    at Module._compile (node:internal/modules/cjs/loader:1554:14)\n    at Object..js (node:internal/modules/cjs/loader:1706:10)\n    at require.extensions.&lt;computed&gt; (node_modules/proxyquire/lib/proxyquire.js:311:43)\n    at Module.load (node:internal/modules/cjs/loader:1289:32)\n    at Function._load (node:internal/modules/cjs/loader:1108:12)\n    at TracingChannel.traceSync (node:diagnostics_channel:322:14)\n    at wrapModuleLoad (node:internal/modules/cjs/loader:220:24)\n    at Module.require (node:internal/modules/cjs/loader:1311:12)\n    at Proxyquire._withoutCache (node_modules/proxyquire/lib/proxyquire.js:222:12)\n    at Proxyquire.load (node_modules/proxyquire/lib/proxyquire.js:129:15)\n    at Context.&lt;anonymous&gt; (tests/unit/core/complete-pipeline.test.js:64:24)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;6a004bb0-318c-46e2-a494-55bd23e8c930&quot;,&quot;parentUUID&quot;:&quot;09f9802f-b177-4778-9766-7053d4d1bb39&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Complete Translation Pipeline\&quot;&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline \&quot;after each\&quot; hook in \&quot;Complete Translation Pipeline\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bb10ab80-6fa3-46cc-a2fb-c07f6c6abc07&quot;,&quot;parentUUID&quot;:&quot;09f9802f-b177-4778-9766-7053d4d1bb39&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;dcc62906-0eb4-4db9-9179-9dc0f3da7729&quot;,&quot;title&quot;:&quot;Initialization&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/core/complete-pipeline.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/core/complete-pipeline.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should initialize pipeline with default settings&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline Initialization should initialize pipeline with default settings&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const pipeline = new completePipeline.CompletePipeline();\n\nexpect(pipeline).to.be.an(&#x27;object&#x27;);\nexpect(pipeline.isRunning).to.be.false;\nexpect(pipeline.config).to.be.an(&#x27;object&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fed7370b-d6d8-4ee0-9d2a-715820de5304&quot;,&quot;parentUUID&quot;:&quot;dcc62906-0eb4-4db9-9179-9dc0f3da7729&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should initialize with custom configuration&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline Initialization should initialize with custom configuration&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const config = {\n  sourceLanguage: &#x27;en&#x27;,\n  targetLanguage: &#x27;es&#x27;,\n  translationService: &#x27;deepl&#x27;,\n  sttService: &#x27;azure&#x27;,\n  ttsService: &#x27;azure&#x27;\n};\nconst pipeline = new completePipeline.CompletePipeline(config);\n\nexpect(pipeline.config.sourceLanguage).to.equal(&#x27;en&#x27;);\nexpect(pipeline.config.targetLanguage).to.equal(&#x27;es&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7d0834c9-6e2c-4a5e-94cf-e7aac7eae1c9&quot;,&quot;parentUUID&quot;:&quot;dcc62906-0eb4-4db9-9179-9dc0f3da7729&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should validate configuration on initialization&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline Initialization should validate configuration on initialization&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const invalidConfig = {\n  sourceLanguage: &#x27;invalid&#x27;,\n  targetLanguage: &#x27;invalid&#x27;\n};\nexpect(() =&gt; new completePipeline.CompletePipeline(invalidConfig)).to.throw();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;77f4fb09-496e-4902-b74e-8dcf7643d97d&quot;,&quot;parentUUID&quot;:&quot;dcc62906-0eb4-4db9-9179-9dc0f3da7729&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;fed7370b-d6d8-4ee0-9d2a-715820de5304&quot;,&quot;7d0834c9-6e2c-4a5e-94cf-e7aac7eae1c9&quot;,&quot;77f4fb09-496e-4902-b74e-8dcf7643d97d&quot;],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;fbeff00b-82c7-4d05-bcc1-ef71fd00313d&quot;,&quot;title&quot;:&quot;Pipeline Start/Stop&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/core/complete-pipeline.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/core/complete-pipeline.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should start pipeline successfully&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline Pipeline Start/Stop should start pipeline successfully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const pipeline = new completePipeline.CompletePipeline();\n\nmockAudioManager.startCapture.resolves();\nmockSTTManager.transcribe.resolves(&#x27;Hello world&#x27;);\nmockTranslationManager.translate.resolves(&#x27;Hola mundo&#x27;);\nmockTTSManager.synthesize.resolves(Buffer.from(&#x27;audio data&#x27;));\nmockPlatformDetector.detectActiveApps.resolves([&#x27;discord&#x27;]);\nconst result = await pipeline.start();\n\nexpect(result.success).to.be.true;\nexpect(pipeline.isRunning).to.be.true;\nexpect(mockAudioManager.startCapture.called).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1771d763-7746-4045-952a-37bae4ca0247&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should stop pipeline successfully&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline Pipeline Start/Stop should stop pipeline successfully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const pipeline = new completePipeline.CompletePipeline();\npipeline.isRunning = true;\nmockAudioManager.stopCapture.resolves();\nmockPlatformDetector.detectActiveApps.resolves([]);\nconst result = await pipeline.stop();\n\nexpect(result.success).to.be.true;\nexpect(pipeline.isRunning).to.be.false;\nexpect(mockAudioManager.stopCapture.called).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;621930da-864d-457b-9468-23226bedbd41&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should handle start errors gracefully&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline Pipeline Start/Stop should handle start errors gracefully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const pipeline = new completePipeline.CompletePipeline();\n\nmockAudioManager.startCapture.rejects(new Error(&#x27;Audio capture failed&#x27;));\nconst result = await pipeline.start();\n\nexpect(result.success).to.be.false;\nexpect(result.error).to.include(&#x27;Audio capture failed&#x27;);\nexpect(pipeline.isRunning).to.be.false;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d7448d00-c386-4f19-8ca4-85579c91dd3b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should prevent multiple starts&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline Pipeline Start/Stop should prevent multiple starts&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const pipeline = new completePipeline.CompletePipeline();\npipeline.isRunning = true;\nconst result = await pipeline.start();\n\nexpect(result.success).to.be.false;\nexpect(result.error).to.include(&#x27;already running&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;74e16492-95dc-4d36-9d4d-7837f5c8fa57&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;1771d763-7746-4045-952a-37bae4ca0247&quot;,&quot;621930da-864d-457b-9468-23226bedbd41&quot;,&quot;d7448d00-c386-4f19-8ca4-85579c91dd3b&quot;,&quot;74e16492-95dc-4d36-9d4d-7837f5c8fa57&quot;],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;4a0cea3e-75a7-427d-aadf-5d5d0abc2d9a&quot;,&quot;title&quot;:&quot;Audio Processing&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/core/complete-pipeline.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/core/complete-pipeline.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should process audio input correctly&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline Audio Processing should process audio input correctly&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const pipeline = new completePipeline.CompletePipeline();\npipeline.isRunning = true;\nconst audioData = Buffer.from(&#x27;test audio data&#x27;);\nmockSTTManager.transcribe.resolves(&#x27;Hello world&#x27;);\nmockTranslationManager.translate.resolves(&#x27;Hola mundo&#x27;);\nmockTTSManager.synthesize.resolves(Buffer.from(&#x27;translated audio&#x27;));\nconst result = await pipeline.processAudio(audioData);\n\nexpect(result.success).to.be.true;\nexpect(result.transcription).to.equal(&#x27;Hello world&#x27;);\nexpect(result.translation).to.equal(&#x27;Hola mundo&#x27;);\nexpect(mockSTTManager.transcribe.calledWith(audioData)).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;61438697-d7a8-4358-87bf-698423cad800&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should handle audio processing errors&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline Audio Processing should handle audio processing errors&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const pipeline = new completePipeline.CompletePipeline();\npipeline.isRunning = true;\nconst audioData = Buffer.from(&#x27;test audio data&#x27;);\nmockSTTManager.transcribe.rejects(new Error(&#x27;STT failed&#x27;));\nconst result = await pipeline.processAudio(audioData);\n\nexpect(result.success).to.be.false;\nexpect(result.error).to.include(&#x27;STT failed&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;dc6d49aa-c417-4ceb-8e9a-696bfb0c2867&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should handle empty audio data&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline Audio Processing should handle empty audio data&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const pipeline = new completePipeline.CompletePipeline();\npipeline.isRunning = true;\nconst result = await pipeline.processAudio(Buffer.alloc(0));\n\nexpect(result.success).to.be.false;\nexpect(result.error).to.include(&#x27;empty audio data&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0c2239e6-599d-40ef-ae8e-d56c8d07a7de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;61438697-d7a8-4358-87bf-698423cad800&quot;,&quot;dc6d49aa-c417-4ceb-8e9a-696bfb0c2867&quot;,&quot;0c2239e6-599d-40ef-ae8e-d56c8d07a7de&quot;],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;f794cc3f-ec38-4aa3-a2cd-0c4603f3b2ea&quot;,&quot;title&quot;:&quot;Translation Pipeline&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/core/complete-pipeline.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/core/complete-pipeline.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should translate text correctly&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline Translation Pipeline should translate text correctly&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const pipeline = new completePipeline.CompletePipeline();\n\nmockTranslationManager.translate.resolves(&#x27;Hola mundo&#x27;);\nmockTTSManager.synthesize.resolves(Buffer.from(&#x27;audio data&#x27;));\nconst result = await pipeline.translateText(&#x27;Hello world&#x27;);\n\nexpect(result.success).to.be.true;\nexpect(result.translation).to.equal(&#x27;Hola mundo&#x27;);\nexpect(result.audio).to.be.instanceOf(Buffer);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ed5e8a61-4c14-4185-83b3-280133dc7478&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should handle translation errors&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline Translation Pipeline should handle translation errors&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const pipeline = new completePipeline.CompletePipeline();\n\nmockTranslationManager.translate.rejects(new Error(&#x27;Translation failed&#x27;));\nconst result = await pipeline.translateText(&#x27;Hello world&#x27;);\n\nexpect(result.success).to.be.false;\nexpect(result.error).to.include(&#x27;Translation failed&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;97b6b662-5451-4230-b507-b866c58c5937&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should use fallback services&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline Translation Pipeline should use fallback services&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const pipeline = new completePipeline.CompletePipeline();\n\nmockTranslationManager.translate.onFirstCall().rejects(new Error(&#x27;Primary service failed&#x27;));\nmockTranslationManager.translate.onSecondCall().resolves(&#x27;Hola mundo&#x27;);\nmockTTSManager.synthesize.resolves(Buffer.from(&#x27;audio data&#x27;));\nconst result = await pipeline.translateText(&#x27;Hello world&#x27;);\n\nexpect(result.success).to.be.true;\nexpect(result.translation).to.equal(&#x27;Hola mundo&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;64d8bfb0-1beb-4036-ad61-92d3af1d44d3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;ed5e8a61-4c14-4185-83b3-280133dc7478&quot;,&quot;97b6b662-5451-4230-b507-b866c58c5937&quot;,&quot;64d8bfb0-1beb-4036-ad61-92d3af1d44d3&quot;],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;db302609-6d3f-4cf3-9b80-67fa688b82e0&quot;,&quot;title&quot;:&quot;Platform Integration&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/core/complete-pipeline.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/core/complete-pipeline.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should detect active communication apps&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline Platform Integration should detect active communication apps&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const pipeline = new completePipeline.CompletePipeline();\n\nmockPlatformDetector.detectActiveApps.resolves([&#x27;discord&#x27;, &#x27;zoom&#x27;]);\nconst result = await pipeline.detectActiveApps();\n\nexpect(result.success).to.be.true;\nexpect(result.apps).to.include(&#x27;discord&#x27;);\nexpect(result.apps).to.include(&#x27;zoom&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;384bd1cc-7699-4425-8e97-5cbd3b866eca&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should configure audio routing for detected apps&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline Platform Integration should configure audio routing for detected apps&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const pipeline = new completePipeline.CompletePipeline();\n\nmockPlatformDetector.configureAudioRouting.resolves();\nconst result = await pipeline.configureAudioRouting([&#x27;discord&#x27;]);\n\nexpect(result.success).to.be.true;\nexpect(mockPlatformDetector.configureAudioRouting.calledWith([&#x27;discord&#x27;])).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;28c8df35-cabe-474d-b68d-541754986ccf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should handle platform detection errors&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline Platform Integration should handle platform detection errors&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const pipeline = new completePipeline.CompletePipeline();\n\nmockPlatformDetector.detectActiveApps.rejects(new Error(&#x27;Detection failed&#x27;));\nconst result = await pipeline.detectActiveApps();\n\nexpect(result.success).to.be.false;\nexpect(result.error).to.include(&#x27;Detection failed&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6acec1c6-a053-48ab-8510-f759ece5883b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;384bd1cc-7699-4425-8e97-5cbd3b866eca&quot;,&quot;28c8df35-cabe-474d-b68d-541754986ccf&quot;,&quot;6acec1c6-a053-48ab-8510-f759ece5883b&quot;],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;0de41997-edbc-457c-ad80-6629e45eba89&quot;,&quot;title&quot;:&quot;Configuration Management&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/core/complete-pipeline.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/core/complete-pipeline.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should update configuration&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline Configuration Management should update configuration&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const pipeline = new completePipeline.CompletePipeline();\n\nconst newConfig = {\n  sourceLanguage: &#x27;fr&#x27;,\n  targetLanguage: &#x27;de&#x27;,\n  translationService: &#x27;google&#x27;\n};\nconst result = pipeline.updateConfiguration(newConfig);\n\nexpect(result.success).to.be.true;\nexpect(pipeline.config.sourceLanguage).to.equal(&#x27;fr&#x27;);\nexpect(pipeline.config.targetLanguage).to.equal(&#x27;de&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;99af56e4-e0cd-44c5-9ca8-659832f49306&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should validate configuration updates&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline Configuration Management should validate configuration updates&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const pipeline = new completePipeline.CompletePipeline();\n\nconst invalidConfig = {\n  sourceLanguage: &#x27;invalid&#x27;\n};\nconst result = pipeline.updateConfiguration(invalidConfig);\n\nexpect(result.success).to.be.false;\nexpect(result.error).to.include(&#x27;invalid&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;215aa066-722b-4291-8dd2-402a27d9bc3c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should get current configuration&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline Configuration Management should get current configuration&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const pipeline = new completePipeline.CompletePipeline();\n\nconst config = pipeline.getConfiguration();\n\nexpect(config).to.be.an(&#x27;object&#x27;);\nexpect(config).to.have.property(&#x27;sourceLanguage&#x27;);\nexpect(config).to.have.property(&#x27;targetLanguage&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7cee67ab-2b40-4acb-a106-23dd025faa23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;99af56e4-e0cd-44c5-9ca8-659832f49306&quot;,&quot;215aa066-722b-4291-8dd2-402a27d9bc3c&quot;,&quot;7cee67ab-2b40-4acb-a106-23dd025faa23&quot;],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;9168d639-f44a-4c08-8aa3-88b569dde0cd&quot;,&quot;title&quot;:&quot;Status and Monitoring&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/core/complete-pipeline.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/core/complete-pipeline.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should get pipeline status&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline Status and Monitoring should get pipeline status&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const pipeline = new completePipeline.CompletePipeline();\npipeline.isRunning = true;\nconst status = pipeline.getStatus();\n\nexpect(status.isRunning).to.be.true;\nexpect(status).to.have.property(&#x27;uptime&#x27;);\nexpect(status).to.have.property(&#x27;processedAudio&#x27;);\nexpect(status).to.have.property(&#x27;translations&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;087fd8c5-494e-4fff-beae-1b8ee936ae72&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should get performance metrics&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline Status and Monitoring should get performance metrics&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const pipeline = new completePipeline.CompletePipeline();\n\nconst metrics = pipeline.getPerformanceMetrics();\n\nexpect(metrics).to.be.an(&#x27;object&#x27;);\nexpect(metrics).to.have.property(&#x27;averageLatency&#x27;);\nexpect(metrics).to.have.property(&#x27;successRate&#x27;);\nexpect(metrics).to.have.property(&#x27;errorRate&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;121c89af-4186-4a8b-bf8d-a270a51857c5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should reset metrics&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline Status and Monitoring should reset metrics&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const pipeline = new completePipeline.CompletePipeline();\n\nconst result = pipeline.resetMetrics();\n\nexpect(result.success).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2e9859fb-4f7a-4127-ac6b-ecd974f0446e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;087fd8c5-494e-4fff-beae-1b8ee936ae72&quot;,&quot;121c89af-4186-4a8b-bf8d-a270a51857c5&quot;,&quot;2e9859fb-4f7a-4127-ac6b-ecd974f0446e&quot;],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;a6a60cb8-75e9-426d-84af-863bd0b5e822&quot;,&quot;title&quot;:&quot;Error Handling and Recovery&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/core/complete-pipeline.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/core/complete-pipeline.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should handle service failures gracefully&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline Error Handling and Recovery should handle service failures gracefully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const pipeline = new completePipeline.CompletePipeline();\n\nmockTranslationManager.translate.rejects(new Error(&#x27;Service unavailable&#x27;));\nmockTTSManager.synthesize.rejects(new Error(&#x27;TTS failed&#x27;));\nconst result = await pipeline.translateText(&#x27;Hello world&#x27;);\n\nexpect(result.success).to.be.false;\nexpect(result.error).to.include(&#x27;Service unavailable&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3285b244-c178-43b3-bb9b-29c9505e7b49&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should attempt recovery from errors&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline Error Handling and Recovery should attempt recovery from errors&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const pipeline = new completePipeline.CompletePipeline();\n\nmockTranslationManager.translate.onFirstCall().rejects(new Error(&#x27;Temporary error&#x27;));\nmockTranslationManager.translate.onSecondCall().resolves(&#x27;Hola mundo&#x27;);\nmockTTSManager.synthesize.resolves(Buffer.from(&#x27;audio data&#x27;));\nconst result = await pipeline.translateText(&#x27;Hello world&#x27;);\n\nexpect(result.success).to.be.true;\nexpect(result.translation).to.equal(&#x27;Hola mundo&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9de78708-bc57-4368-b612-e05f9b28ebf0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should log errors appropriately&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline Error Handling and Recovery should log errors appropriately&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const pipeline = new completePipeline.CompletePipeline();\n\nmockTranslationManager.translate.rejects(new Error(&#x27;Test error&#x27;));\nawait pipeline.translateText(&#x27;Hello world&#x27;);\n\nexpect(mockLogger.error.called).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6ddef56c-e7ef-4bf1-a730-dd67cc7b153d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;3285b244-c178-43b3-bb9b-29c9505e7b49&quot;,&quot;9de78708-bc57-4368-b612-e05f9b28ebf0&quot;,&quot;6ddef56c-e7ef-4bf1-a730-dd67cc7b153d&quot;],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;1b94ec08-39c2-40b4-8d19-9c6a7da48c2c&quot;,&quot;title&quot;:&quot;Resource Management&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/core/complete-pipeline.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/core/complete-pipeline.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should cleanup resources on stop&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline Resource Management should cleanup resources on stop&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const pipeline = new completePipeline.CompletePipeline();\npipeline.isRunning = true;\nmockAudioManager.stopCapture.resolves();\nmockPlatformDetector.detectActiveApps.resolves([]);\nconst result = await pipeline.stop();\n\nexpect(result.success).to.be.true;\nexpect(mockAudioManager.stopCapture.called).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3c2ca4bf-834e-4161-ad6b-d8c2ae84f911&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should handle cleanup errors&quot;,&quot;fullTitle&quot;:&quot;Complete Translation Pipeline Resource Management should handle cleanup errors&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const pipeline = new completePipeline.CompletePipeline();\npipeline.isRunning = true;\nmockAudioManager.stopCapture.rejects(new Error(&#x27;Cleanup failed&#x27;));\nconst result = await pipeline.stop();\n\nexpect(result.success).to.be.false;\nexpect(result.error).to.include(&#x27;Cleanup failed&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1fc8d604-3418-4cb9-9fb6-97bd1963dfdb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;3c2ca4bf-834e-4161-ad6b-d8c2ae84f911&quot;,&quot;1fc8d604-3418-4cb9-9fb6-97bd1963dfdb&quot;],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;a6d1e786-572d-444b-b86a-d6dfdc82abe2&quot;,&quot;title&quot;:&quot;Translation Error Handling&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/error-handling/translation-error-handling.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/error-handling/translation-error-handling.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook for \&quot;should handle all services failing\&quot;&quot;,&quot;fullTitle&quot;:&quot;Translation Error Handling \&quot;before each\&quot; hook for \&quot;should handle all services failing\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:364,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox = createTestSandbox();\n// Create translation manager with mock services\ntranslationManager = new TranslationManager();\ntranslationManager.services = createMockServices();\n// Initialize\nawait translationManager.initialize();&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: this.languagePairOptimizer.initialize is not a function&quot;,&quot;estack&quot;:&quot;TypeError: this.languagePairOptimizer.initialize is not a function\n    at TranslationManager.initialize (src/services/translation/translation-manager.js:79:46)\n    at async Context.&lt;anonymous&gt; (tests/unit/services/error-handling/translation-error-handling.test.js:22:9)&quot;},&quot;uuid&quot;:&quot;aeddb114-e1e5-4eb5-9570-227e25161fe8&quot;,&quot;parentUUID&quot;:&quot;a6d1e786-572d-444b-b86a-d6dfdc82abe2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Translation Error Handling\&quot;&quot;,&quot;fullTitle&quot;:&quot;Translation Error Handling \&quot;after each\&quot; hook in \&quot;Translation Error Handling\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.restore();\nif (translationManager) translationManager.destroy();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;450ed480-d623-4d81-941d-bd892c6da6b5&quot;,&quot;parentUUID&quot;:&quot;a6d1e786-572d-444b-b86a-d6dfdc82abe2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;bc61aff3-3bf8-4307-bd4f-6150e0e55a04&quot;,&quot;title&quot;:&quot;Service failure handling&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/error-handling/translation-error-handling.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/error-handling/translation-error-handling.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should handle all services failing&quot;,&quot;fullTitle&quot;:&quot;Translation Error Handling Service failure handling should handle all services failing&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Make all services fail\nfor (const service of Object.keys(translationManager.services)) {\n    sandbox.stub(translationManager.services[service], &#x27;translate&#x27;).rejects(\n        new Error(`${service} service error`)\n    );\n}\n// Try to translate\nconst result = await translationManager.translate(&#x27;Hello world&#x27;, &#x27;en&#x27;, &#x27;es&#x27;);\n// Should report failure\nexpect(result.success).to.be.false;\nexpect(result.error).to.exist;\nexpect(result.failedServices).to.be.an(&#x27;array&#x27;);\nexpect(result.failedServices.length).to.be.greaterThan(0);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b8300a4f-49e0-49c6-9de6-f185d2b18ce4&quot;,&quot;parentUUID&quot;:&quot;bc61aff3-3bf8-4307-bd4f-6150e0e55a04&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should use fallback when primary service fails&quot;,&quot;fullTitle&quot;:&quot;Translation Error Handling Service failure handling should use fallback when primary service fails&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Make primary service fail but leave fallbacks working\nconst primaryService = &#x27;deepl&#x27;;\nsandbox.stub(translationManager.languagePairOptimizer, &#x27;getBestServiceForLanguagePair&#x27;)\n    .returns(primaryService);\n// Make primary service fail\nsandbox.stub(translationManager.services[primaryService], &#x27;translate&#x27;).rejects(\n    new Error(&#x27;Service temporarily unavailable&#x27;)\n);\n// Try to translate\nconst result = await translationManager.translate(&#x27;Hello world&#x27;, &#x27;en&#x27;, &#x27;es&#x27;);\n// Should succeed using a fallback\nexpect(result.success).to.be.true;\nexpect(result.service).to.not.equal(primaryService);\nexpect(result.usedFallback).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5b3df8e2-1afc-4656-b2e4-8748f148242a&quot;,&quot;parentUUID&quot;:&quot;bc61aff3-3bf8-4307-bd4f-6150e0e55a04&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should handle intermittent failures&quot;,&quot;fullTitle&quot;:&quot;Translation Error Handling Service failure handling should handle intermittent failures&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Simulate service that fails half the time\nconst mockService = translationManager.services.deepl;\nlet callCount = 0;\nsandbox.stub(mockService, &#x27;translate&#x27;).callsFake(async (text, fromLang, toLang) =&gt; {\n    callCount++;\n    if (callCount % 2 === 1) {\n        throw new Error(&#x27;Intermittent failure&#x27;);\n    }\n    return {\n        translation: &#x27;Hola mundo&#x27;,\n        confidence: 0.9\n    };\n});\n// Force using this service\nsandbox.stub(translationManager.languagePairOptimizer, &#x27;getBestServiceForLanguagePair&#x27;)\n    .returns(&#x27;deepl&#x27;);\n// First call should fail, retry should succeed\nconst result = await translationManager.translate(&#x27;Hello world&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, {\n    retry: true, // Enable retry\n    maxRetries: 3\n});\n// Should succeed after retry\nexpect(result.success).to.be.true;\nexpect(result.translation).to.equal(&#x27;Hola mundo&#x27;);\nexpect(result.retryCount).to.be.greaterThan(0);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a728534f-d764-4175-acc6-1447788a5724&quot;,&quot;parentUUID&quot;:&quot;bc61aff3-3bf8-4307-bd4f-6150e0e55a04&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;b8300a4f-49e0-49c6-9de6-f185d2b18ce4&quot;,&quot;5b3df8e2-1afc-4656-b2e4-8748f148242a&quot;,&quot;a728534f-d764-4175-acc6-1447788a5724&quot;],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;cd423523-1655-4077-b543-a0e8dca7b691&quot;,&quot;title&quot;:&quot;Invalid input handling&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/error-handling/translation-error-handling.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/error-handling/translation-error-handling.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should handle empty text input&quot;,&quot;fullTitle&quot;:&quot;Translation Error Handling Invalid input handling should handle empty text input&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = await translationManager.translate(&#x27;&#x27;, &#x27;en&#x27;, &#x27;es&#x27;);\n// Should return quickly without calling services\nexpect(result.success).to.be.true;\nexpect(result.translation).to.equal(&#x27;&#x27;);\nexpect(result.skipped).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3e1a31b1-44b0-4d9a-a757-bc9cf66f4fb9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should handle invalid language codes&quot;,&quot;fullTitle&quot;:&quot;Translation Error Handling Invalid input handling should handle invalid language codes&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = await translationManager.translate(&#x27;Hello world&#x27;, &#x27;invalid&#x27;, &#x27;es&#x27;);\n// Should fail with error\nexpect(result.success).to.be.false;\nexpect(result.error).to.include(&#x27;language code&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b0a8890b-9cfe-45c5-9827-fb4fec2825e5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should handle very long input text&quot;,&quot;fullTitle&quot;:&quot;Translation Error Handling Invalid input handling should handle very long input text&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Generate a very long text (50KB)\nconst longText = &#x27;A&#x27;.repeat(50000);\n// Mock services to return truncated response\nfor (const service of Object.keys(translationManager.services)) {\n    sandbox.stub(translationManager.services[service], &#x27;translate&#x27;).callsFake(\n        async (text, fromLang, toLang) =&gt; {\n            // Simulate truncation\n            return {\n                translation: &#x27;Truncated translation&#x27;,\n                confidence: 0.7,\n                truncated: true\n            };\n        }\n    );\n}\nconst result = await translationManager.translate(longText, &#x27;en&#x27;, &#x27;es&#x27;);\n// Should succeed but indicate truncation\nexpect(result.success).to.be.true;\nexpect(result.truncated).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7015fe77-b708-4d27-8026-ac18fc1e00f1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should handle unsupported language pairs&quot;,&quot;fullTitle&quot;:&quot;Translation Error Handling Invalid input handling should handle unsupported language pairs&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock unsupported language detection\nsandbox.stub(translationManager, &#x27;isLanguagePairSupported&#x27;).returns(false);\nconst result = await translationManager.translate(&#x27;Hello&#x27;, &#x27;en&#x27;, &#x27;xx&#x27;);\n// Should fail with appropriate error\nexpect(result.success).to.be.false;\nexpect(result.error).to.include(&#x27;unsupported&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6439a819-145d-44ca-a094-6abdfbc83cb5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;3e1a31b1-44b0-4d9a-a757-bc9cf66f4fb9&quot;,&quot;b0a8890b-9cfe-45c5-9827-fb4fec2825e5&quot;,&quot;7015fe77-b708-4d27-8026-ac18fc1e00f1&quot;,&quot;6439a819-145d-44ca-a094-6abdfbc83cb5&quot;],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;a6776ce6-85e5-4f2a-9155-bed0fcfd7ed0&quot;,&quot;title&quot;:&quot;Network error handling&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/error-handling/translation-error-handling.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/error-handling/translation-error-handling.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should handle timeout errors&quot;,&quot;fullTitle&quot;:&quot;Translation Error Handling Network error handling should handle timeout errors&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stub services to time out\nfor (const service of Object.keys(translationManager.services)) {\n    sandbox.stub(translationManager.services[service], &#x27;translate&#x27;).callsFake(\n        async () =&gt; {\n            // Simulate timeout\n            await new Promise(resolve =&gt; setTimeout(resolve, 100));\n            throw new Error(&#x27;Request timed out&#x27;);\n        }\n    );\n}\n// Set a very short timeout\nconst result = await translationManager.translate(&#x27;Hello world&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, {\n    timeout: 50 // 50ms timeout (shorter than simulated delay)\n});\n// Should fail with timeout error\nexpect(result.success).to.be.false;\nexpect(result.error).to.include(&#x27;timed out&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;05b1d4c1-ac60-4ff8-82ae-8a5c2fe59e22&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should handle rate limit errors&quot;,&quot;fullTitle&quot;:&quot;Translation Error Handling Network error handling should handle rate limit errors&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stub services to return rate limit errors\nfor (const service of Object.keys(translationManager.services)) {\n    sandbox.stub(translationManager.services[service], &#x27;translate&#x27;).callsFake(\n        async () =&gt; {\n            const error = new Error(&#x27;Rate limit exceeded&#x27;);\n            error.code = 429; // Rate limit status code\n            throw error;\n        }\n    );\n}\nconst result = await translationManager.translate(&#x27;Hello world&#x27;, &#x27;en&#x27;, &#x27;es&#x27;);\n// Should fail with rate limit error\nexpect(result.success).to.be.false;\nexpect(result.error).to.include(&#x27;rate limit&#x27;);\nexpect(result.rateLimited).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8f78bd26-688c-4601-b6d9-f363cc7959a5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should handle network connectivity errors&quot;,&quot;fullTitle&quot;:&quot;Translation Error Handling Network error handling should handle network connectivity errors&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Stub services to return network errors\nfor (const service of Object.keys(translationManager.services)) {\n    sandbox.stub(translationManager.services[service], &#x27;translate&#x27;).callsFake(\n        async () =&gt; {\n            const error = new Error(&#x27;Network error&#x27;);\n            error.code = &#x27;ENOTFOUND&#x27;; // DNS lookup failure\n            throw error;\n        }\n    );\n}\nconst result = await translationManager.translate(&#x27;Hello world&#x27;, &#x27;en&#x27;, &#x27;es&#x27;);\n// Should fail with network error\nexpect(result.success).to.be.false;\nexpect(result.error).to.include(&#x27;network&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;56a920f2-9e7c-4415-b373-7b7a89a5743f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;05b1d4c1-ac60-4ff8-82ae-8a5c2fe59e22&quot;,&quot;8f78bd26-688c-4601-b6d9-f363cc7959a5&quot;,&quot;56a920f2-9e7c-4415-b373-7b7a89a5743f&quot;],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;b56e5375-78a1-416b-b0aa-265cbaa43607&quot;,&quot;title&quot;:&quot;Error recovery&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/error-handling/translation-error-handling.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/error-handling/translation-error-handling.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should recover automatically when service becomes available again&quot;,&quot;fullTitle&quot;:&quot;Translation Error Handling Error recovery should recover automatically when service becomes available again&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Service that fails first time but succeeds second time\nconst mockService = translationManager.services.deepl;\nlet callCount = 0;\nsandbox.stub(mockService, &#x27;translate&#x27;).callsFake(async (text, fromLang, toLang) =&gt; {\n    callCount++;\n    if (callCount === 1) {\n        throw new Error(&#x27;Service temporarily unavailable&#x27;);\n    }\n    return {\n        translation: &#x27;Hola mundo&#x27;,\n        confidence: 0.9\n    };\n});\n// Force using this service\nsandbox.stub(translationManager.languagePairOptimizer, &#x27;getBestServiceForLanguagePair&#x27;)\n    .returns(&#x27;deepl&#x27;);\n// First translation should fail\nconst result1 = await translationManager.translate(&#x27;Hello world&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, {\n    retry: false // Disable retry to simulate failure\n});\nexpect(result1.success).to.be.false;\n// Second translation should succeed\nconst result2 = await translationManager.translate(&#x27;Hello world&#x27;, &#x27;en&#x27;, &#x27;es&#x27;);\nexpect(result2.success).to.be.true;\nexpect(result2.translation).to.equal(&#x27;Hola mundo&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bcd2e664-b2da-4558-8d86-9ea1195372d6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should update service health status on failures&quot;,&quot;fullTitle&quot;:&quot;Translation Error Handling Error recovery should update service health status on failures&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock service that always fails\nconst mockService = translationManager.services.deepl;\nsandbox.stub(mockService, &#x27;translate&#x27;).rejects(new Error(&#x27;Service error&#x27;));\n// Force using this service\nsandbox.stub(translationManager.languagePairOptimizer, &#x27;getBestServiceForLanguagePair&#x27;)\n    .returns(&#x27;deepl&#x27;);\n// Try to translate (will fail)\nawait translationManager.translate(&#x27;Hello world&#x27;, &#x27;en&#x27;, &#x27;es&#x27;);\n// Service health should be updated\nexpect(mockService.healthy).to.be.false;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;24160843-4ed6-45cf-a9b2-a89475bbfcd5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should restore service health on successful translation&quot;,&quot;fullTitle&quot;:&quot;Translation Error Handling Error recovery should restore service health on successful translation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Set service as unhealthy\nconst mockService = translationManager.services.deepl;\nmockService.healthy = false;\n// Now make it succeed\nsandbox.stub(mockService, &#x27;translate&#x27;).resolves({\n    translation: &#x27;Hola mundo&#x27;,\n    confidence: 0.9\n});\n// Force using this service\nsandbox.stub(translationManager.languagePairOptimizer, &#x27;getBestServiceForLanguagePair&#x27;)\n    .returns(&#x27;deepl&#x27;);\n// Translate successfully\nawait translationManager.translate(&#x27;Hello world&#x27;, &#x27;en&#x27;, &#x27;es&#x27;);\n// Service health should be restored\nexpect(mockService.healthy).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ee7607b3-ea2d-44bd-a775-7c20701127ed&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;bcd2e664-b2da-4558-8d86-9ea1195372d6&quot;,&quot;24160843-4ed6-45cf-a9b2-a89475bbfcd5&quot;,&quot;ee7607b3-ea2d-44bd-a775-7c20701127ed&quot;],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;fae1108d-a2a2-4cbf-ab5a-db31e37cc222&quot;,&quot;title&quot;:&quot;PlatformDetector&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/platform-detector.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/platform-detector.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;PlatformDetector\&quot;&quot;,&quot;fullTitle&quot;:&quot;PlatformDetector \&quot;before each\&quot; hook in \&quot;PlatformDetector\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox = sinon.createSandbox();\nexecStub = sandbox.stub(require(&#x27;child_process&#x27;), &#x27;exec&#x27;);\nosStub = sandbox.stub(os, &#x27;platform&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e880f547-ff67-47a1-82bc-e730578b9154&quot;,&quot;parentUUID&quot;:&quot;fae1108d-a2a2-4cbf-ab5a-db31e37cc222&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;PlatformDetector\&quot;&quot;,&quot;fullTitle&quot;:&quot;PlatformDetector \&quot;after each\&quot; hook in \&quot;PlatformDetector\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;eb3bc7e1-d2fd-484e-96e3-9693ffa763a6&quot;,&quot;parentUUID&quot;:&quot;fae1108d-a2a2-4cbf-ab5a-db31e37cc222&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;34d26714-4c9a-4871-87de-49748c28f202&quot;,&quot;title&quot;:&quot;constructor&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/platform-detector.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/platform-detector.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should initialize with supported apps list&quot;,&quot;fullTitle&quot;:&quot;PlatformDetector constructor should initialize with supported apps list&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(PlatformDetector.supportedApps).to.be.an(&#x27;array&#x27;);\nexpect(PlatformDetector.supportedApps).to.include(&#x27;Discord&#x27;);\nexpect(PlatformDetector.supportedApps).to.include(&#x27;Zoom&#x27;);\nexpect(PlatformDetector.supportedApps).to.include(&#x27;Teams&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5a606849-d508-4677-8524-ebdf23ce4571&quot;,&quot;parentUUID&quot;:&quot;34d26714-4c9a-4871-87de-49748c28f202&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set platform property&quot;,&quot;fullTitle&quot;:&quot;PlatformDetector constructor should set platform property&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;osStub.returns(&#x27;win32&#x27;);\nconst detector = require(&#x27;../../../src/services/platform-detector&#x27;);\nexpect(detector.platform).to.equal(&#x27;win32&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;darwin&#x27; to equal &#x27;win32&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;darwin&#x27; to equal &#x27;win32&#x27;\n    at Context.&lt;anonymous&gt; (tests/unit/services/platform-detector.test.js:35:36)\n    at process.processImmediate (node:internal/timers:491:21)&quot;,&quot;diff&quot;:&quot;- darwin\n+ win32\n&quot;},&quot;uuid&quot;:&quot;e5734f92-82f4-4872-b588-127e81df12a7&quot;,&quot;parentUUID&quot;:&quot;34d26714-4c9a-4871-87de-49748c28f202&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5a606849-d508-4677-8524-ebdf23ce4571&quot;],&quot;failures&quot;:[&quot;e5734f92-82f4-4872-b588-127e81df12a7&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;9f08b4a2-8b12-4604-aae1-947dd1ffd7de&quot;,&quot;title&quot;:&quot;detectActiveApp&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/platform-detector.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/platform-detector.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should detect Discord on Windows&quot;,&quot;fullTitle&quot;:&quot;PlatformDetector detectActiveApp should detect Discord on Windows&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:97,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;osStub.returns(&#x27;win32&#x27;);\nexecStub.yields(null, &#x27;discord.exe&#x27;, &#x27;&#x27;);\n\nconst result = await PlatformDetector.detectActiveApp();\nexpect(result).to.equal(&#x27;Discord&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Telegram&#x27; to equal &#x27;Discord&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Telegram&#x27; to equal &#x27;Discord&#x27;\n    at Context.&lt;anonymous&gt; (tests/unit/services/platform-detector.test.js:45:25)&quot;,&quot;diff&quot;:&quot;- Telegram\n+ Discord\n&quot;},&quot;uuid&quot;:&quot;350076a9-d6a8-4546-aa31-cb3b8b67b501&quot;,&quot;parentUUID&quot;:&quot;9f08b4a2-8b12-4604-aae1-947dd1ffd7de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should detect Zoom on macOS&quot;,&quot;fullTitle&quot;:&quot;PlatformDetector detectActiveApp should detect Zoom on macOS&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:95,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;osStub.returns(&#x27;darwin&#x27;);\nexecStub.yields(null, &#x27;zoom.us&#x27;, &#x27;&#x27;);\n\nconst result = await PlatformDetector.detectActiveApp();\nexpect(result).to.equal(&#x27;Zoom&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Telegram&#x27; to equal &#x27;Zoom&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Telegram&#x27; to equal &#x27;Zoom&#x27;\n    at Context.&lt;anonymous&gt; (tests/unit/services/platform-detector.test.js:53:25)&quot;,&quot;diff&quot;:&quot;- Telegram\n+ Zoom\n&quot;},&quot;uuid&quot;:&quot;f486eff8-599c-433e-9a7c-5945d697182b&quot;,&quot;parentUUID&quot;:&quot;9f08b4a2-8b12-4604-aae1-947dd1ffd7de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should detect Teams on Linux&quot;,&quot;fullTitle&quot;:&quot;PlatformDetector detectActiveApp should detect Teams on Linux&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:100,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;osStub.returns(&#x27;linux&#x27;);\nexecStub.yields(null, &#x27;teams&#x27;, &#x27;&#x27;);\n\nconst result = await PlatformDetector.detectActiveApp();\nexpect(result).to.equal(&#x27;Teams&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Telegram&#x27; to equal &#x27;Teams&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Telegram&#x27; to equal &#x27;Teams&#x27;\n    at Context.&lt;anonymous&gt; (tests/unit/services/platform-detector.test.js:61:25)&quot;,&quot;diff&quot;:&quot;- Telegram\n+ Teams\n&quot;},&quot;uuid&quot;:&quot;84d047e0-9d44-4283-8e30-3c869d8703ca&quot;,&quot;parentUUID&quot;:&quot;9f08b4a2-8b12-4604-aae1-947dd1ffd7de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return null when no supported app is detected&quot;,&quot;fullTitle&quot;:&quot;PlatformDetector detectActiveApp should return null when no supported app is detected&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:85,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;osStub.returns(&#x27;win32&#x27;);\nexecStub.yields(null, &#x27;notepad.exe&#x27;, &#x27;&#x27;);\n\nconst result = await PlatformDetector.detectActiveApp();\nexpect(result).to.be.null;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Telegram&#x27; to be null&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Telegram&#x27; to be null\n    at Context.&lt;anonymous&gt; (tests/unit/services/platform-detector.test.js:69:27)&quot;},&quot;uuid&quot;:&quot;5dbb0b00-97a9-4472-a3e4-669db08c9b40&quot;,&quot;parentUUID&quot;:&quot;9f08b4a2-8b12-4604-aae1-947dd1ffd7de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle exec errors gracefully&quot;,&quot;fullTitle&quot;:&quot;PlatformDetector detectActiveApp should handle exec errors gracefully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:83,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;osStub.returns(&#x27;win32&#x27;);\nexecStub.yields(new Error(&#x27;Command failed&#x27;), &#x27;&#x27;, &#x27;&#x27;);\n\nconst result = await PlatformDetector.detectActiveApp();\nexpect(result).to.be.null;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Telegram&#x27; to be null&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Telegram&#x27; to be null\n    at Context.&lt;anonymous&gt; (tests/unit/services/platform-detector.test.js:77:27)&quot;},&quot;uuid&quot;:&quot;266a6722-9545-4c8c-ad72-f045f95894b9&quot;,&quot;parentUUID&quot;:&quot;9f08b4a2-8b12-4604-aae1-947dd1ffd7de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle unsupported platform&quot;,&quot;fullTitle&quot;:&quot;PlatformDetector detectActiveApp should handle unsupported platform&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:86,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;osStub.returns(&#x27;android&#x27;);\n\nconst result = await PlatformDetector.detectActiveApp();\nexpect(result).to.be.null;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Telegram&#x27; to be null&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Telegram&#x27; to be null\n    at Context.&lt;anonymous&gt; (tests/unit/services/platform-detector.test.js:84:27)&quot;},&quot;uuid&quot;:&quot;2b1572d4-a2ff-434c-83a1-f1a8e5d83d31&quot;,&quot;parentUUID&quot;:&quot;9f08b4a2-8b12-4604-aae1-947dd1ffd7de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;350076a9-d6a8-4546-aa31-cb3b8b67b501&quot;,&quot;f486eff8-599c-433e-9a7c-5945d697182b&quot;,&quot;84d047e0-9d44-4283-8e30-3c869d8703ca&quot;,&quot;5dbb0b00-97a9-4472-a3e4-669db08c9b40&quot;,&quot;266a6722-9545-4c8c-ad72-f045f95894b9&quot;,&quot;2b1572d4-a2ff-434c-83a1-f1a8e5d83d31&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:546,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;dfaed4b6-4208-467e-b5ef-c1f5051a3167&quot;,&quot;title&quot;:&quot;getAppConfig&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/platform-detector.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/platform-detector.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return Discord configuration&quot;,&quot;fullTitle&quot;:&quot;PlatformDetector getAppConfig should return Discord configuration&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const config = PlatformDetector.getAppConfig(&#x27;Discord&#x27;);\nexpect(config).to.deep.include({\n  inputDevice: &#x27;CABLE Input&#x27;,\n  outputDevice: &#x27;CABLE Output&#x27;,\n  sampleRate: 48000,\n  channels: 2,\n  priority: &#x27;high&#x27;\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c055c680-ae2d-4bd4-b035-f33f75fc1d25&quot;,&quot;parentUUID&quot;:&quot;dfaed4b6-4208-467e-b5ef-c1f5051a3167&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return Zoom configuration&quot;,&quot;fullTitle&quot;:&quot;PlatformDetector getAppConfig should return Zoom configuration&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const config = PlatformDetector.getAppConfig(&#x27;Zoom&#x27;);\nexpect(config).to.deep.include({\n  inputDevice: &#x27;CABLE Input&#x27;,\n  outputDevice: &#x27;CABLE Output&#x27;,\n  sampleRate: 16000,\n  channels: 1,\n  priority: &#x27;high&#x27;\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2efd5d11-e13f-4746-a52e-dd2275d06370&quot;,&quot;parentUUID&quot;:&quot;dfaed4b6-4208-467e-b5ef-c1f5051a3167&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return null for unsupported app&quot;,&quot;fullTitle&quot;:&quot;PlatformDetector getAppConfig should return null for unsupported app&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const config = PlatformDetector.getAppConfig(&#x27;Notepad&#x27;);\nexpect(config).to.be.null;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0eca299b-1cca-4212-a446-1aaa3e270e49&quot;,&quot;parentUUID&quot;:&quot;dfaed4b6-4208-467e-b5ef-c1f5051a3167&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c055c680-ae2d-4bd4-b035-f33f75fc1d25&quot;,&quot;2efd5d11-e13f-4746-a52e-dd2275d06370&quot;,&quot;0eca299b-1cca-4212-a446-1aaa3e270e49&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;bd50dffb-4f02-41eb-b6d8-f1950f4e991c&quot;,&quot;title&quot;:&quot;configureAudioRouting&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/platform-detector.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/platform-detector.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should configure audio routing for Discord&quot;,&quot;fullTitle&quot;:&quot;PlatformDetector configureAudioRouting should configure audio routing for Discord&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const applyRoutingStub = sandbox.stub(PlatformDetector, &#x27;applyAudioRouting&#x27;);\n\nawait PlatformDetector.configureAudioRouting(&#x27;Discord&#x27;);\n\nexpect(applyRoutingStub.calledOnce).to.be.true;\nexpect(applyRoutingStub.firstCall.args[0]).to.deep.include({\n  inputDevice: &#x27;CABLE Input&#x27;,\n  outputDevice: &#x27;CABLE Output&#x27;\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;63f71974-7152-447f-908e-8ff3a5abc2c7&quot;,&quot;parentUUID&quot;:&quot;bd50dffb-4f02-41eb-b6d8-f1950f4e991c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle unsupported app gracefully&quot;,&quot;fullTitle&quot;:&quot;PlatformDetector configureAudioRouting should handle unsupported app gracefully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const applyRoutingStub = sandbox.stub(PlatformDetector, &#x27;applyAudioRouting&#x27;);\n\nawait PlatformDetector.configureAudioRouting(&#x27;Notepad&#x27;);\n\nexpect(applyRoutingStub.called).to.be.false;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5f63a50c-f448-49ce-a3c1-8aac20d94725&quot;,&quot;parentUUID&quot;:&quot;bd50dffb-4f02-41eb-b6d8-f1950f4e991c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle errors gracefully&quot;,&quot;fullTitle&quot;:&quot;PlatformDetector configureAudioRouting should handle errors gracefully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.stub(PlatformDetector, &#x27;getAppConfig&#x27;).throws(new Error(&#x27;Config error&#x27;));\n\n// Should not throw\nawait PlatformDetector.configureAudioRouting(&#x27;Discord&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;52f4127d-73a2-4e9d-8326-d2fb973e57e4&quot;,&quot;parentUUID&quot;:&quot;bd50dffb-4f02-41eb-b6d8-f1950f4e991c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;63f71974-7152-447f-908e-8ff3a5abc2c7&quot;,&quot;5f63a50c-f448-49ce-a3c1-8aac20d94725&quot;,&quot;52f4127d-73a2-4e9d-8326-d2fb973e57e4&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;1e98122d-8de8-470e-9c3b-7dee81e30752&quot;,&quot;title&quot;:&quot;applyAudioRouting&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/platform-detector.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/platform-detector.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should call Windows routing for win32 platform&quot;,&quot;fullTitle&quot;:&quot;PlatformDetector applyAudioRouting should call Windows routing for win32 platform&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;osStub.returns(&#x27;win32&#x27;);\nconst windowsStub = sandbox.stub(PlatformDetector, &#x27;applyWindowsAudioRouting&#x27;);\n\nawait PlatformDetector.applyAudioRouting({ inputDevice: &#x27;test&#x27;, outputDevice: &#x27;test&#x27; });\n\nexpect(windowsStub.calledOnce).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected false to be true&quot;,&quot;estack&quot;:&quot;AssertionError: expected false to be true\n    at Context.&lt;anonymous&gt; (tests/unit/services/platform-detector.test.js:153:43)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;,&quot;diff&quot;:&quot;- false\n+ true\n&quot;},&quot;uuid&quot;:&quot;97fa3fb1-9372-4906-99c6-d508d11c9bf3&quot;,&quot;parentUUID&quot;:&quot;1e98122d-8de8-470e-9c3b-7dee81e30752&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should call macOS routing for darwin platform&quot;,&quot;fullTitle&quot;:&quot;PlatformDetector applyAudioRouting should call macOS routing for darwin platform&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;osStub.returns(&#x27;darwin&#x27;);\nconst macStub = sandbox.stub(PlatformDetector, &#x27;applyMacAudioRouting&#x27;);\n\nawait PlatformDetector.applyAudioRouting({ inputDevice: &#x27;test&#x27;, outputDevice: &#x27;test&#x27; });\n\nexpect(macStub.calledOnce).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;15d90037-4bbb-4b82-a2ba-6db2205acd2a&quot;,&quot;parentUUID&quot;:&quot;1e98122d-8de8-470e-9c3b-7dee81e30752&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should call Linux routing for linux platform&quot;,&quot;fullTitle&quot;:&quot;PlatformDetector applyAudioRouting should call Linux routing for linux platform&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;osStub.returns(&#x27;linux&#x27;);\nconst linuxStub = sandbox.stub(PlatformDetector, &#x27;applyLinuxAudioRouting&#x27;);\n\nawait PlatformDetector.applyAudioRouting({ inputDevice: &#x27;test&#x27;, outputDevice: &#x27;test&#x27; });\n\nexpect(linuxStub.calledOnce).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected false to be true&quot;,&quot;estack&quot;:&quot;AssertionError: expected false to be true\n    at Context.&lt;anonymous&gt; (tests/unit/services/platform-detector.test.js:171:41)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;,&quot;diff&quot;:&quot;- false\n+ true\n&quot;},&quot;uuid&quot;:&quot;821d0d64-1f08-4224-aaa4-f74909051c31&quot;,&quot;parentUUID&quot;:&quot;1e98122d-8de8-470e-9c3b-7dee81e30752&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;15d90037-4bbb-4b82-a2ba-6db2205acd2a&quot;],&quot;failures&quot;:[&quot;97fa3fb1-9372-4906-99c6-d508d11c9bf3&quot;,&quot;821d0d64-1f08-4224-aaa4-f74909051c31&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;ddca19e0-f2a3-4b82-8986-0974704cddf2&quot;,&quot;title&quot;:&quot;applyWindowsAudioRouting&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/platform-detector.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/platform-detector.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should execute PowerShell commands for Windows audio routing&quot;,&quot;fullTitle&quot;:&quot;PlatformDetector applyWindowsAudioRouting should execute PowerShell commands for Windows audio routing&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;osStub.returns(&#x27;win32&#x27;);\nexecStub.yields(null, &#x27;&#x27;, &#x27;&#x27;);\n\nawait PlatformDetector.applyWindowsAudioRouting({\n  inputDevice: &#x27;CABLE Input&#x27;,\n  outputDevice: &#x27;CABLE Output&#x27;\n});\n\nexpect(execStub.calledTwice).to.be.true;\nexpect(execStub.firstCall.args[0]).to.include(&#x27;Set-AudioDevice&#x27;);\nexpect(execStub.secondCall.args[0]).to.include(&#x27;Set-AudioDevice&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected false to be true&quot;,&quot;estack&quot;:&quot;AssertionError: expected false to be true\n    at Context.&lt;anonymous&gt; (tests/unit/services/platform-detector.test.js:185:41)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;,&quot;diff&quot;:&quot;- false\n+ true\n&quot;},&quot;uuid&quot;:&quot;08b9e2b9-3ad6-43e9-b9b0-c7096bbfe93d&quot;,&quot;parentUUID&quot;:&quot;ddca19e0-f2a3-4b82-8986-0974704cddf2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle Windows routing errors&quot;,&quot;fullTitle&quot;:&quot;PlatformDetector applyWindowsAudioRouting should handle Windows routing errors&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;osStub.returns(&#x27;win32&#x27;);\nexecStub.yields(new Error(&#x27;PowerShell error&#x27;), &#x27;&#x27;, &#x27;&#x27;);\n\n// Should not throw\nawait PlatformDetector.applyWindowsAudioRouting({\n  inputDevice: &#x27;CABLE Input&#x27;,\n  outputDevice: &#x27;CABLE Output&#x27;\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6e4a4945-0aa1-4c54-b493-a3d418ef80a4&quot;,&quot;parentUUID&quot;:&quot;ddca19e0-f2a3-4b82-8986-0974704cddf2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6e4a4945-0aa1-4c54-b493-a3d418ef80a4&quot;],&quot;failures&quot;:[&quot;08b9e2b9-3ad6-43e9-b9b0-c7096bbfe93d&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:11,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;879d9f56-424c-41c2-a2ba-b682beda56f0&quot;,&quot;title&quot;:&quot;applyLinuxAudioRouting&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/platform-detector.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/platform-detector.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should execute pactl commands for Linux audio routing&quot;,&quot;fullTitle&quot;:&quot;PlatformDetector applyLinuxAudioRouting should execute pactl commands for Linux audio routing&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;osStub.returns(&#x27;linux&#x27;);\nexecStub.yields(null, &#x27;&#x27;, &#x27;&#x27;);\n\nawait PlatformDetector.applyLinuxAudioRouting({\n  inputDevice: &#x27;CABLE Input&#x27;,\n  outputDevice: &#x27;CABLE Output&#x27;\n});\n\nexpect(execStub.calledTwice).to.be.true;\nexpect(execStub.firstCall.args[0]).to.include(&#x27;pactl set-default-sink&#x27;);\nexpect(execStub.secondCall.args[0]).to.include(&#x27;pactl set-default-source&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected false to be true&quot;,&quot;estack&quot;:&quot;AssertionError: expected false to be true\n    at Context.&lt;anonymous&gt; (tests/unit/services/platform-detector.test.js:212:41)&quot;,&quot;diff&quot;:&quot;- false\n+ true\n&quot;},&quot;uuid&quot;:&quot;bd4e6d5d-161b-4a90-9244-052b05504f6f&quot;,&quot;parentUUID&quot;:&quot;879d9f56-424c-41c2-a2ba-b682beda56f0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle Linux routing errors&quot;,&quot;fullTitle&quot;:&quot;PlatformDetector applyLinuxAudioRouting should handle Linux routing errors&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;osStub.returns(&#x27;linux&#x27;);\nexecStub.yields(new Error(&#x27;pactl error&#x27;), &#x27;&#x27;, &#x27;&#x27;);\n\n// Should not throw\nawait PlatformDetector.applyLinuxAudioRouting({\n  inputDevice: &#x27;CABLE Input&#x27;,\n  outputDevice: &#x27;CABLE Output&#x27;\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2ac6a0c4-2808-4dac-93dc-1612e3478abc&quot;,&quot;parentUUID&quot;:&quot;879d9f56-424c-41c2-a2ba-b682beda56f0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2ac6a0c4-2808-4dac-93dc-1612e3478abc&quot;],&quot;failures&quot;:[&quot;bd4e6d5d-161b-4a90-9244-052b05504f6f&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:10,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;0309c3c3-6af1-4913-850b-512a55c91d6b&quot;,&quot;title&quot;:&quot;applyMacAudioRouting&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/platform-detector.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/platform-detector.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should log configuration for macOS&quot;,&quot;fullTitle&quot;:&quot;PlatformDetector applyMacAudioRouting should log configuration for macOS&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;osStub.returns(&#x27;darwin&#x27;);\nconst consoleStub = sandbox.stub(console, &#x27;log&#x27;);\n\nawait PlatformDetector.applyMacAudioRouting({\n  inputDevice: &#x27;CABLE Input&#x27;,\n  outputDevice: &#x27;CABLE Output&#x27;\n});\n\nexpect(consoleStub.called).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f5ea37bc-a6a0-4f39-b74e-144aaac639d6&quot;,&quot;parentUUID&quot;:&quot;0309c3c3-6af1-4913-850b-512a55c91d6b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f5ea37bc-a6a0-4f39-b74e-144aaac639d6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;d068a4cd-e568-4b13-8ceb-627596ef9c92&quot;,&quot;title&quot;:&quot;Setup Automation Service&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/setup-automation.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/setup-automation.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Setup Automation Service\&quot;&quot;,&quot;fullTitle&quot;:&quot;Setup Automation Service \&quot;before each\&quot; hook in \&quot;Setup Automation Service\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Create mocks\nmockChildProcess = {\n  exec: sinon.stub(),\n  spawn: sinon.stub()\n};\nmockFs = {\n  existsSync: sinon.stub(),\n  mkdirSync: sinon.stub(),\n  writeFileSync: sinon.stub(),\n  readFileSync: sinon.stub(),\n  copyFileSync: sinon.stub()\n};\nmockPath = {\n  join: sinon.stub(),\n  resolve: sinon.stub(),\n  dirname: sinon.stub()\n};\nmockOs = {\n  platform: sinon.stub().returns(&#x27;darwin&#x27;),\n  type: sinon.stub().returns(&#x27;Darwin&#x27;),\n  release: sinon.stub().returns(&#x27;20.0.0&#x27;)\n};\n// Mock the setup automation service\nsetupAutomation = proxyquire(&#x27;../../../src/services/setup-automation&#x27;, {\n  &#x27;child_process&#x27;: mockChildProcess,\n  &#x27;fs&#x27;: mockFs,\n  &#x27;path&#x27;: mockPath,\n  &#x27;os&#x27;: mockOs\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c97cefef-9cde-49e4-8ab4-c2c122e105f8&quot;,&quot;parentUUID&quot;:&quot;d068a4cd-e568-4b13-8ceb-627596ef9c92&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Setup Automation Service\&quot;&quot;,&quot;fullTitle&quot;:&quot;Setup Automation Service \&quot;after each\&quot; hook in \&quot;Setup Automation Service\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3322d8b6-0222-49fb-b1ec-71fe8fc6702d&quot;,&quot;parentUUID&quot;:&quot;d068a4cd-e568-4b13-8ceb-627596ef9c92&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;57477b55-ccd9-454f-9b97-9325932e36db&quot;,&quot;title&quot;:&quot;Platform Detection&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/setup-automation.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/setup-automation.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should detect macOS correctly&quot;,&quot;fullTitle&quot;:&quot;Setup Automation Service Platform Detection should detect macOS correctly&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockOs.platform.returns(&#x27;darwin&#x27;);\nconst platform = setupAutomation.detectPlatform();\nexpect(platform).to.equal(&#x27;macos&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: setupAutomation.detectPlatform is not a function&quot;,&quot;estack&quot;:&quot;TypeError: setupAutomation.detectPlatform is not a function\n    at Context.&lt;anonymous&gt; (tests/unit/services/setup-automation.test.js:55:40)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;e843ffdd-0801-4734-8cc6-5beab47705b5&quot;,&quot;parentUUID&quot;:&quot;57477b55-ccd9-454f-9b97-9325932e36db&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should detect Windows correctly&quot;,&quot;fullTitle&quot;:&quot;Setup Automation Service Platform Detection should detect Windows correctly&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockOs.platform.returns(&#x27;win32&#x27;);\nconst platform = setupAutomation.detectPlatform();\nexpect(platform).to.equal(&#x27;windows&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: setupAutomation.detectPlatform is not a function&quot;,&quot;estack&quot;:&quot;TypeError: setupAutomation.detectPlatform is not a function\n    at Context.&lt;anonymous&gt; (tests/unit/services/setup-automation.test.js:61:40)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;c1e06104-b246-4ead-942a-98567cf0e859&quot;,&quot;parentUUID&quot;:&quot;57477b55-ccd9-454f-9b97-9325932e36db&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should detect Linux correctly&quot;,&quot;fullTitle&quot;:&quot;Setup Automation Service Platform Detection should detect Linux correctly&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockOs.platform.returns(&#x27;linux&#x27;);\nconst platform = setupAutomation.detectPlatform();\nexpect(platform).to.equal(&#x27;linux&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: setupAutomation.detectPlatform is not a function&quot;,&quot;estack&quot;:&quot;TypeError: setupAutomation.detectPlatform is not a function\n    at Context.&lt;anonymous&gt; (tests/unit/services/setup-automation.test.js:67:40)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;7a1f466d-e897-4f24-9d4e-f2419df20e48&quot;,&quot;parentUUID&quot;:&quot;57477b55-ccd9-454f-9b97-9325932e36db&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should throw error for unsupported platform&quot;,&quot;fullTitle&quot;:&quot;Setup Automation Service Platform Detection should throw error for unsupported platform&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockOs.platform.returns(&#x27;freebsd&#x27;);\nexpect(() =&gt; setupAutomation.detectPlatform()).to.throw(&#x27;Unsupported platform: freebsd&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected [Function] to throw error including &#x27;Unsupported platform: freebsd&#x27; but got &#x27;setupAutomation.detectPlatform is not&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected [Function] to throw error including &#x27;Unsupported platform: freebsd&#x27; but got &#x27;setupAutomation.detectPlatform is not&#x27;\n    at Context.&lt;anonymous&gt; (tests/unit/services/setup-automation.test.js:73:62)\n    at process.processImmediate (node:internal/timers:491:21)&quot;,&quot;diff&quot;:&quot;- setupAutomation.detectPlatform is not a function\n+ Unsupported platform: freebsd\n&quot;},&quot;uuid&quot;:&quot;1e7937f0-7faa-4ba1-8c80-7bae2adbf045&quot;,&quot;parentUUID&quot;:&quot;57477b55-ccd9-454f-9b97-9325932e36db&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;e843ffdd-0801-4734-8cc6-5beab47705b5&quot;,&quot;c1e06104-b246-4ead-942a-98567cf0e859&quot;,&quot;7a1f466d-e897-4f24-9d4e-f2419df20e48&quot;,&quot;1e7937f0-7faa-4ba1-8c80-7bae2adbf045&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;42a4848d-94e4-4e9a-93ed-0b24f72e9a3f&quot;,&quot;title&quot;:&quot;Virtual Audio Installation&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/setup-automation.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/setup-automation.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should install VB-Audio Cable on Windows&quot;,&quot;fullTitle&quot;:&quot;Setup Automation Service Virtual Audio Installation should install VB-Audio Cable on Windows&quot;,&quot;timedOut&quot;:true,&quot;duration&quot;:5002,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockOs.platform.returns(&#x27;win32&#x27;);\nmockChildProcess.exec.resolves({ stdout: &#x27;success&#x27;, stderr: &#x27;&#x27; });\nconst result = await setupAutomation.installVirtualAudio();\n\nexpect(result.success).to.be.true;\nexpect(result.platform).to.equal(&#x27;windows&#x27;);\nexpect(result.method).to.equal(&#x27;vb-audio-cable&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Timeout of 5000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/setup-automation.test.js)&quot;,&quot;estack&quot;:&quot;Error: Timeout of 5000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/setup-automation.test.js)\n    at listOnTimeout (node:internal/timers:594:17)\n    at process.processTimers (node:internal/timers:529:7)&quot;},&quot;uuid&quot;:&quot;e9741224-d59f-43b7-849e-d5eb456aff6a&quot;,&quot;parentUUID&quot;:&quot;42a4848d-94e4-4e9a-93ed-0b24f72e9a3f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should install BlackHole on macOS&quot;,&quot;fullTitle&quot;:&quot;Setup Automation Service Virtual Audio Installation should install BlackHole on macOS&quot;,&quot;timedOut&quot;:true,&quot;duration&quot;:5001,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockOs.platform.returns(&#x27;darwin&#x27;);\nmockChildProcess.exec.resolves({ stdout: &#x27;success&#x27;, stderr: &#x27;&#x27; });\nconst result = await setupAutomation.installVirtualAudio();\n\nexpect(result.success).to.be.true;\nexpect(result.platform).to.equal(&#x27;macos&#x27;);\nexpect(result.method).to.equal(&#x27;blackhole&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Timeout of 5000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/setup-automation.test.js)&quot;,&quot;estack&quot;:&quot;Error: Timeout of 5000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/setup-automation.test.js)\n    at listOnTimeout (node:internal/timers:594:17)\n    at process.processTimers (node:internal/timers:529:7)&quot;},&quot;uuid&quot;:&quot;29f2e093-bbd4-4cd7-a210-85119638906c&quot;,&quot;parentUUID&quot;:&quot;42a4848d-94e4-4e9a-93ed-0b24f72e9a3f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should create PulseAudio virtual sinks on Linux&quot;,&quot;fullTitle&quot;:&quot;Setup Automation Service Virtual Audio Installation should create PulseAudio virtual sinks on Linux&quot;,&quot;timedOut&quot;:true,&quot;duration&quot;:5001,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockOs.platform.returns(&#x27;linux&#x27;);\nmockChildProcess.exec.resolves({ stdout: &#x27;success&#x27;, stderr: &#x27;&#x27; });\nconst result = await setupAutomation.installVirtualAudio();\n\nexpect(result.success).to.be.true;\nexpect(result.platform).to.equal(&#x27;linux&#x27;);\nexpect(result.method).to.equal(&#x27;pulseaudio&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Timeout of 5000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/setup-automation.test.js)&quot;,&quot;estack&quot;:&quot;Error: Timeout of 5000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/setup-automation.test.js)\n    at listOnTimeout (node:internal/timers:594:17)\n    at process.processTimers (node:internal/timers:529:7)&quot;},&quot;uuid&quot;:&quot;53ee53ff-069c-4522-ae5a-2054d48f466c&quot;,&quot;parentUUID&quot;:&quot;42a4848d-94e4-4e9a-93ed-0b24f72e9a3f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle installation errors&quot;,&quot;fullTitle&quot;:&quot;Setup Automation Service Virtual Audio Installation should handle installation errors&quot;,&quot;timedOut&quot;:true,&quot;duration&quot;:5002,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockOs.platform.returns(&#x27;win32&#x27;);\nmockChildProcess.exec.rejects(new Error(&#x27;Installation failed&#x27;));\nconst result = await setupAutomation.installVirtualAudio();\n\nexpect(result.success).to.be.false;\nexpect(result.error).to.include(&#x27;Installation failed&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Timeout of 5000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/setup-automation.test.js)&quot;,&quot;estack&quot;:&quot;Error: Timeout of 5000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/setup-automation.test.js)\n    at listOnTimeout (node:internal/timers:594:17)\n    at process.processTimers (node:internal/timers:529:7)&quot;},&quot;uuid&quot;:&quot;c8b0a0f8-a47a-4b85-a485-136e07602a65&quot;,&quot;parentUUID&quot;:&quot;42a4848d-94e4-4e9a-93ed-0b24f72e9a3f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;e9741224-d59f-43b7-849e-d5eb456aff6a&quot;,&quot;29f2e093-bbd4-4cd7-a210-85119638906c&quot;,&quot;53ee53ff-069c-4522-ae5a-2054d48f466c&quot;,&quot;c8b0a0f8-a47a-4b85-a485-136e07602a65&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:20006,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;a4a2a76b-ebc7-47ad-b660-2164705df96d&quot;,&quot;title&quot;:&quot;Audio Device Configuration&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/setup-automation.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/setup-automation.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should configure audio devices successfully&quot;,&quot;fullTitle&quot;:&quot;Setup Automation Service Audio Device Configuration should configure audio devices successfully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockChildProcess.exec.resolves({ stdout: &#x27;devices configured&#x27;, stderr: &#x27;&#x27; });\nmockFs.existsSync.returns(true);\nconst result = await setupAutomation.configureAudioDevices();\n\nexpect(result.success).to.be.true;\nexpect(result.devices).to.be.an(&#x27;object&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected undefined to be an object&quot;,&quot;estack&quot;:&quot;AssertionError: expected undefined to be an object\n    at Context.&lt;anonymous&gt; (tests/unit/services/setup-automation.test.js:130:36)&quot;},&quot;uuid&quot;:&quot;1558c0f5-14a6-4c38-9761-1d4edba1003a&quot;,&quot;parentUUID&quot;:&quot;a4a2a76b-ebc7-47ad-b660-2164705df96d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle device configuration errors&quot;,&quot;fullTitle&quot;:&quot;Setup Automation Service Audio Device Configuration should handle device configuration errors&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockChildProcess.exec.rejects(new Error(&#x27;Device configuration failed&#x27;));\nconst result = await setupAutomation.configureAudioDevices();\n\nexpect(result.success).to.be.false;\nexpect(result.error).to.include(&#x27;Device configuration failed&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected true to be false&quot;,&quot;estack&quot;:&quot;AssertionError: expected true to be false\n    at Context.&lt;anonymous&gt; (tests/unit/services/setup-automation.test.js:138:35)&quot;,&quot;diff&quot;:&quot;- true\n+ false\n&quot;},&quot;uuid&quot;:&quot;06ae71ae-5d5b-4e89-8eae-c4c2c7f33019&quot;,&quot;parentUUID&quot;:&quot;a4a2a76b-ebc7-47ad-b660-2164705df96d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;1558c0f5-14a6-4c38-9761-1d4edba1003a&quot;,&quot;06ae71ae-5d5b-4e89-8eae-c4c2c7f33019&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;0649878b-08ab-4053-809c-d48158149452&quot;,&quot;title&quot;:&quot;Communication App Configuration&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/setup-automation.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/setup-automation.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should configure Discord settings&quot;,&quot;fullTitle&quot;:&quot;Setup Automation Service Communication App Configuration should configure Discord settings&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:99,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockFs.existsSync.returns(true);\nmockFs.readFileSync.returns(&#x27;{\&quot;voice\&quot;: {\&quot;inputDevice\&quot;: \&quot;default\&quot;}}&#x27;);\nmockFs.writeFileSync.returns();\nconst result = await setupAutomation.configureCommunicationApps([&#x27;discord&#x27;]);\n\nexpect(result.success).to.be.true;\nexpect(result.apps).to.include(&#x27;discord&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: the given combination of arguments (undefined and string) is invalid for this assertion. You can use an array, a map, an object, a set, a string, or a weakset instead of a string&quot;,&quot;estack&quot;:&quot;AssertionError: the given combination of arguments (undefined and string) is invalid for this assertion. You can use an array, a map, an object, a set, a string, or a weakset instead of a string\n    at Context.&lt;anonymous&gt; (tests/unit/services/setup-automation.test.js:152:30)&quot;},&quot;uuid&quot;:&quot;85f2bd85-6297-4a40-a109-87d7f6e5e576&quot;,&quot;parentUUID&quot;:&quot;0649878b-08ab-4053-809c-d48158149452&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should configure Zoom settings&quot;,&quot;fullTitle&quot;:&quot;Setup Automation Service Communication App Configuration should configure Zoom settings&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:90,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockFs.existsSync.returns(true);\nmockFs.readFileSync.returns(&#x27;{\&quot;audio\&quot;: {\&quot;microphone\&quot;: \&quot;default\&quot;}}&#x27;);\nmockFs.writeFileSync.returns();\nconst result = await setupAutomation.configureCommunicationApps([&#x27;zoom&#x27;]);\n\nexpect(result.success).to.be.true;\nexpect(result.apps).to.include(&#x27;zoom&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: the given combination of arguments (undefined and string) is invalid for this assertion. You can use an array, a map, an object, a set, a string, or a weakset instead of a string&quot;,&quot;estack&quot;:&quot;AssertionError: the given combination of arguments (undefined and string) is invalid for this assertion. You can use an array, a map, an object, a set, a string, or a weakset instead of a string\n    at Context.&lt;anonymous&gt; (tests/unit/services/setup-automation.test.js:163:30)&quot;},&quot;uuid&quot;:&quot;95579f0c-adf8-4d70-9e59-575909adde6b&quot;,&quot;parentUUID&quot;:&quot;0649878b-08ab-4053-809c-d48158149452&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle app configuration errors&quot;,&quot;fullTitle&quot;:&quot;Setup Automation Service Communication App Configuration should handle app configuration errors&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:83,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockFs.existsSync.returns(false);\nconst result = await setupAutomation.configureCommunicationApps([&#x27;nonexistent&#x27;]);\n\nexpect(result.success).to.be.false;\nexpect(result.error).to.include(&#x27;App not found&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected true to be false&quot;,&quot;estack&quot;:&quot;AssertionError: expected true to be false\n    at Context.&lt;anonymous&gt; (tests/unit/services/setup-automation.test.js:171:35)&quot;,&quot;diff&quot;:&quot;- true\n+ false\n&quot;},&quot;uuid&quot;:&quot;bb4743a9-c46e-4987-a2c6-63f6b81aa0b0&quot;,&quot;parentUUID&quot;:&quot;0649878b-08ab-4053-809c-d48158149452&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;85f2bd85-6297-4a40-a109-87d7f6e5e576&quot;,&quot;95579f0c-adf8-4d70-9e59-575909adde6b&quot;,&quot;bb4743a9-c46e-4987-a2c6-63f6b81aa0b0&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:272,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;96ad6769-f801-4a88-b498-fde443368880&quot;,&quot;title&quot;:&quot;Configuration File Creation&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/setup-automation.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/setup-automation.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should create configuration files successfully&quot;,&quot;fullTitle&quot;:&quot;Setup Automation Service Configuration File Creation should create configuration files successfully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockPath.join.returns(&#x27;/config/path&#x27;);\nmockFs.writeFileSync.returns();\nconst config = {\n  translation: { service: &#x27;deepl&#x27; },\n  audio: { inputDevice: &#x27;microphone&#x27; }\n};\nconst result = await setupAutomation.createConfigurationFiles(config);\n\nexpect(result.success).to.be.true;\nexpect(result.files).to.be.an(&#x27;array&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected false to be true&quot;,&quot;estack&quot;:&quot;AssertionError: expected false to be true\n    at Context.&lt;anonymous&gt; (tests/unit/services/setup-automation.test.js:188:35)&quot;,&quot;diff&quot;:&quot;- false\n+ true\n&quot;},&quot;uuid&quot;:&quot;f16c5fa8-a879-4fb6-86f2-2b978e5fd71d&quot;,&quot;parentUUID&quot;:&quot;96ad6769-f801-4a88-b498-fde443368880&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle configuration file creation errors&quot;,&quot;fullTitle&quot;:&quot;Setup Automation Service Configuration File Creation should handle configuration file creation errors&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockPath.join.returns(&#x27;/config/path&#x27;);\nmockFs.writeFileSync.throws(new Error(&#x27;Write failed&#x27;));\nconst config = { translation: { service: &#x27;deepl&#x27; } };\nconst result = await setupAutomation.createConfigurationFiles(config);\n\nexpect(result.success).to.be.false;\nexpect(result.error).to.include(&#x27;Write failed&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;ENOENT: no such file or directory, mk&#x27; to include &#x27;Write failed&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;ENOENT: no such file or directory, mk&#x27; to include &#x27;Write failed&#x27;\n    at Context.&lt;anonymous&gt; (tests/unit/services/setup-automation.test.js:201:31)&quot;},&quot;uuid&quot;:&quot;de5270c8-b0e4-4ebd-aa53-b52dde1d4029&quot;,&quot;parentUUID&quot;:&quot;96ad6769-f801-4a88-b498-fde443368880&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;f16c5fa8-a879-4fb6-86f2-2b978e5fd71d&quot;,&quot;de5270c8-b0e4-4ebd-aa53-b52dde1d4029&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;322e249e-2eb1-4905-8737-8d94122bb683&quot;,&quot;title&quot;:&quot;Complete Setup Process&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/setup-automation.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/setup-automation.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should run complete setup successfully&quot;,&quot;fullTitle&quot;:&quot;Setup Automation Service Complete Setup Process should run complete setup successfully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockOs.platform.returns(&#x27;darwin&#x27;);\nmockChildProcess.exec.resolves({ stdout: &#x27;success&#x27;, stderr: &#x27;&#x27; });\nmockFs.existsSync.returns(true);\nmockFs.writeFileSync.returns();\nconst result = await setupAutomation.runCompleteSetup();\n\nexpect(result.success).to.be.true;\nexpect(result.steps).to.be.an(&#x27;array&#x27;);\nexpect(result.steps).to.have.length.greaterThan(0);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: setupAutomation.runCompleteSetup is not a function&quot;,&quot;estack&quot;:&quot;TypeError: setupAutomation.runCompleteSetup is not a function\n    at Context.&lt;anonymous&gt; (tests/unit/services/setup-automation.test.js:212:44)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;615cf476-d604-4d4b-a3c7-bbdc0672212c&quot;,&quot;parentUUID&quot;:&quot;322e249e-2eb1-4905-8737-8d94122bb683&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle setup step failures gracefully&quot;,&quot;fullTitle&quot;:&quot;Setup Automation Service Complete Setup Process should handle setup step failures gracefully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockOs.platform.returns(&#x27;darwin&#x27;);\nmockChildProcess.exec.rejects(new Error(&#x27;Setup failed&#x27;));\nconst result = await setupAutomation.runCompleteSetup();\n\nexpect(result.success).to.be.false;\nexpect(result.errors).to.be.an(&#x27;array&#x27;);\nexpect(result.errors).to.have.length.greaterThan(0);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: setupAutomation.runCompleteSetup is not a function&quot;,&quot;estack&quot;:&quot;TypeError: setupAutomation.runCompleteSetup is not a function\n    at Context.&lt;anonymous&gt; (tests/unit/services/setup-automation.test.js:223:44)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;67e713a0-77fa-4bfb-8047-72d855a141d8&quot;,&quot;parentUUID&quot;:&quot;322e249e-2eb1-4905-8737-8d94122bb683&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should provide detailed step results&quot;,&quot;fullTitle&quot;:&quot;Setup Automation Service Complete Setup Process should provide detailed step results&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockOs.platform.returns(&#x27;darwin&#x27;);\nmockChildProcess.exec.resolves({ stdout: &#x27;success&#x27;, stderr: &#x27;&#x27; });\nmockFs.existsSync.returns(true);\nmockFs.writeFileSync.returns();\nconst result = await setupAutomation.runCompleteSetup();\n\nexpect(result.steps).to.be.an(&#x27;array&#x27;);\nresult.steps.forEach(step =&gt; {\n  expect(step).to.have.property(&#x27;name&#x27;);\n  expect(step).to.have.property(&#x27;success&#x27;);\n  expect(step).to.have.property(&#x27;duration&#x27;);\n});&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: setupAutomation.runCompleteSetup is not a function&quot;,&quot;estack&quot;:&quot;TypeError: setupAutomation.runCompleteSetup is not a function\n    at Context.&lt;anonymous&gt; (tests/unit/services/setup-automation.test.js:236:44)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;5cbffb8d-954e-4aba-946f-c8282aef58d4&quot;,&quot;parentUUID&quot;:&quot;322e249e-2eb1-4905-8737-8d94122bb683&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;615cf476-d604-4d4b-a3c7-bbdc0672212c&quot;,&quot;67e713a0-77fa-4bfb-8047-72d855a141d8&quot;,&quot;5cbffb8d-954e-4aba-946f-c8282aef58d4&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;44b2a472-abe5-421b-8013-dcfc79a99ed9&quot;,&quot;title&quot;:&quot;Error Handling&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/setup-automation.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/setup-automation.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should handle timeout errors&quot;,&quot;fullTitle&quot;:&quot;Setup Automation Service Error Handling should handle timeout errors&quot;,&quot;timedOut&quot;:true,&quot;duration&quot;:5001,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockOs.platform.returns(&#x27;darwin&#x27;);\nmockChildProcess.exec.rejects(new Error(&#x27;ETIMEDOUT&#x27;));\nconst result = await setupAutomation.installVirtualAudio();\n\nexpect(result.success).to.be.false;\nexpect(result.error).to.include(&#x27;timeout&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Timeout of 5000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/setup-automation.test.js)&quot;,&quot;estack&quot;:&quot;Error: Timeout of 5000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/setup-automation.test.js)\n    at listOnTimeout (node:internal/timers:594:17)\n    at process.processTimers (node:internal/timers:529:7)&quot;},&quot;uuid&quot;:&quot;7b47c2d0-1a61-4fdb-916f-6f3bc6a29fbf&quot;,&quot;parentUUID&quot;:&quot;44b2a472-abe5-421b-8013-dcfc79a99ed9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle permission errors&quot;,&quot;fullTitle&quot;:&quot;Setup Automation Service Error Handling should handle permission errors&quot;,&quot;timedOut&quot;:true,&quot;duration&quot;:5001,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockOs.platform.returns(&#x27;darwin&#x27;);\nmockChildProcess.exec.rejects(new Error(&#x27;EACCES&#x27;));\nconst result = await setupAutomation.installVirtualAudio();\n\nexpect(result.success).to.be.false;\nexpect(result.error).to.include(&#x27;permission&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Timeout of 5000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/setup-automation.test.js)&quot;,&quot;estack&quot;:&quot;Error: Timeout of 5000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/setup-automation.test.js)\n    at listOnTimeout (node:internal/timers:594:17)\n    at process.processTimers (node:internal/timers:529:7)&quot;},&quot;uuid&quot;:&quot;c62d05cf-1816-445e-a887-da8f3c678cef&quot;,&quot;parentUUID&quot;:&quot;44b2a472-abe5-421b-8013-dcfc79a99ed9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle network errors&quot;,&quot;fullTitle&quot;:&quot;Setup Automation Service Error Handling should handle network errors&quot;,&quot;timedOut&quot;:true,&quot;duration&quot;:5002,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;mockOs.platform.returns(&#x27;darwin&#x27;);\nmockChildProcess.exec.rejects(new Error(&#x27;ENOTFOUND&#x27;));\nconst result = await setupAutomation.installVirtualAudio();\n\nexpect(result.success).to.be.false;\nexpect(result.error).to.include(&#x27;network&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Timeout of 5000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/setup-automation.test.js)&quot;,&quot;estack&quot;:&quot;Error: Timeout of 5000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/setup-automation.test.js)\n    at listOnTimeout (node:internal/timers:594:17)\n    at process.processTimers (node:internal/timers:529:7)&quot;},&quot;uuid&quot;:&quot;b1a42754-9097-4d8b-b5c5-a8d180e2999e&quot;,&quot;parentUUID&quot;:&quot;44b2a472-abe5-421b-8013-dcfc79a99ed9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;7b47c2d0-1a61-4fdb-916f-6f3bc6a29fbf&quot;,&quot;c62d05cf-1816-445e-a887-da8f3c678cef&quot;,&quot;b1a42754-9097-4d8b-b5c5-a8d180e2999e&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:15004,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;5ef9586b-4b60-4164-ada5-ab7397ea40fb&quot;,&quot;title&quot;:&quot;Validation&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/setup-automation.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/setup-automation.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should validate platform support&quot;,&quot;fullTitle&quot;:&quot;Setup Automation Service Validation should validate platform support&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(setupAutomation.isPlatformSupported(&#x27;windows&#x27;)).to.be.true;\nexpect(setupAutomation.isPlatformSupported(&#x27;macos&#x27;)).to.be.true;\nexpect(setupAutomation.isPlatformSupported(&#x27;linux&#x27;)).to.be.true;\nexpect(setupAutomation.isPlatformSupported(&#x27;freebsd&#x27;)).to.be.false;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: setupAutomation.isPlatformSupported is not a function&quot;,&quot;estack&quot;:&quot;TypeError: setupAutomation.isPlatformSupported is not a function\n    at Context.&lt;anonymous&gt; (tests/unit/services/setup-automation.test.js:281:30)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;14b2bb05-eaef-4971-b202-2a4b185a3097&quot;,&quot;parentUUID&quot;:&quot;5ef9586b-4b60-4164-ada5-ab7397ea40fb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should validate app support&quot;,&quot;fullTitle&quot;:&quot;Setup Automation Service Validation should validate app support&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(setupAutomation.isAppSupported(&#x27;discord&#x27;)).to.be.true;\nexpect(setupAutomation.isAppSupported(&#x27;zoom&#x27;)).to.be.true;\nexpect(setupAutomation.isAppSupported(&#x27;teams&#x27;)).to.be.true;\nexpect(setupAutomation.isAppSupported(&#x27;nonexistent&#x27;)).to.be.false;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: setupAutomation.isAppSupported is not a function&quot;,&quot;estack&quot;:&quot;TypeError: setupAutomation.isAppSupported is not a function\n    at Context.&lt;anonymous&gt; (tests/unit/services/setup-automation.test.js:288:30)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;79f85e87-9980-4bb2-a808-b85908747d07&quot;,&quot;parentUUID&quot;:&quot;5ef9586b-4b60-4164-ada5-ab7397ea40fb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should validate configuration&quot;,&quot;fullTitle&quot;:&quot;Setup Automation Service Validation should validate configuration&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const validConfig = {\n  translation: { service: &#x27;deepl&#x27;, apiKey: &#x27;test-key&#x27; },\n  audio: { inputDevice: &#x27;microphone&#x27; }\n};\nconst invalidConfig = {\n  translation: { service: &#x27;invalid&#x27; }\n};\nexpect(setupAutomation.validateConfiguration(validConfig)).to.be.true;\nexpect(setupAutomation.validateConfiguration(invalidConfig)).to.be.false;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: setupAutomation.validateConfiguration is not a function&quot;,&quot;estack&quot;:&quot;TypeError: setupAutomation.validateConfiguration is not a function\n    at Context.&lt;anonymous&gt; (tests/unit/services/setup-automation.test.js:304:30)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;c48e5164-2007-41df-98e3-8e30b0313281&quot;,&quot;parentUUID&quot;:&quot;5ef9586b-4b60-4164-ada5-ab7397ea40fb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;14b2bb05-eaef-4971-b202-2a4b185a3097&quot;,&quot;79f85e87-9980-4bb2-a808-b85908747d07&quot;,&quot;c48e5164-2007-41df-98e3-8e30b0313281&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;daffef21-1912-4030-aeeb-4cb187a33798&quot;,&quot;title&quot;:&quot;AzureTranslator&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/azure-translator.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/azure-translator.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;AzureTranslator\&quot;&quot;,&quot;fullTitle&quot;:&quot;AzureTranslator \&quot;before each\&quot; hook in \&quot;AzureTranslator\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox = sinon.createSandbox();\ntranslator = new AzureTranslator({\n    apiKey: &#x27;test-api-key&#x27;,\n    endpoint: &#x27;https://api.cognitive.microsofttranslator.com&#x27;,\n    region: &#x27;eastus&#x27;\n});\n// Mock axios\nsandbox.stub(axios, &#x27;post&#x27;);\nsandbox.stub(axios, &#x27;get&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8ea46101-7ea5-4b1e-91de-65c07b45b100&quot;,&quot;parentUUID&quot;:&quot;daffef21-1912-4030-aeeb-4cb187a33798&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;AzureTranslator\&quot;&quot;,&quot;fullTitle&quot;:&quot;AzureTranslator \&quot;after each\&quot; hook in \&quot;AzureTranslator\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c4f01bcf-bc99-4687-89a7-662870c4bd04&quot;,&quot;parentUUID&quot;:&quot;daffef21-1912-4030-aeeb-4cb187a33798&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;33f1d55a-8263-4f58-b17e-a3a79114d244&quot;,&quot;title&quot;:&quot;initialization&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/azure-translator.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/azure-translator.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should initialize successfully with valid credentials&quot;,&quot;fullTitle&quot;:&quot;AzureTranslator initialization should initialize successfully with valid credentials&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock languages API response\naxios.get.resolves({\n    data: {\n        translation: {\n            en: { name: &#x27;English&#x27;, dir: &#x27;ltr&#x27;, supported: true },\n            es: { name: &#x27;Spanish&#x27;, dir: &#x27;ltr&#x27;, supported: true },\n            fr: { name: &#x27;French&#x27;, dir: &#x27;ltr&#x27;, supported: true }\n        }\n    }\n});\nconst result = await translator.initialize();\nexpect(result.success).to.be.true;\nexpect(translator.isInitialized).to.be.true;\nexpect(translator.supportedLanguages.length).to.be.greaterThan(0);\nexpect(axios.get.calledOnce).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Azure Translator connection test failed: Azure Translator error: Cannot read properties of undefined (reading &#x27;data&#x27;)&quot;,&quot;estack&quot;:&quot;Error: Azure Translator connection test failed: Azure Translator error: Cannot read properties of undefined (reading &#x27;data&#x27;)\n    at AzureTranslator.testConnection (src/services/translation/azure-translator.js:79:19)\n    at async AzureTranslator.initialize (src/services/translation/azure-translator.js:51:13)\n    at async Context.&lt;anonymous&gt; (tests/unit/services/translation/azure-translator.test.js:41:28)&quot;},&quot;uuid&quot;:&quot;10df1429-b349-4492-bd4b-c88f78ecd8e9&quot;,&quot;parentUUID&quot;:&quot;33f1d55a-8263-4f58-b17e-a3a79114d244&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle missing API key&quot;,&quot;fullTitle&quot;:&quot;AzureTranslator initialization should handle missing API key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;translator = new AzureTranslator({\n    apiKey: null,\n    endpoint: &#x27;https://api.cognitive.microsofttranslator.com&#x27;,\n    region: &#x27;eastus&#x27;\n});\ntry {\n    await translator.initialize();\n    expect.fail(&#x27;Should have thrown an error&#x27;);\n} catch (error) {\n    expect(error.message).to.include(&#x27;API key&#x27;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d944fb33-749d-427a-94f6-e9b3e77b5710&quot;,&quot;parentUUID&quot;:&quot;33f1d55a-8263-4f58-b17e-a3a79114d244&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle API errors during initialization&quot;,&quot;fullTitle&quot;:&quot;AzureTranslator initialization should handle API errors during initialization&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock languages API error\naxios.get.rejects(new Error(&#x27;Unable to connect to Azure&#x27;));\ntry {\n    await translator.initialize();\n    expect.fail(&#x27;Should have thrown an error&#x27;);\n} catch (error) {\n    expect(error.message).to.include(&#x27;Unable to connect to Azure&#x27;);\n    expect(translator.isInitialized).to.be.false;\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Azure Translator connection test fail&#x27; to include &#x27;Unable to connect to Azure&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Azure Translator connection test fail&#x27; to include &#x27;Unable to connect to Azure&#x27;\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/azure-translator.test.js:72:42)&quot;},&quot;uuid&quot;:&quot;1730b651-718b-4442-91d2-9f2d9d56a4be&quot;,&quot;parentUUID&quot;:&quot;33f1d55a-8263-4f58-b17e-a3a79114d244&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d944fb33-749d-427a-94f6-e9b3e77b5710&quot;],&quot;failures&quot;:[&quot;10df1429-b349-4492-bd4b-c88f78ecd8e9&quot;,&quot;1730b651-718b-4442-91d2-9f2d9d56a4be&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;66e65a30-8a7e-4107-b715-9e8845fa2723&quot;,&quot;title&quot;:&quot;translate&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/azure-translator.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/azure-translator.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;translate\&quot;&quot;,&quot;fullTitle&quot;:&quot;AzureTranslator translate \&quot;before each\&quot; hook in \&quot;translate\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Setup initialized translator\ntranslator.isInitialized = true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;78fb62b8-8f25-406e-a8d1-ef8be2f7460f&quot;,&quot;parentUUID&quot;:&quot;66e65a30-8a7e-4107-b715-9e8845fa2723&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should translate text successfully&quot;,&quot;fullTitle&quot;:&quot;AzureTranslator translate should translate text successfully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock successful translation response\naxios.post.resolves({\n    data: [\n        {\n            translations: [\n                {\n                    text: &#x27;Hola mundo&#x27;,\n                    to: &#x27;es&#x27;,\n                    alignment: { proj: &#x27;0:4-0:3 6:10-5:9&#x27; },\n                    sentLen: { srcSentLen: [11], transSentLen: [10] }\n                }\n            ],\n            detectedLanguage: {\n                language: &#x27;en&#x27;,\n                score: 0.95\n            }\n        }\n    ]\n});\n// Mock UUID generation for deterministic testing\nsandbox.stub(uuidv4).returns(&#x27;test-uuid&#x27;);\nconst result = await translator.translate(&#x27;Hello world&#x27;, &#x27;en&#x27;, &#x27;es&#x27;);\nexpect(result.translation).to.equal(&#x27;Hola mundo&#x27;);\nexpect(result.detectedLanguage).to.equal(&#x27;en&#x27;);\nexpect(result.confidence).to.equal(0.95);\nexpect(result.service).to.equal(&#x27;azure&#x27;);\nexpect(axios.post.calledOnce).to.be.true;\n// Verify correct API call parameters\nconst postCall = axios.post.getCall(0);\nexpect(postCall.args[0]).to.include(&#x27;translate&#x27;);\nexpect(postCall.args[1]).to.deep.equal([{ text: &#x27;Hello world&#x27; }]);\nexpect(postCall.args[2].params).to.include({\n    &#x27;api-version&#x27;: translator.config.apiVersion,\n    &#x27;to&#x27;: &#x27;es&#x27;,\n    &#x27;from&#x27;: &#x27;en&#x27;\n});\nexpect(postCall.args[2].headers).to.include({\n    &#x27;Ocp-Apim-Subscription-Key&#x27;: &#x27;test-api-key&#x27;,\n    &#x27;Ocp-Apim-Subscription-Region&#x27;: &#x27;eastus&#x27;,\n    &#x27;Content-Type&#x27;: &#x27;application/json&#x27;,\n    &#x27;X-ClientTraceId&#x27;: &#x27;test-uuid&#x27;\n});&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: sandbox.stub(...).returns is not a function&quot;,&quot;estack&quot;:&quot;TypeError: sandbox.stub(...).returns is not a function\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/azure-translator.test.js:106:34)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;47524a7c-9ab2-46e0-8e11-aeb1d23597a4&quot;,&quot;parentUUID&quot;:&quot;66e65a30-8a7e-4107-b715-9e8845fa2723&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should detect language when fromLanguage is \&quot;auto\&quot;&quot;,&quot;fullTitle&quot;:&quot;AzureTranslator translate should detect language when fromLanguage is \&quot;auto\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock successful translation with language detection\naxios.post.resolves({\n    data: [\n        {\n            translations: [\n                {\n                    text: &#x27;Hello world&#x27;,\n                    to: &#x27;en&#x27;\n                }\n            ],\n            detectedLanguage: {\n                language: &#x27;es&#x27;,\n                score: 0.92\n            }\n        }\n    ]\n});\nconst result = await translator.translate(&#x27;Hola mundo&#x27;, &#x27;auto&#x27;, &#x27;en&#x27;);\nexpect(result.translation).to.equal(&#x27;Hello world&#x27;);\nexpect(result.detectedLanguage).to.equal(&#x27;es&#x27;);\nexpect(result.confidence).to.equal(0.92);\n// Verify API call does not include &#x27;from&#x27; parameter\nconst postCall = axios.post.getCall(0);\nexpect(postCall.args[2].params.from).to.be.undefined;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;de6a8ed5-f805-4038-9a4d-daec3ad69083&quot;,&quot;parentUUID&quot;:&quot;66e65a30-8a7e-4107-b715-9e8845fa2723&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle API errors gracefully&quot;,&quot;fullTitle&quot;:&quot;AzureTranslator translate should handle API errors gracefully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock API error\naxios.post.rejects({\n    response: {\n        data: {\n            error: {\n                code: 401,\n                message: &#x27;Access denied due to invalid subscription key&#x27;\n            }\n        }\n    }\n});\ntry {\n    await translator.translate(&#x27;Hello world&#x27;, &#x27;en&#x27;, &#x27;es&#x27;);\n    expect.fail(&#x27;Should have thrown an error&#x27;);\n} catch (error) {\n    expect(error.message).to.include(&#x27;Access denied&#x27;);\n    // Check metrics update\n    expect(translator.metrics.successRate).to.be.lessThan(1.0);\n    expect(translator.metrics.lastError).to.include(&#x27;Access denied&#x27;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c131fd3e-a5aa-497c-bd74-fd662c48f31f&quot;,&quot;parentUUID&quot;:&quot;66e65a30-8a7e-4107-b715-9e8845fa2723&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle text formatting options&quot;,&quot;fullTitle&quot;:&quot;AzureTranslator translate should handle text formatting options&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock successful translation response\naxios.post.resolves({\n    data: [\n        {\n            translations: [\n                {\n                    text: &#x27;&lt;p&gt;Hola &lt;b&gt;mundo&lt;/b&gt;&lt;/p&gt;&#x27;,\n                    to: &#x27;es&#x27;\n                }\n            ],\n            detectedLanguage: {\n                language: &#x27;en&#x27;,\n                score: 0.95\n            }\n        }\n    ]\n});\nawait translator.translate(&#x27;&lt;p&gt;Hello &lt;b&gt;world&lt;/b&gt;&lt;/p&gt;&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, {\n    textType: &#x27;html&#x27;,\n    preserveFormatting: true\n});\n// Verify API call includes textType parameter\nconst postCall = axios.post.getCall(0);\nexpect(postCall.args[2].params.textType).to.equal(&#x27;html&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3bcb55bd-049e-4d2a-87b4-d20e55436ae1&quot;,&quot;parentUUID&quot;:&quot;66e65a30-8a7e-4107-b715-9e8845fa2723&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should respect formality setting when available&quot;,&quot;fullTitle&quot;:&quot;AzureTranslator translate should respect formality setting when available&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock successful translation response\naxios.post.resolves({\n    data: [\n        {\n            translations: [\n                {\n                    text: &#x27;Hola mundo&#x27;,\n                    to: &#x27;es&#x27;\n                }\n            ]\n        }\n    ]\n});\nawait translator.translate(&#x27;Hello world&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, {\n    formality: &#x27;formal&#x27;\n});\n// Verify API call includes textType parameter\nconst postCall = axios.post.getCall(0);\n// Check if the API supports formality parameter\nif (translator.supportsFormality) {\n    expect(postCall.args[2].params).to.include({ &#x27;formality&#x27;: &#x27;formal&#x27; });\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;260ccc13-8368-4365-ab51-ee8a757bf697&quot;,&quot;parentUUID&quot;:&quot;66e65a30-8a7e-4107-b715-9e8845fa2723&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;de6a8ed5-f805-4038-9a4d-daec3ad69083&quot;,&quot;c131fd3e-a5aa-497c-bd74-fd662c48f31f&quot;,&quot;3bcb55bd-049e-4d2a-87b4-d20e55436ae1&quot;,&quot;260ccc13-8368-4365-ab51-ee8a757bf697&quot;],&quot;failures&quot;:[&quot;47524a7c-9ab2-46e0-8e11-aeb1d23597a4&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;c1d8703c-ee59-4876-bf06-4ad7837f0152&quot;,&quot;title&quot;:&quot;detectLanguage&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/azure-translator.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/azure-translator.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;detectLanguage\&quot;&quot;,&quot;fullTitle&quot;:&quot;AzureTranslator detectLanguage \&quot;before each\&quot; hook in \&quot;detectLanguage\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;translator.isInitialized = true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e593c4d2-ee67-4618-bc8c-0e609b214222&quot;,&quot;parentUUID&quot;:&quot;c1d8703c-ee59-4876-bf06-4ad7837f0152&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should detect language correctly&quot;,&quot;fullTitle&quot;:&quot;AzureTranslator detectLanguage should detect language correctly&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock successful language detection\naxios.post.resolves({\n    data: [\n        {\n            language: &#x27;es&#x27;,\n            score: 0.95,\n            isTranslationSupported: true,\n            isTransliterationSupported: false\n        }\n    ]\n});\nconst result = await translator.detectLanguage(&#x27;Hola mundo&#x27;);\nexpect(result.language).to.equal(&#x27;es&#x27;);\nexpect(result.confidence).to.equal(0.95);\nexpect(result.isTranslationSupported).to.be.true;\nexpect(axios.post.calledOnce).to.be.true;\n// Verify correct API call\nconst postCall = axios.post.getCall(0);\nexpect(postCall.args[0]).to.include(&#x27;detect&#x27;);\nexpect(postCall.args[1]).to.deep.equal([{ text: &#x27;Hola mundo&#x27; }]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected undefined to be true&quot;,&quot;estack&quot;:&quot;AssertionError: expected undefined to be true\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/azure-translator.test.js:268:56)&quot;},&quot;uuid&quot;:&quot;9a6fbadf-261e-4b52-b562-670daa28a9c9&quot;,&quot;parentUUID&quot;:&quot;c1d8703c-ee59-4876-bf06-4ad7837f0152&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle empty text in language detection&quot;,&quot;fullTitle&quot;:&quot;AzureTranslator detectLanguage should handle empty text in language detection&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;try {\n    await translator.detectLanguage(&#x27;&#x27;);\n    expect.fail(&#x27;Should have thrown an error&#x27;);\n} catch (error) {\n    expect(error.message).to.include(&#x27;Text cannot be empty&#x27;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Cannot read properties of undefined (&#x27; to include &#x27;Text cannot be empty&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Cannot read properties of undefined (&#x27; to include &#x27;Text cannot be empty&#x27;\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/azure-translator.test.js:282:42)&quot;},&quot;uuid&quot;:&quot;66f638ad-bf6e-4e1c-b194-679eda449002&quot;,&quot;parentUUID&quot;:&quot;c1d8703c-ee59-4876-bf06-4ad7837f0152&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;9a6fbadf-261e-4b52-b562-670daa28a9c9&quot;,&quot;66f638ad-bf6e-4e1c-b194-679eda449002&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;72d6d677-a9ad-4576-bf8b-8fa55836b5ed&quot;,&quot;title&quot;:&quot;GPT4oTranslator&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/gpt4o-translator.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/gpt4o-translator.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;GPT4oTranslator\&quot;&quot;,&quot;fullTitle&quot;:&quot;GPT4oTranslator \&quot;before each\&quot; hook in \&quot;GPT4oTranslator\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox = sinon.createSandbox();\ntranslator = new GPT4oTranslator({\n    apiKey: &#x27;test-api-key&#x27;,\n    model: &#x27;gpt-4o&#x27;,\n    temperature: 0.1\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ece4a568-f5c2-40f0-a123-2f0886fd9214&quot;,&quot;parentUUID&quot;:&quot;72d6d677-a9ad-4576-bf8b-8fa55836b5ed&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;GPT4oTranslator\&quot;&quot;,&quot;fullTitle&quot;:&quot;GPT4oTranslator \&quot;after each\&quot; hook in \&quot;GPT4oTranslator\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cff82a73-0890-4e08-b042-1777d44c3ac8&quot;,&quot;parentUUID&quot;:&quot;72d6d677-a9ad-4576-bf8b-8fa55836b5ed&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c3000f45-63d1-4659-8fdb-53f120cc2b69&quot;,&quot;title&quot;:&quot;initialization&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/gpt4o-translator.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/gpt4o-translator.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should initialize successfully with valid API key&quot;,&quot;fullTitle&quot;:&quot;GPT4oTranslator initialization should initialize successfully with valid API key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock the OpenAI constructor and client methods\nconst mockOpenAI = {\n    chat: {\n        completions: {\n            create: sandbox.stub().resolves({\n                id: &#x27;test-completion-id&#x27;,\n                choices: [{ message: { content: &#x27;Test response&#x27; } }],\n                usage: { total_tokens: 10 }\n            })\n        }\n    }\n};\nglobal.OpenAI = sandbox.stub().returns(mockOpenAI);\nconst result = await translator.initialize();\nexpect(result.success).to.be.true;\nexpect(translator.isInitialized).to.be.true;\nexpect(translator.openai).to.equal(mockOpenAI);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: GPT-4o connection test failed: Connection test response was unexpected&quot;,&quot;estack&quot;:&quot;Error: GPT-4o connection test failed: Connection test response was unexpected\n    at GPT4oTranslator.testConnection (src/services/translation/gpt4o-translator.js:95:19)\n    at async GPT4oTranslator.initialize (src/services/translation/gpt4o-translator.js:57:13)\n    at async Context.&lt;anonymous&gt; (tests/unit/services/translation/gpt4o-translator.test.js:40:28)&quot;},&quot;uuid&quot;:&quot;f76ede2b-28b1-4fec-b954-68c7a8d1b798&quot;,&quot;parentUUID&quot;:&quot;c3000f45-63d1-4659-8fdb-53f120cc2b69&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle missing API key&quot;,&quot;fullTitle&quot;:&quot;GPT4oTranslator initialization should handle missing API key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;translator = new GPT4oTranslator({ apiKey: null });\ntry {\n    await translator.initialize();\n    expect.fail(&#x27;Should have thrown an error&#x27;);\n} catch (error) {\n    expect(error.message).to.include(&#x27;API key&#x27;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;GPT-4o connection test failed: Connec&#x27; to include &#x27;API key&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;GPT-4o connection test failed: Connec&#x27; to include &#x27;API key&#x27;\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/gpt4o-translator.test.js:54:42)&quot;},&quot;uuid&quot;:&quot;e6864762-d5e5-4a92-b88d-a7a193232cfa&quot;,&quot;parentUUID&quot;:&quot;c3000f45-63d1-4659-8fdb-53f120cc2b69&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;f76ede2b-28b1-4fec-b954-68c7a8d1b798&quot;,&quot;e6864762-d5e5-4a92-b88d-a7a193232cfa&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;a2e40b35-2e1e-4437-8242-87c19a8fe832&quot;,&quot;title&quot;:&quot;translate&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/gpt4o-translator.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/gpt4o-translator.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;translate\&quot;&quot;,&quot;fullTitle&quot;:&quot;GPT4oTranslator translate \&quot;before each\&quot; hook in \&quot;translate\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Setup initialized translator\ntranslator.isInitialized = true;\ntranslator.openai = {\n    chat: {\n        completions: {\n            create: sandbox.stub()\n        }\n    }\n};\n// Mock loadCulturalProfiles\nsandbox.stub(translator, &#x27;loadCulturalProfiles&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;668b5b19-040a-488f-9bf4-b0662075eae7&quot;,&quot;parentUUID&quot;:&quot;a2e40b35-2e1e-4437-8242-87c19a8fe832&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should translate text successfully&quot;,&quot;fullTitle&quot;:&quot;GPT4oTranslator translate should translate text successfully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock successful translation response\nconst mockCompletion = {\n    id: &#x27;test-completion-id&#x27;,\n    choices: [\n        {\n            message: {\n                content: JSON.stringify({\n                    translation: &#x27;Hola mundo&#x27;,\n                    confidence: 0.95,\n                    reasoning: &#x27;Simple translation of a common phrase&#x27;,\n                    alternatives: [&#x27;Saludos mundo&#x27;],\n                    formality: &#x27;neutral&#x27;,\n                    cultural_notes: &#x27;Standard greeting&#x27;\n                })\n            }\n        }\n    ],\n    usage: {\n        total_tokens: 25\n    }\n};\ntranslator.openai.chat.completions.create.resolves(mockCompletion);\nconst result = await translator.translate(&#x27;Hello world&#x27;, &#x27;en&#x27;, &#x27;es&#x27;);\nexpect(result.translation).to.equal(&#x27;Hola mundo&#x27;);\nexpect(result.confidence).to.equal(0.95);\nexpect(result.service).to.equal(&#x27;gpt4o&#x27;);\nexpect(result.alternatives).to.deep.equal([&#x27;Saludos mundo&#x27;]);\nexpect(translator.openai.chat.completions.create.calledOnce).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;tone&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;tone&#x27;)\n    at GPT4oTranslator.buildTranslationContext (src/services/translation/gpt4o-translator.js:272:56)\n    at GPT4oTranslator.translate (src/services/translation/gpt4o-translator.js:162:55)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/gpt4o-translator.test.js:100:45)&quot;},&quot;uuid&quot;:&quot;216fd6bf-18df-449f-b16d-da09ad1653fd&quot;,&quot;parentUUID&quot;:&quot;a2e40b35-2e1e-4437-8242-87c19a8fe832&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle API errors gracefully&quot;,&quot;fullTitle&quot;:&quot;GPT4oTranslator translate should handle API errors gracefully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock API error\ntranslator.openai.chat.completions.create.rejects(\n    new Error(&#x27;Rate limit exceeded&#x27;)\n);\ntry {\n    await translator.translate(&#x27;Hello world&#x27;, &#x27;en&#x27;, &#x27;es&#x27;);\n    expect.fail(&#x27;Should have thrown an error&#x27;);\n} catch (error) {\n    expect(error.message).to.include(&#x27;Rate limit exceeded&#x27;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Cannot read properties of undefined (&#x27; to include &#x27;Rate limit exceeded&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Cannot read properties of undefined (&#x27; to include &#x27;Rate limit exceeded&#x27;\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/gpt4o-translator.test.js:119:42)&quot;},&quot;uuid&quot;:&quot;8497f4fc-6e73-4a7d-8400-5edea2fb94de&quot;,&quot;parentUUID&quot;:&quot;a2e40b35-2e1e-4437-8242-87c19a8fe832&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle malformed API responses&quot;,&quot;fullTitle&quot;:&quot;GPT4oTranslator translate should handle malformed API responses&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock invalid JSON response\nconst mockCompletion = {\n    id: &#x27;test-completion-id&#x27;,\n    choices: [\n        {\n            message: {\n                content: &#x27;This is not valid JSON&#x27;\n            }\n        }\n    ],\n    usage: {\n        total_tokens: 10\n    }\n};\ntranslator.openai.chat.completions.create.resolves(mockCompletion);\ntry {\n    await translator.translate(&#x27;Hello world&#x27;, &#x27;en&#x27;, &#x27;es&#x27;);\n    expect.fail(&#x27;Should have thrown an error&#x27;);\n} catch (error) {\n    expect(error.message).to.include(&#x27;Failed to parse translation response&#x27;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Cannot read properties of undefined (&#x27; to include &#x27;Failed to parse translation response&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Cannot read properties of undefined (&#x27; to include &#x27;Failed to parse translation response&#x27;\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/gpt4o-translator.test.js:145:42)&quot;},&quot;uuid&quot;:&quot;458d13a6-d063-41e1-accd-04438f221324&quot;,&quot;parentUUID&quot;:&quot;a2e40b35-2e1e-4437-8242-87c19a8fe832&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should update conversation context when provided&quot;,&quot;fullTitle&quot;:&quot;GPT4oTranslator translate should update conversation context when provided&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock successful translation\nconst mockCompletion = {\n    id: &#x27;test-completion-id&#x27;,\n    choices: [\n        {\n            message: {\n                content: JSON.stringify({\n                    translation: &#x27;Hola mundo&#x27;,\n                    confidence: 0.95\n                })\n            }\n        }\n    ],\n    usage: {\n        total_tokens: 15\n    }\n};\ntranslator.openai.chat.completions.create.resolves(mockCompletion);\n// Mock the updateConversationContext method\nconst updateContextSpy = sandbox.spy(translator, &#x27;updateConversationContext&#x27;);\nawait translator.translate(&#x27;Hello world&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, {\n    conversationId: &#x27;test-conversation&#x27;\n});\nexpect(updateContextSpy.calledOnce).to.be.true;\nexpect(updateContextSpy.args[0][0]).to.equal(&#x27;test-conversation&#x27;);\nexpect(updateContextSpy.args[0][1]).to.equal(&#x27;Hello world&#x27;);\nexpect(updateContextSpy.args[0][2]).to.equal(&#x27;Hola mundo&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;tone&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;tone&#x27;)\n    at GPT4oTranslator.buildTranslationContext (src/services/translation/gpt4o-translator.js:272:56)\n    at GPT4oTranslator.translate (src/services/translation/gpt4o-translator.js:162:55)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/gpt4o-translator.test.js:173:30)&quot;},&quot;uuid&quot;:&quot;8ef9e7d8-9876-4b14-a7b9-b14acd194938&quot;,&quot;parentUUID&quot;:&quot;a2e40b35-2e1e-4437-8242-87c19a8fe832&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;216fd6bf-18df-449f-b16d-da09ad1653fd&quot;,&quot;8497f4fc-6e73-4a7d-8400-5edea2fb94de&quot;,&quot;458d13a6-d063-41e1-accd-04438f221324&quot;,&quot;8ef9e7d8-9876-4b14-a7b9-b14acd194938&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;63f80370-9fdb-4d38-b4d8-f4ad1aa91192&quot;,&quot;title&quot;:&quot;buildTranslationContext&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/gpt4o-translator.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/gpt4o-translator.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;buildTranslationContext\&quot;&quot;,&quot;fullTitle&quot;:&quot;GPT4oTranslator buildTranslationContext \&quot;before each\&quot; hook in \&quot;buildTranslationContext\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Setup cultural profiles\ntranslator.culturalProfiles = new Map();\ntranslator.culturalProfiles.set(&#x27;default&#x27;, {\n    tone: &#x27;balanced&#x27;,\n    formality: &#x27;neutral&#x27;,\n    culturalNotes: &#x27;Balance accuracy with natural flow in target language.&#x27;,\n    prioritizeAccuracy: true\n});\ntranslator.culturalProfiles.set(&#x27;business&#x27;, {\n    tone: &#x27;professional&#x27;,\n    formality: &#x27;formal&#x27;,\n    culturalNotes: &#x27;Use business terminology, maintain professional tone.&#x27;,\n    prioritizeAccuracy: true\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;950174ad-fdaa-4d6d-b0b6-1a979c3f2a9d&quot;,&quot;parentUUID&quot;:&quot;63f80370-9fdb-4d38-b4d8-f4ad1aa91192&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should build appropriate context for translation&quot;,&quot;fullTitle&quot;:&quot;GPT4oTranslator buildTranslationContext should build appropriate context for translation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock getConversationContext\nsandbox.stub(translator, &#x27;getConversationContext&#x27;).returns(&#x27;Previous: Hello -&gt; Hola&#x27;);\nconst params = {\n    text: &#x27;How are you today?&#x27;,\n    fromLanguage: &#x27;en&#x27;,\n    toLanguage: &#x27;es&#x27;,\n    profile: &#x27;business&#x27;,\n    preserveFormatting: true,\n    context: &#x27;Business meeting context&#x27;,\n    conversationId: &#x27;test-conversation&#x27;\n};\nconst { systemPrompt, userPrompt } = translator.buildTranslationContext(params);\nexpect(systemPrompt).to.include(&#x27;professional translator&#x27;);\nexpect(systemPrompt).to.include(&#x27;Business meeting context&#x27;);\nexpect(systemPrompt).to.include(&#x27;TRANSLATION REQUIREMENTS&#x27;);\nexpect(systemPrompt).to.include(&#x27;professional&#x27;); // tone\nexpect(systemPrompt).to.include(&#x27;formal&#x27;); // formality\nexpect(userPrompt).to.include(&#x27;Translate this en text to es&#x27;);\nexpect(userPrompt).to.include(&#x27;How are you today?&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;471aebbc-5698-4169-9982-4d72a10880c7&quot;,&quot;parentUUID&quot;:&quot;63f80370-9fdb-4d38-b4d8-f4ad1aa91192&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle different profiles correctly&quot;,&quot;fullTitle&quot;:&quot;GPT4oTranslator buildTranslationContext should handle different profiles correctly&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const params = {\n    text: &#x27;Hello world&#x27;,\n    fromLanguage: &#x27;en&#x27;,\n    toLanguage: &#x27;fr&#x27;,\n    profile: &#x27;default&#x27;,\n    preserveFormatting: true\n};\nconst { systemPrompt } = translator.buildTranslationContext(params);\nexpect(systemPrompt).to.include(&#x27;balanced&#x27;); // tone\nexpect(systemPrompt).to.include(&#x27;neutral&#x27;); // formality\nexpect(systemPrompt).to.include(&#x27;Balance accuracy with natural flow&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0c3d0d72-2be6-4633-bc6a-10fd86fc2394&quot;,&quot;parentUUID&quot;:&quot;63f80370-9fdb-4d38-b4d8-f4ad1aa91192&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;471aebbc-5698-4169-9982-4d72a10880c7&quot;,&quot;0c3d0d72-2be6-4633-bc6a-10fd86fc2394&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;7ab34605-29fc-450d-a427-45841d4b91bc&quot;,&quot;title&quot;:&quot;updateConversationContext&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/gpt4o-translator.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/gpt4o-translator.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should add new entries to conversation context&quot;,&quot;fullTitle&quot;:&quot;GPT4oTranslator updateConversationContext should add new entries to conversation context&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Initialize empty conversation contexts\ntranslator.conversationContexts = new Map();\ntranslator.config.contextWindowSize = 3;\ntranslator.updateConversationContext(\n    &#x27;test-conversation&#x27;,\n    &#x27;Hello&#x27;,\n    &#x27;Hola&#x27;,\n    &#x27;en&#x27;,\n    &#x27;es&#x27;\n);\nexpect(translator.conversationContexts.has(&#x27;test-conversation&#x27;)).to.be.true;\nconst context = translator.conversationContexts.get(&#x27;test-conversation&#x27;);\nexpect(context.length).to.equal(1);\nexpect(context[0].original).to.equal(&#x27;Hello&#x27;);\nexpect(context[0].translated).to.equal(&#x27;Hola&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;00925a51-f3ef-4f46-a72b-b4c0240a298f&quot;,&quot;parentUUID&quot;:&quot;7ab34605-29fc-450d-a427-45841d4b91bc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should limit context size to configured window&quot;,&quot;fullTitle&quot;:&quot;GPT4oTranslator updateConversationContext should limit context size to configured window&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Initialize conversation with existing entries\ntranslator.conversationContexts = new Map();\ntranslator.config.contextWindowSize = 2;\nconst existingContext = [\n    {\n        timestamp: Date.now() - 3000,\n        original: &#x27;Hello&#x27;,\n        translated: &#x27;Hola&#x27;,\n        fromLanguage: &#x27;en&#x27;,\n        toLanguage: &#x27;es&#x27;\n    },\n    {\n        timestamp: Date.now() - 2000,\n        original: &#x27;How are you?&#x27;,\n        translated: &#x27;Cmo ests?&#x27;,\n        fromLanguage: &#x27;en&#x27;,\n        toLanguage: &#x27;es&#x27;\n    }\n];\ntranslator.conversationContexts.set(&#x27;test-conversation&#x27;, existingContext);\n// Add a new entry\ntranslator.updateConversationContext(\n    &#x27;test-conversation&#x27;,\n    &#x27;Good morning&#x27;,\n    &#x27;Buenos das&#x27;,\n    &#x27;en&#x27;,\n    &#x27;es&#x27;\n);\n// Should keep only the last 2 entries\nconst context = translator.conversationContexts.get(&#x27;test-conversation&#x27;);\nexpect(context.length).to.equal(2);\nexpect(context[0].original).to.equal(&#x27;How are you?&#x27;);\nexpect(context[1].original).to.equal(&#x27;Good morning&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected 3 to equal 2&quot;,&quot;estack&quot;:&quot;AssertionError: expected 3 to equal 2\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/gpt4o-translator.test.js:300:39)\n    at process.processImmediate (node:internal/timers:491:21)&quot;,&quot;diff&quot;:&quot;- 3\n+ 2\n&quot;},&quot;uuid&quot;:&quot;4708eee9-2cef-49b4-8a17-8461b08be134&quot;,&quot;parentUUID&quot;:&quot;7ab34605-29fc-450d-a427-45841d4b91bc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;00925a51-f3ef-4f46-a72b-b4c0240a298f&quot;],&quot;failures&quot;:[&quot;4708eee9-2cef-49b4-8a17-8461b08be134&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;7e8be573-47bd-42b3-8638-c98f4dbaa332&quot;,&quot;title&quot;:&quot;TranslationManager&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/translation-manager.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/translation-manager.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;TranslationManager\&quot;&quot;,&quot;fullTitle&quot;:&quot;TranslationManager \&quot;before each\&quot; hook in \&quot;TranslationManager\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox = sinon.createSandbox();\ntranslationManager = new TranslationManager();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;07780a47-86d3-4de9-ac72-b2ac686b6eba&quot;,&quot;parentUUID&quot;:&quot;7e8be573-47bd-42b3-8638-c98f4dbaa332&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;TranslationManager\&quot;&quot;,&quot;fullTitle&quot;:&quot;TranslationManager \&quot;after each\&quot; hook in \&quot;TranslationManager\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3a97a9bb-7713-4ca4-a594-a27736915573&quot;,&quot;parentUUID&quot;:&quot;7e8be573-47bd-42b3-8638-c98f4dbaa332&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ea8012ff-ca6c-4385-b4b7-fbe54574ffce&quot;,&quot;title&quot;:&quot;initialization&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/translation-manager.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/translation-manager.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should initialize successfully with all services&quot;,&quot;fullTitle&quot;:&quot;TranslationManager initialization should initialize successfully with all services&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock all service initializations\nconst mockDeeplInit = sandbox.stub(translationManager.services.deepl, &#x27;initialize&#x27;).resolves({ success: true });\nconst mockGpt4oInit = sandbox.stub(translationManager.services.gpt4o, &#x27;initialize&#x27;).resolves({ success: true });\nconst mockGoogleInit = sandbox.stub(translationManager.services.google, &#x27;initialize&#x27;).resolves({ success: true });\nconst mockAzureInit = sandbox.stub(translationManager.services.azure, &#x27;initialize&#x27;).resolves({ success: true });\n// Mock supporting components\nsandbox.stub(translationManager.languagePairOptimizer, &#x27;initialize&#x27;).resolves();\nsandbox.stub(translationManager.contextManager, &#x27;initialize&#x27;).resolves();\nsandbox.stub(translationManager.translationCache, &#x27;initialize&#x27;).resolves();\nsandbox.stub(translationManager.qualityAssessment, &#x27;initialize&#x27;).resolves();\nconst result = await translationManager.initialize();\nexpect(result.success).to.be.true;\nexpect(mockDeeplInit.calledOnce).to.be.true;\nexpect(mockGpt4oInit.calledOnce).to.be.true;\nexpect(mockGoogleInit.calledOnce).to.be.true;\nexpect(mockAzureInit.calledOnce).to.be.true;\nexpect(translationManager.isInitialized).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot stub non-existent property initialize&quot;,&quot;estack&quot;:&quot;TypeError: Cannot stub non-existent property initialize\n    at Function.stub (node_modules/sinon/lib/sinon/stub.js:82:15)\n    at Sandbox.stub (node_modules/sinon/lib/sinon/sandbox.js:389:39)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/translation-manager.test.js:31:21)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;6e308c56-c56c-4607-9e78-a78249d74fb2&quot;,&quot;parentUUID&quot;:&quot;ea8012ff-ca6c-4385-b4b7-fbe54574ffce&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle service initialization failures gracefully&quot;,&quot;fullTitle&quot;:&quot;TranslationManager initialization should handle service initialization failures gracefully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock one service failing\nsandbox.stub(translationManager.services.deepl, &#x27;initialize&#x27;).resolves({ success: true });\nsandbox.stub(translationManager.services.gpt4o, &#x27;initialize&#x27;).rejects(new Error(&#x27;API key not found&#x27;));\nsandbox.stub(translationManager.services.google, &#x27;initialize&#x27;).resolves({ success: true });\nsandbox.stub(translationManager.services.azure, &#x27;initialize&#x27;).resolves({ success: true });\n// Mock supporting components\nsandbox.stub(translationManager.languagePairOptimizer, &#x27;initialize&#x27;).resolves();\nsandbox.stub(translationManager.contextManager, &#x27;initialize&#x27;).resolves();\nsandbox.stub(translationManager.translationCache, &#x27;initialize&#x27;).resolves();\nsandbox.stub(translationManager.qualityAssessment, &#x27;initialize&#x27;).resolves();\nconst result = await translationManager.initialize();\nexpect(result.success).to.be.true; // Still succeeds with some services available\nexpect(translationManager.serviceHealth.gpt4o.healthy).to.be.false;\nexpect(translationManager.isInitialized).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot stub non-existent property initialize&quot;,&quot;estack&quot;:&quot;TypeError: Cannot stub non-existent property initialize\n    at Function.stub (node_modules/sinon/lib/sinon/stub.js:82:15)\n    at Sandbox.stub (node_modules/sinon/lib/sinon/sandbox.js:389:39)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/translation-manager.test.js:54:21)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;522065d7-a1c8-42f5-8d9b-905d598a85ae&quot;,&quot;parentUUID&quot;:&quot;ea8012ff-ca6c-4385-b4b7-fbe54574ffce&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;6e308c56-c56c-4607-9e78-a78249d74fb2&quot;,&quot;522065d7-a1c8-42f5-8d9b-905d598a85ae&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;0593a3b1-64ee-498c-b9f7-e151824353d1&quot;,&quot;title&quot;:&quot;translate&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/translation-manager.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/translation-manager.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;translate\&quot;&quot;,&quot;fullTitle&quot;:&quot;TranslationManager translate \&quot;before each\&quot; hook in \&quot;translate\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Setup initialized translation manager\ntranslationManager.isInitialized = true;\n// Mock the supporting components\nsandbox.stub(translationManager.languagePairOptimizer, &#x27;getBestServiceForLanguagePair&#x27;).returns(&#x27;deepl&#x27;);\nsandbox.stub(translationManager.translationCache, &#x27;get&#x27;).resolves(null);\nsandbox.stub(translationManager.contextManager, &#x27;getConversationContext&#x27;).resolves(&#x27;&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d970013a-9d0f-4743-bf8c-a566ed7e88b7&quot;,&quot;parentUUID&quot;:&quot;0593a3b1-64ee-498c-b9f7-e151824353d1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should translate text using the best service&quot;,&quot;fullTitle&quot;:&quot;TranslationManager translate should translate text using the best service&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock successful translation\nconst mockTranslation = {\n    success: true,\n    translation: &#x27;Hola, mundo&#x27;,\n    confidence: 0.95,\n    service: &#x27;deepl&#x27;,\n    processingTime: 120,\n    fromLanguage: &#x27;en&#x27;,\n    toLanguage: &#x27;es&#x27;\n};\nsandbox.stub(translationManager, &#x27;attemptTranslation&#x27;).resolves(mockTranslation);\nsandbox.stub(translationManager.qualityAssessment, &#x27;assessTranslation&#x27;).resolves({\n    score: 0.92,\n    metrics: {\n        accuracy: 0.95,\n        fluency: 0.90,\n        cultural: 0.88\n    }\n});\nconst result = await translationManager.translate(&#x27;Hello, world&#x27;, &#x27;en&#x27;, &#x27;es&#x27;);\nexpect(result.success).to.be.true;\nexpect(result.translation).to.equal(&#x27;Hola, mundo&#x27;);\nexpect(result.service).to.equal(&#x27;deepl&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;84a65159-e4bf-4fdf-8cf1-bbe91d25c2de&quot;,&quot;parentUUID&quot;:&quot;0593a3b1-64ee-498c-b9f7-e151824353d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should use cached translation when available&quot;,&quot;fullTitle&quot;:&quot;TranslationManager translate should use cached translation when available&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock cache hit\nconst cachedTranslation = {\n    success: true,\n    translation: &#x27;Hola, mundo&#x27;,\n    confidence: 0.95,\n    service: &#x27;deepl&#x27;,\n    processingTime: 5, // Fast because cached\n    fromLanguage: &#x27;en&#x27;,\n    toLanguage: &#x27;es&#x27;,\n    cached: true\n};\nsandbox.stub(translationManager.translationCache, &#x27;get&#x27;).resolves(cachedTranslation);\n// The attemptTranslation should not be called because of cache hit\nconst attemptStub = sandbox.stub(translationManager, &#x27;attemptTranslation&#x27;);\nconst result = await translationManager.translate(&#x27;Hello, world&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, { useCache: true });\nexpect(result.success).to.be.true;\nexpect(result.translation).to.equal(&#x27;Hola, mundo&#x27;);\nexpect(result.cached).to.be.true;\nexpect(attemptStub.called).to.be.false;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Attempted to wrap get which is already wrapped&quot;,&quot;estack&quot;:&quot;TypeError: Attempted to wrap get which is already wrapped\n    at checkWrappedMethod (node_modules/sinon/lib/sinon/util/core/wrap-method.js:67:21)\n    at wrapMethod (node_modules/sinon/lib/sinon/util/core/wrap-method.js:132:13)\n    at Function.stub (node_modules/sinon/lib/sinon/stub.js:130:44)\n    at Sandbox.stub (node_modules/sinon/lib/sinon/sandbox.js:389:39)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/translation-manager.test.js:120:21)\n--------------\nError: Stack Trace for original\n    at extendObjectWithWrappedMethods (node_modules/sinon/lib/sinon/util/core/wrap-method.js:173:34)\n    at wrapMethod (node_modules/sinon/lib/sinon/util/core/wrap-method.js:161:5)\n    at Function.stub (node_modules/sinon/lib/sinon/stub.js:130:44)\n    at Sandbox.stub (node_modules/sinon/lib/sinon/sandbox.js:389:39)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/translation-manager.test.js:74:21)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;56592458-a33d-4377-88fb-321b5dbd721c&quot;,&quot;parentUUID&quot;:&quot;0593a3b1-64ee-498c-b9f7-e151824353d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should try fallback services when primary service fails&quot;,&quot;fullTitle&quot;:&quot;TranslationManager translate should try fallback services when primary service fails&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Primary service fails\nsandbox.stub(translationManager, &#x27;attemptTranslation&#x27;)\n    .withArgs(&#x27;deepl&#x27;, sinon.match.any, sinon.match.any, sinon.match.any, sinon.match.any, sinon.match.any)\n    .resolves({\n        success: false,\n        error: &#x27;Service unavailable&#x27;,\n        service: &#x27;deepl&#x27;\n    });\n// Fallback succeeds\nsandbox.stub(translationManager, &#x27;fallbackTranslation&#x27;).resolves({\n    success: true,\n    translation: &#x27;Hola, mundo&#x27;,\n    confidence: 0.85,\n    service: &#x27;google&#x27;,\n    processingTime: 180,\n    fromLanguage: &#x27;en&#x27;,\n    toLanguage: &#x27;es&#x27;\n});\nsandbox.stub(translationManager.qualityAssessment, &#x27;assessTranslation&#x27;).resolves({\n    score: 0.85,\n    metrics: {\n        accuracy: 0.87,\n        fluency: 0.82,\n        cultural: 0.80\n    }\n});\nconst result = await translationManager.translate(&#x27;Hello, world&#x27;, &#x27;en&#x27;, &#x27;es&#x27;);\nexpect(result.success).to.be.true;\nexpect(result.translation).to.equal(&#x27;Hola, mundo&#x27;);\nexpect(result.service).to.equal(&#x27;google&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a76b75a1-d025-4fc2-bcf2-a4043450e3d7&quot;,&quot;parentUUID&quot;:&quot;0593a3b1-64ee-498c-b9f7-e151824353d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;84a65159-e4bf-4fdf-8cf1-bbe91d25c2de&quot;,&quot;a76b75a1-d025-4fc2-bcf2-a4043450e3d7&quot;],&quot;failures&quot;:[&quot;56592458-a33d-4377-88fb-321b5dbd721c&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:5,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;ca936fa6-551e-47d0-a1e1-b4b51d29e2c9&quot;,&quot;title&quot;:&quot;attemptTranslation&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/translation-manager.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/translation-manager.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;attemptTranslation\&quot;&quot;,&quot;fullTitle&quot;:&quot;TranslationManager attemptTranslation \&quot;before each\&quot; hook in \&quot;attemptTranslation\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;translationManager.isInitialized = true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;293767e7-5f2d-4246-a2d9-de59cf3709ec&quot;,&quot;parentUUID&quot;:&quot;ca936fa6-551e-47d0-a1e1-b4b51d29e2c9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should translate text with the specified service&quot;,&quot;fullTitle&quot;:&quot;TranslationManager attemptTranslation should translate text with the specified service&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock deepl service\nconst mockResult = {\n    translation: &#x27;Hola, mundo&#x27;,\n    confidence: 0.95,\n    detectedLanguage: &#x27;en&#x27;\n};\nsandbox.stub(translationManager.services.deepl, &#x27;translate&#x27;).resolves(mockResult);\nconst result = await translationManager.attemptTranslation(\n    &#x27;deepl&#x27;,\n    &#x27;Hello, world&#x27;,\n    &#x27;en&#x27;,\n    &#x27;es&#x27;\n);\nexpect(result.success).to.be.true;\nexpect(result.translation).to.equal(&#x27;Hola, mundo&#x27;);\nexpect(result.service).to.equal(&#x27;deepl&#x27;);\nexpect(translationManager.serviceHealth.deepl.healthy).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;87ab7c46-f84e-429f-9dfd-d0476341d356&quot;,&quot;parentUUID&quot;:&quot;ca936fa6-551e-47d0-a1e1-b4b51d29e2c9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle service errors gracefully&quot;,&quot;fullTitle&quot;:&quot;TranslationManager attemptTranslation should handle service errors gracefully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock service error\nsandbox.stub(translationManager.services.deepl, &#x27;translate&#x27;)\n    .rejects(new Error(&#x27;API rate limit exceeded&#x27;));\nconst result = await translationManager.attemptTranslation(\n    &#x27;deepl&#x27;,\n    &#x27;Hello, world&#x27;,\n    &#x27;en&#x27;,\n    &#x27;es&#x27;\n);\nexpect(result.success).to.be.false;\nexpect(result.error).to.include(&#x27;API rate limit exceeded&#x27;);\nexpect(result.service).to.equal(&#x27;deepl&#x27;);\nexpect(translationManager.serviceHealth.deepl.healthy).to.be.false;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;523b1a01-27b5-4bcd-a44e-54ba63496b67&quot;,&quot;parentUUID&quot;:&quot;ca936fa6-551e-47d0-a1e1-b4b51d29e2c9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;87ab7c46-f84e-429f-9dfd-d0476341d356&quot;,&quot;523b1a01-27b5-4bcd-a44e-54ba63496b67&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;09ebdf10-a57a-4f20-9653-00a339d3a56f&quot;,&quot;title&quot;:&quot;fallbackTranslation&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/translation-manager.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/translation-manager.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should try alternative services when primary fails&quot;,&quot;fullTitle&quot;:&quot;TranslationManager fallbackTranslation should try alternative services when primary fails&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;translationManager.isInitialized = true;\n// Mock successful translation with Google after DeepL fails\nsandbox.stub(translationManager, &#x27;attemptTranslation&#x27;)\n    .withArgs(&#x27;google&#x27;, sinon.match.any, sinon.match.any, sinon.match.any, sinon.match.any, sinon.match.any)\n    .resolves({\n        success: true,\n        translation: &#x27;Hola, mundo&#x27;,\n        confidence: 0.85,\n        service: &#x27;google&#x27;,\n        processingTime: 150\n    })\n    .withArgs(&#x27;deepl&#x27;, sinon.match.any, sinon.match.any, sinon.match.any, sinon.match.any, sinon.match.any)\n    .resolves({\n        success: false,\n        error: &#x27;Service unavailable&#x27;,\n        service: &#x27;deepl&#x27;\n    });\n// Mock service health\ntranslationManager.serviceHealth = {\n    deepl: { healthy: false },\n    google: { healthy: true },\n    azure: { healthy: true },\n    gpt4o: { healthy: true }\n};\nconst result = await translationManager.fallbackTranslation(\n    &#x27;Hello, world&#x27;,\n    &#x27;en&#x27;,\n    &#x27;es&#x27;,\n    &#x27;&#x27;,\n    &#x27;deepl&#x27;\n);\nexpect(result.success).to.be.true;\nexpect(result.translation).to.equal(&#x27;Hola, mundo&#x27;);\nexpect(result.service).to.equal(&#x27;google&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;success&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;success&#x27;)\n    at TranslationManager.fallbackTranslation (src/services/translation/translation-manager.js:383:24)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async Context.&lt;anonymous&gt; (tests/unit/services/translation/translation-manager.test.js:247:28)&quot;},&quot;uuid&quot;:&quot;c45cf4eb-eeda-4a90-986b-7f78b385e7a3&quot;,&quot;parentUUID&quot;:&quot;09ebdf10-a57a-4f20-9653-00a339d3a56f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return error when all services fail&quot;,&quot;fullTitle&quot;:&quot;TranslationManager fallbackTranslation should return error when all services fail&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;translationManager.isInitialized = true;\n// Mock all services failing\nsandbox.stub(translationManager, &#x27;attemptTranslation&#x27;).resolves({\n    success: false,\n    error: &#x27;Service unavailable&#x27;\n});\nconst result = await translationManager.fallbackTranslation(\n    &#x27;Hello, world&#x27;,\n    &#x27;en&#x27;,\n    &#x27;es&#x27;,\n    &#x27;&#x27;,\n    &#x27;deepl&#x27;\n);\nexpect(result.success).to.be.false;\nexpect(result.error).to.include(&#x27;All translation services failed&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;19d36357-c371-41b9-be11-b7a7909893f4&quot;,&quot;parentUUID&quot;:&quot;09ebdf10-a57a-4f20-9653-00a339d3a56f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;19d36357-c371-41b9-be11-b7a7909893f4&quot;],&quot;failures&quot;:[&quot;c45cf4eb-eeda-4a90-986b-7f78b385e7a3&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;7fd02588-e27f-4b26-af78-2233dafb83f2&quot;,&quot;title&quot;:&quot;TranslationService&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/translation-service.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/translation-service.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;TranslationService\&quot;&quot;,&quot;fullTitle&quot;:&quot;TranslationService \&quot;before each\&quot; hook in \&quot;TranslationService\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox = sinon.createSandbox();\nservice = new TranslationService({\n    serviceName: &#x27;test-service&#x27;,\n    apiKey: &#x27;test-api-key&#x27;\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;80ddfa05-89c7-49d8-b218-19e76e3d6848&quot;,&quot;parentUUID&quot;:&quot;7fd02588-e27f-4b26-af78-2233dafb83f2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;TranslationService\&quot;&quot;,&quot;fullTitle&quot;:&quot;TranslationService \&quot;after each\&quot; hook in \&quot;TranslationService\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;85770b0d-ced2-4590-b211-6eb3c3bf219f&quot;,&quot;parentUUID&quot;:&quot;7fd02588-e27f-4b26-af78-2233dafb83f2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d07d384a-894a-4522-af2a-4cb275b40099&quot;,&quot;title&quot;:&quot;initialization&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/translation-service.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/translation-service.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should create an instance with the provided config&quot;,&quot;fullTitle&quot;:&quot;TranslationService initialization should create an instance with the provided config&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(service).to.be.an.instanceOf(TranslationService);\nexpect(service.config.serviceName).to.equal(&#x27;test-service&#x27;);\nexpect(service.config.apiKey).to.equal(&#x27;test-api-key&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;serviceName&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;serviceName&#x27;)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/translation-service.test.js:24:35)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;26826be9-a213-4699-bdc9-d0e84ee1283b&quot;,&quot;parentUUID&quot;:&quot;d07d384a-894a-4522-af2a-4cb275b40099&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should have default values for non-provided config options&quot;,&quot;fullTitle&quot;:&quot;TranslationService initialization should have default values for non-provided config options&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(service.config.timeout).to.be.a(&#x27;number&#x27;);\nexpect(service.config.retries).to.be.a(&#x27;number&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;timeout&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;timeout&#x27;)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/translation-service.test.js:29:35)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;96ce8a6e-abaf-4aee-845c-439ab91d4cc8&quot;,&quot;parentUUID&quot;:&quot;d07d384a-894a-4522-af2a-4cb275b40099&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;26826be9-a213-4699-bdc9-d0e84ee1283b&quot;,&quot;96ce8a6e-abaf-4aee-845c-439ab91d4cc8&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;dc291433-7236-4d20-beb6-9e917409e3ba&quot;,&quot;title&quot;:&quot;abstract methods&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/translation-service.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/translation-service.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should throw error for abstract translate method&quot;,&quot;fullTitle&quot;:&quot;TranslationService abstract methods should throw error for abstract translate method&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;try {\n    await service.translate(&#x27;Hello&#x27;, &#x27;en&#x27;, &#x27;fr&#x27;);\n    expect.fail(&#x27;Should have thrown an error&#x27;);\n} catch (err) {\n    expect(err.message).to.include(&#x27;Method not implemented&#x27;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Should have thrown an error&#x27; to include &#x27;Method not implemented&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Should have thrown an error&#x27; to include &#x27;Method not implemented&#x27;\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/translation-service.test.js:40:40)&quot;},&quot;uuid&quot;:&quot;4f4dd17d-0298-46b6-9dba-11434e71a060&quot;,&quot;parentUUID&quot;:&quot;dc291433-7236-4d20-beb6-9e917409e3ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should throw error for abstract detectLanguage method&quot;,&quot;fullTitle&quot;:&quot;TranslationService abstract methods should throw error for abstract detectLanguage method&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;try {\n    await service.detectLanguage(&#x27;Hello&#x27;);\n    expect.fail(&#x27;Should have thrown an error&#x27;);\n} catch (err) {\n    expect(err.message).to.include(&#x27;Method not implemented&#x27;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Should have thrown an error&#x27; to include &#x27;Method not implemented&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Should have thrown an error&#x27; to include &#x27;Method not implemented&#x27;\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/translation-service.test.js:49:40)&quot;},&quot;uuid&quot;:&quot;6a9029bf-7b46-42b9-9ac3-07e1918020a3&quot;,&quot;parentUUID&quot;:&quot;dc291433-7236-4d20-beb6-9e917409e3ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;4f4dd17d-0298-46b6-9dba-11434e71a060&quot;,&quot;6a9029bf-7b46-42b9-9ac3-07e1918020a3&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;311baf68-a445-4391-b3ad-f9a69a3673be&quot;,&quot;title&quot;:&quot;utility methods&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/translation-service.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/translation-service.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should format language codes correctly&quot;,&quot;fullTitle&quot;:&quot;TranslationService utility methods should format language codes correctly&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(service.formatLanguageCode(&#x27;en-US&#x27;)).to.equal(&#x27;en&#x27;);\nexpect(service.formatLanguageCode(&#x27;zh-CN&#x27;)).to.equal(&#x27;zh&#x27;);\nexpect(service.formatLanguageCode(&#x27;en&#x27;)).to.equal(&#x27;en&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: service.formatLanguageCode is not a function&quot;,&quot;estack&quot;:&quot;TypeError: service.formatLanguageCode is not a function\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/translation-service.test.js:56:28)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;31eb2399-1de2-42a5-b7dd-3b2472c8bf16&quot;,&quot;parentUUID&quot;:&quot;311baf68-a445-4391-b3ad-f9a69a3673be&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;31eb2399-1de2-42a5-b7dd-3b2472c8bf16&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;e1ea515c-0017-45d2-9972-e844df704c53&quot;,&quot;title&quot;:&quot;ContextManager&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/utils/context-manager.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/utils/context-manager.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;ContextManager\&quot;&quot;,&quot;fullTitle&quot;:&quot;ContextManager \&quot;before each\&quot; hook in \&quot;ContextManager\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox = sinon.createSandbox();\ncontextManager = new ContextManager({\n    maxContextEntries: 5,\n    maxContextAgeMs: 1000 // 1 second for faster testing\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a507decf-42d2-4fc6-9db8-a539bbe23574&quot;,&quot;parentUUID&quot;:&quot;e1ea515c-0017-45d2-9972-e844df704c53&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;ContextManager\&quot;&quot;,&quot;fullTitle&quot;:&quot;ContextManager \&quot;after each\&quot; hook in \&quot;ContextManager\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d8edb166-10d2-47fd-a2f8-b3a3ca5150b7&quot;,&quot;parentUUID&quot;:&quot;e1ea515c-0017-45d2-9972-e844df704c53&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;59fbc39d-db4a-410d-9449-8c5a1cadd061&quot;,&quot;title&quot;:&quot;initialization&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/utils/context-manager.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/utils/context-manager.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should initialize with default settings&quot;,&quot;fullTitle&quot;:&quot;ContextManager initialization should initialize with default settings&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const defaultManager = new ContextManager();\nexpect(defaultManager.config.maxContextEntries).to.be.greaterThan(0);\nexpect(defaultManager.config.maxContextAgeMs).to.be.greaterThan(0);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;maxContextEntries&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;maxContextEntries&#x27;)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/context-manager.test.js:28:42)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;b45a455c-8f31-415d-9390-423f304b4699&quot;,&quot;parentUUID&quot;:&quot;59fbc39d-db4a-410d-9449-8c5a1cadd061&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should initialize with custom settings&quot;,&quot;fullTitle&quot;:&quot;ContextManager initialization should initialize with custom settings&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(contextManager.config.maxContextEntries).to.equal(5);\nexpect(contextManager.config.maxContextAgeMs).to.equal(1000);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;maxContextEntries&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;maxContextEntries&#x27;)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/context-manager.test.js:33:42)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;4870b0c3-4abe-432e-8304-41a7359d6bfe&quot;,&quot;parentUUID&quot;:&quot;59fbc39d-db4a-410d-9449-8c5a1cadd061&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should initialize empty conversation contexts&quot;,&quot;fullTitle&quot;:&quot;ContextManager initialization should initialize empty conversation contexts&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(contextManager.conversationContexts).to.be.instanceOf(Map);\nexpect(contextManager.conversationContexts.size).to.equal(0);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected undefined to be an instance of Map&quot;,&quot;estack&quot;:&quot;AssertionError: expected undefined to be an instance of Map\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/context-manager.test.js:38:63)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;92ff334b-fd30-4bfd-a66c-e6ba9a510b3e&quot;,&quot;parentUUID&quot;:&quot;59fbc39d-db4a-410d-9449-8c5a1cadd061&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;b45a455c-8f31-415d-9390-423f304b4699&quot;,&quot;4870b0c3-4abe-432e-8304-41a7359d6bfe&quot;,&quot;92ff334b-fd30-4bfd-a66c-e6ba9a510b3e&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;58ae8bdc-58c8-489b-9d79-cf3c7d724354&quot;,&quot;title&quot;:&quot;addTranslationEntry&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/utils/context-manager.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/utils/context-manager.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should add entries to the correct conversation&quot;,&quot;fullTitle&quot;:&quot;ContextManager addTranslationEntry should add entries to the correct conversation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const conversationId = &#x27;conversation1&#x27;;\nconst entry = {\n    original: &#x27;Hello&#x27;,\n    translated: &#x27;Hola&#x27;,\n    isSourceToTarget: true\n};\nawait contextManager.addTranslationEntry(conversationId, entry);\nexpect(contextManager.conversationContexts.has(conversationId)).to.be.true;\nconst context = contextManager.conversationContexts.get(conversationId);\nexpect(context).to.be.an(&#x27;array&#x27;);\nexpect(context.length).to.equal(1);\nexpect(context[0].original).to.equal(&#x27;Hello&#x27;);\nexpect(context[0].translated).to.equal(&#x27;Hola&#x27;);\nexpect(context[0].isSourceToTarget).to.be.true;\nexpect(context[0].timestamp).to.be.a(&#x27;number&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;has&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;has&#x27;)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/context-manager.test.js:54:56)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;},&quot;uuid&quot;:&quot;61f39e03-d520-4826-9f55-7efc1c2b7fdb&quot;,&quot;parentUUID&quot;:&quot;58ae8bdc-58c8-489b-9d79-cf3c7d724354&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle missing conversation ID&quot;,&quot;fullTitle&quot;:&quot;ContextManager addTranslationEntry should handle missing conversation ID&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// This should not throw\nawait contextManager.addTranslationEntry(null, { original: &#x27;Test&#x27; });\n// No entry should be added\nexpect(contextManager.conversationContexts.size).to.equal(0);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;size&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;size&#x27;)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/context-manager.test.js:69:56)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;},&quot;uuid&quot;:&quot;8b300bcd-5746-467d-b8e8-74420eea05ef&quot;,&quot;parentUUID&quot;:&quot;58ae8bdc-58c8-489b-9d79-cf3c7d724354&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should add multiple entries to the same conversation&quot;,&quot;fullTitle&quot;:&quot;ContextManager addTranslationEntry should add multiple entries to the same conversation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const conversationId = &#x27;conversation1&#x27;;\nawait contextManager.addTranslationEntry(conversationId, {\n    original: &#x27;Hello&#x27;,\n    translated: &#x27;Hola&#x27;,\n    isSourceToTarget: true\n});\nawait contextManager.addTranslationEntry(conversationId, {\n    original: &#x27;How are you?&#x27;,\n    translated: &#x27;Cmo ests?&#x27;,\n    isSourceToTarget: true\n});\nconst context = contextManager.conversationContexts.get(conversationId);\nexpect(context.length).to.equal(2);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;get&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;get&#x27;)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/context-manager.test.js:87:65)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;},&quot;uuid&quot;:&quot;2992209e-14e6-4355-92c2-61b7ced17a70&quot;,&quot;parentUUID&quot;:&quot;58ae8bdc-58c8-489b-9d79-cf3c7d724354&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should respect maxContextEntries limit&quot;,&quot;fullTitle&quot;:&quot;ContextManager addTranslationEntry should respect maxContextEntries limit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const conversationId = &#x27;conversation1&#x27;;\n// Add more entries than the limit (5)\nfor (let i = 0; i &lt; 7; i++) {\n    await contextManager.addTranslationEntry(conversationId, {\n        original: `Message ${i}`,\n        translated: `Translated ${i}`,\n        isSourceToTarget: true\n    });\n}\nconst context = contextManager.conversationContexts.get(conversationId);\nexpect(context.length).to.equal(5); // Limited to maxContextEntries\n// The oldest entries should be removed first\nexpect(context[0].original).to.equal(&#x27;Message 2&#x27;);\nexpect(context[4].original).to.equal(&#x27;Message 6&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;get&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;get&#x27;)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/context-manager.test.js:103:65)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;},&quot;uuid&quot;:&quot;9b67269d-cfb1-4b36-852c-50434868655b&quot;,&quot;parentUUID&quot;:&quot;58ae8bdc-58c8-489b-9d79-cf3c7d724354&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;61f39e03-d520-4826-9f55-7efc1c2b7fdb&quot;,&quot;8b300bcd-5746-467d-b8e8-74420eea05ef&quot;,&quot;2992209e-14e6-4355-92c2-61b7ced17a70&quot;,&quot;9b67269d-cfb1-4b36-852c-50434868655b&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;9d7927a8-d0d2-4de3-abda-cb7a637ad6bf&quot;,&quot;title&quot;:&quot;getConversationContext&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/utils/context-manager.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/utils/context-manager.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return empty string for non-existent conversation&quot;,&quot;fullTitle&quot;:&quot;ContextManager getConversationContext should return empty string for non-existent conversation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const context = await contextManager.getConversationContext(&#x27;nonexistent&#x27;);\nexpect(context).to.equal(&#x27;&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4fc32693-f824-4a3f-9ea5-3570ea7c262a&quot;,&quot;parentUUID&quot;:&quot;9d7927a8-d0d2-4de3-abda-cb7a637ad6bf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should format context entries correctly&quot;,&quot;fullTitle&quot;:&quot;ContextManager getConversationContext should format context entries correctly&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const conversationId = &#x27;conversation1&#x27;;\n// Add entries with timestamps\nconst entry1 = {\n    original: &#x27;Hello&#x27;,\n    translated: &#x27;Hola&#x27;,\n    isSourceToTarget: true,\n    timestamp: Date.now() - 500 // 500ms ago\n};\nconst entry2 = {\n    original: &#x27;How are you?&#x27;,\n    translated: &#x27;Cmo ests?&#x27;,\n    isSourceToTarget: true,\n    timestamp: Date.now() - 250 // 250ms ago\n};\nawait contextManager.addTranslationEntry(conversationId, entry1);\nawait contextManager.addTranslationEntry(conversationId, entry2);\nconst context = await contextManager.getConversationContext(conversationId);\n// Context should be a formatted string\nexpect(context).to.be.a(&#x27;string&#x27;);\nexpect(context.length).to.be.greaterThan(0);\n// Should contain both entries\nexpect(context).to.include(&#x27;Hello -&gt; Hola&#x27;);\nexpect(context).to.include(&#x27;How are you? -&gt; Cmo ests?&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected +0 to be above +0&quot;,&quot;estack&quot;:&quot;AssertionError: expected +0 to be above +0\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/context-manager.test.js:143:42)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;,&quot;diff&quot;:&quot;&quot;},&quot;uuid&quot;:&quot;4e58b4f8-dd10-40f9-96dd-b786c6dbc83e&quot;,&quot;parentUUID&quot;:&quot;9d7927a8-d0d2-4de3-abda-cb7a637ad6bf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle bidirectional conversation correctly&quot;,&quot;fullTitle&quot;:&quot;ContextManager getConversationContext should handle bidirectional conversation correctly&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const conversationId = &#x27;conversation1&#x27;;\n// Add entries with different directions\nawait contextManager.addTranslationEntry(conversationId, {\n    original: &#x27;Hello&#x27;,\n    translated: &#x27;Hola&#x27;,\n    isSourceToTarget: true // source -&gt; target\n});\nawait contextManager.addTranslationEntry(conversationId, {\n    original: &#x27;Bien, y t?&#x27;,\n    translated: &#x27;Good, and you?&#x27;,\n    isSourceToTarget: false // target -&gt; source\n});\nconst context = await contextManager.getConversationContext(conversationId);\n// Should show correct direction for each entry\nexpect(context).to.include(&#x27;Hello -&gt; Hola&#x27;);\nexpect(context).to.include(&#x27;Bien, y t? &lt;- Good, and you?&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;&#x27; to include &#x27;Hello -&gt; Hola&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;&#x27; to include &#x27;Hello -&gt; Hola&#x27;\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/context-manager.test.js:169:32)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;},&quot;uuid&quot;:&quot;cd3fac5a-f76a-4b24-a9e2-4c691d3e7830&quot;,&quot;parentUUID&quot;:&quot;9d7927a8-d0d2-4de3-abda-cb7a637ad6bf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4fc32693-f824-4a3f-9ea5-3570ea7c262a&quot;],&quot;failures&quot;:[&quot;4e58b4f8-dd10-40f9-96dd-b786c6dbc83e&quot;,&quot;cd3fac5a-f76a-4b24-a9e2-4c691d3e7830&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;9befd8a1-d7ce-40a7-84a9-cf83bc6158ea&quot;,&quot;title&quot;:&quot;pruneOldEntries&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/utils/context-manager.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/utils/context-manager.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should remove entries older than maxContextAgeMs&quot;,&quot;fullTitle&quot;:&quot;ContextManager pruneOldEntries should remove entries older than maxContextAgeMs&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const conversationId = &#x27;conversation1&#x27;;\n// Add one older entry and one newer entry\nawait contextManager.addTranslationEntry(conversationId, {\n    original: &#x27;Old message&#x27;,\n    translated: &#x27;Mensaje antiguo&#x27;,\n    isSourceToTarget: true,\n    timestamp: Date.now() - 2000 // 2 seconds ago (older than maxContextAgeMs)\n});\nawait contextManager.addTranslationEntry(conversationId, {\n    original: &#x27;New message&#x27;,\n    translated: &#x27;Mensaje nuevo&#x27;,\n    isSourceToTarget: true,\n    timestamp: Date.now() - 500 // 0.5 seconds ago (newer than maxContextAgeMs)\n});\n// Prune old entries\ncontextManager.pruneOldEntries(conversationId);\nconst context = contextManager.conversationContexts.get(conversationId);\nexpect(context.length).to.equal(1);\nexpect(context[0].original).to.equal(&#x27;New message&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: contextManager.pruneOldEntries is not a function&quot;,&quot;estack&quot;:&quot;TypeError: contextManager.pruneOldEntries is not a function\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/context-manager.test.js:194:28)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;},&quot;uuid&quot;:&quot;d36461a4-b02c-4b61-9364-42c58ce8a352&quot;,&quot;parentUUID&quot;:&quot;9befd8a1-d7ce-40a7-84a9-cf83bc6158ea&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle non-existent conversation ID&quot;,&quot;fullTitle&quot;:&quot;ContextManager pruneOldEntries should handle non-existent conversation ID&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// This should not throw\ncontextManager.pruneOldEntries(&#x27;nonexistent&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: contextManager.pruneOldEntries is not a function&quot;,&quot;estack&quot;:&quot;TypeError: contextManager.pruneOldEntries is not a function\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/context-manager.test.js:203:28)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;728c7716-4b6b-4b1f-97f5-a933c1e8c03c&quot;,&quot;parentUUID&quot;:&quot;9befd8a1-d7ce-40a7-84a9-cf83bc6158ea&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;d36461a4-b02c-4b61-9364-42c58ce8a352&quot;,&quot;728c7716-4b6b-4b1f-97f5-a933c1e8c03c&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;b0547447-4873-4de0-b4dd-50a1213ba193&quot;,&quot;title&quot;:&quot;clearContext&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/utils/context-manager.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/utils/context-manager.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should clear a specific conversation&quot;,&quot;fullTitle&quot;:&quot;ContextManager clearContext should clear a specific conversation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Add entries to two different conversations\nawait contextManager.addTranslationEntry(&#x27;conversation1&#x27;, {\n    original: &#x27;Hello1&#x27;,\n    translated: &#x27;Hola1&#x27;\n});\nawait contextManager.addTranslationEntry(&#x27;conversation2&#x27;, {\n    original: &#x27;Hello2&#x27;,\n    translated: &#x27;Hola2&#x27;\n});\n// Clear only one conversation\nawait contextManager.clearContext(&#x27;conversation1&#x27;);\nexpect(contextManager.conversationContexts.has(&#x27;conversation1&#x27;)).to.be.false;\nexpect(contextManager.conversationContexts.has(&#x27;conversation2&#x27;)).to.be.true;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: contextManager.clearContext is not a function&quot;,&quot;estack&quot;:&quot;TypeError: contextManager.clearContext is not a function\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/context-manager.test.js:221:34)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;},&quot;uuid&quot;:&quot;1ad258ed-768b-44ef-bc92-a02c765acb4c&quot;,&quot;parentUUID&quot;:&quot;b0547447-4873-4de0-b4dd-50a1213ba193&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should clear all conversations when no ID is provided&quot;,&quot;fullTitle&quot;:&quot;ContextManager clearContext should clear all conversations when no ID is provided&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Add entries to multiple conversations\nawait contextManager.addTranslationEntry(&#x27;conversation1&#x27;, {\n    original: &#x27;Hello1&#x27;,\n    translated: &#x27;Hola1&#x27;\n});\nawait contextManager.addTranslationEntry(&#x27;conversation2&#x27;, {\n    original: &#x27;Hello2&#x27;,\n    translated: &#x27;Hola2&#x27;\n});\n// Clear all conversations\nawait contextManager.clearContext();\nexpect(contextManager.conversationContexts.size).to.equal(0);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: contextManager.clearContext is not a function&quot;,&quot;estack&quot;:&quot;TypeError: contextManager.clearContext is not a function\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/context-manager.test.js:240:34)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;},&quot;uuid&quot;:&quot;7b2d3edc-af1e-4d24-b043-f9aa578a3829&quot;,&quot;parentUUID&quot;:&quot;b0547447-4873-4de0-b4dd-50a1213ba193&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle non-existent conversation ID&quot;,&quot;fullTitle&quot;:&quot;ContextManager clearContext should handle non-existent conversation ID&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// This should not throw\nawait contextManager.clearContext(&#x27;nonexistent&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: contextManager.clearContext is not a function&quot;,&quot;estack&quot;:&quot;TypeError: contextManager.clearContext is not a function\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/context-manager.test.js:247:34)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;e5bad150-7a6f-4a8b-b0b4-c0000a6f1e3b&quot;,&quot;parentUUID&quot;:&quot;b0547447-4873-4de0-b4dd-50a1213ba193&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;1ad258ed-768b-44ef-bc92-a02c765acb4c&quot;,&quot;7b2d3edc-af1e-4d24-b043-f9aa578a3829&quot;,&quot;e5bad150-7a6f-4a8b-b0b4-c0000a6f1e3b&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;8496bd77-9a12-451b-8645-fa227e5b104a&quot;,&quot;title&quot;:&quot;edge cases&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/utils/context-manager.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/utils/context-manager.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should handle empty entries&quot;,&quot;fullTitle&quot;:&quot;ContextManager edge cases should handle empty entries&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const conversationId = &#x27;conversation1&#x27;;\nawait contextManager.addTranslationEntry(conversationId, {\n    original: &#x27;&#x27;,\n    translated: &#x27;&#x27;,\n    isSourceToTarget: true\n});\nconst context = await contextManager.getConversationContext(conversationId);\nexpect(context).to.include(&#x27; -&gt;  &#x27;); // Empty but correctly formatted&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;&#x27; to include &#x27; -&gt;  &#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;&#x27; to include &#x27; -&gt;  &#x27;\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/context-manager.test.js:262:32)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;},&quot;uuid&quot;:&quot;e7a17966-65eb-4219-aa45-c85ccb080fff&quot;,&quot;parentUUID&quot;:&quot;8496bd77-9a12-451b-8645-fa227e5b104a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle entries without timestamps&quot;,&quot;fullTitle&quot;:&quot;ContextManager edge cases should handle entries without timestamps&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const conversationId = &#x27;conversation1&#x27;;\nawait contextManager.addTranslationEntry(conversationId, {\n    original: &#x27;Hello&#x27;,\n    translated: &#x27;Hola&#x27;,\n    isSourceToTarget: true\n    // No timestamp provided\n});\nconst context = contextManager.conversationContexts.get(conversationId);\nexpect(context[0].timestamp).to.be.a(&#x27;number&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;get&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;get&#x27;)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/context-manager.test.js:275:65)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;},&quot;uuid&quot;:&quot;4299a527-3861-4ca3-ab6d-5ed7b947450f&quot;,&quot;parentUUID&quot;:&quot;8496bd77-9a12-451b-8645-fa227e5b104a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle special characters in context&quot;,&quot;fullTitle&quot;:&quot;ContextManager edge cases should handle special characters in context&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const conversationId = &#x27;conversation1&#x27;;\nawait contextManager.addTranslationEntry(conversationId, {\n    original: &#x27;Special: !@#$%^&amp;*()_+{}[]|\\\\:;\&quot;\\&#x27;&lt;&gt;,.?/&#x27;,\n    translated: &#x27;Especial: !@#$%^&amp;*()_+{}[]|\\\\:;\&quot;\\&#x27;&lt;&gt;,.?/&#x27;,\n    isSourceToTarget: true\n});\nconst context = await contextManager.getConversationContext(conversationId);\nexpect(context).to.include(&#x27;Special: !@#$%^&amp;*()_+{}[]|\\\\:;\&quot;\\&#x27;&lt;&gt;,.?/ -&gt; Especial: !@#$%^&amp;*()_+{}[]|\\\\:;\&quot;\\&#x27;&lt;&gt;,.?/&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;&#x27; to include &#x27;Special: !@#$%^&amp;*()_+{}[]|\\:;\&quot;\\&#x27;&lt;&gt;,.?&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;&#x27; to include &#x27;Special: !@#$%^&amp;*()_+{}[]|\\:;\&quot;\\&#x27;&lt;&gt;,.?&#x27;\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/context-manager.test.js:289:32)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;},&quot;uuid&quot;:&quot;02466881-d565-4243-a7f4-26a9dffd660c&quot;,&quot;parentUUID&quot;:&quot;8496bd77-9a12-451b-8645-fa227e5b104a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;e7a17966-65eb-4219-aa45-c85ccb080fff&quot;,&quot;4299a527-3861-4ca3-ab6d-5ed7b947450f&quot;,&quot;02466881-d565-4243-a7f4-26a9dffd660c&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;28f4995f-40b8-4b42-a4a3-0d31dba7af43&quot;,&quot;title&quot;:&quot;LanguagePairOptimizer&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/utils/language-pair-optimizer.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/utils/language-pair-optimizer.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;LanguagePairOptimizer\&quot;&quot;,&quot;fullTitle&quot;:&quot;LanguagePairOptimizer \&quot;before each\&quot; hook in \&quot;LanguagePairOptimizer\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox = sinon.createSandbox();\n// Create mock translation manager\nmockTranslationManager = {\n    services: {\n        deepl: { healthy: true },\n        gpt4o: { healthy: true },\n        google: { healthy: true },\n        azure: { healthy: true }\n    }\n};\noptimizer = new LanguagePairOptimizer(mockTranslationManager);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d441a688-58f6-4a6f-b398-6d0e32c55999&quot;,&quot;parentUUID&quot;:&quot;28f4995f-40b8-4b42-a4a3-0d31dba7af43&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;LanguagePairOptimizer\&quot;&quot;,&quot;fullTitle&quot;:&quot;LanguagePairOptimizer \&quot;after each\&quot; hook in \&quot;LanguagePairOptimizer\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3fe90955-15cd-4acd-8228-f1995b6c5f32&quot;,&quot;parentUUID&quot;:&quot;28f4995f-40b8-4b42-a4a3-0d31dba7af43&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;90e7de0a-3bda-4f32-810e-cfd5bcc2de2f&quot;,&quot;title&quot;:&quot;initialization&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/utils/language-pair-optimizer.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/utils/language-pair-optimizer.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should initialize language pairs from config&quot;,&quot;fullTitle&quot;:&quot;LanguagePairOptimizer initialization should initialize language pairs from config&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(optimizer.languagePairs).to.be.instanceOf(Map);\nexpect(optimizer.languagePairs.size).to.be.greaterThan(0);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected undefined to be an instance of Map&quot;,&quot;estack&quot;:&quot;AssertionError: expected undefined to be an instance of Map\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/language-pair-optimizer.test.js:37:51)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;3847d69c-56ef-4ec9-bbe3-3f51f913065f&quot;,&quot;parentUUID&quot;:&quot;90e7de0a-3bda-4f32-810e-cfd5bcc2de2f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should load language sets from config&quot;,&quot;fullTitle&quot;:&quot;LanguagePairOptimizer initialization should load language sets from config&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(optimizer.europeanLanguages).to.be.instanceOf(Set);\nexpect(optimizer.europeanLanguages.size).to.be.greaterThan(0);\nexpect(optimizer.europeanLanguages.has(&#x27;en&#x27;)).to.be.true;\nexpect(optimizer.asianLanguages).to.be.instanceOf(Set);\nexpect(optimizer.asianLanguages.size).to.be.greaterThan(0);\nexpect(optimizer.asianLanguages.has(&#x27;ja&#x27;)).to.be.true;\nexpect(optimizer.adaptationLanguages).to.be.instanceOf(Set);\nexpect(optimizer.adaptationLanguages.size).to.be.greaterThan(0);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected undefined to be an instance of Set&quot;,&quot;estack&quot;:&quot;AssertionError: expected undefined to be an instance of Set\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/language-pair-optimizer.test.js:42:55)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;0da21848-c28a-4330-ae3f-2b5ae239f6a8&quot;,&quot;parentUUID&quot;:&quot;90e7de0a-3bda-4f32-810e-cfd5bcc2de2f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should load default ranking from config&quot;,&quot;fullTitle&quot;:&quot;LanguagePairOptimizer initialization should load default ranking from config&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(optimizer.defaultRanking).to.be.an(&#x27;object&#x27;);\nexpect(optimizer.defaultRanking.quality).to.be.an(&#x27;array&#x27;);\nexpect(optimizer.defaultRanking.speed).to.be.an(&#x27;array&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected undefined to be an object&quot;,&quot;estack&quot;:&quot;AssertionError: expected undefined to be an object\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/language-pair-optimizer.test.js:55:52)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;2f87ef24-da26-468b-85ae-2d62a3ae389b&quot;,&quot;parentUUID&quot;:&quot;90e7de0a-3bda-4f32-810e-cfd5bcc2de2f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;3847d69c-56ef-4ec9-bbe3-3f51f913065f&quot;,&quot;0da21848-c28a-4330-ae3f-2b5ae239f6a8&quot;,&quot;2f87ef24-da26-468b-85ae-2d62a3ae389b&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;d0cf0464-912d-4c3a-97a7-8d5e24d60801&quot;,&quot;title&quot;:&quot;getBestServiceForLanguagePair&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/utils/language-pair-optimizer.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/utils/language-pair-optimizer.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should select based on language pair config&quot;,&quot;fullTitle&quot;:&quot;LanguagePairOptimizer getBestServiceForLanguagePair should select based on language pair config&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// English to Spanish is a configured pair\nconst service = optimizer.getBestServiceForLanguagePair(&#x27;en&#x27;, &#x27;es&#x27;, {\n    priority: &#x27;quality&#x27;,\n    serviceHealth: {\n        deepl: { healthy: true },\n        gpt4o: { healthy: true },\n        google: { healthy: true },\n        azure: { healthy: true }\n    }\n});\n// Should select one of the configured services\nexpect([&#x27;deepl&#x27;, &#x27;gpt4o&#x27;, &#x27;google&#x27;, &#x27;azure&#x27;]).to.include(service);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;general&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;general&#x27;)\n    at LanguagePairOptimizer.getBestServiceForLanguagePair (src/services/translation/utils/language-pair-optimizer.js:112:57)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/language-pair-optimizer.test.js:64:39)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;5960a420-d02d-4b09-b911-d45b6dba5476&quot;,&quot;parentUUID&quot;:&quot;d0cf0464-912d-4c3a-97a7-8d5e24d60801&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should prioritize based on quality score&quot;,&quot;fullTitle&quot;:&quot;LanguagePairOptimizer getBestServiceForLanguagePair should prioritize based on quality score&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock a language pair with deepl having highest quality\noptimizer.languagePairs.set(&#x27;en-fr&#x27;, {\n    source: &#x27;en&#x27;,\n    target: &#x27;fr&#x27;,\n    services: {\n        deepl: { quality: 0.95, speed: 0.8 },\n        gpt4o: { quality: 0.9, speed: 0.7 },\n        google: { quality: 0.85, speed: 0.9 },\n        azure: { quality: 0.8, speed: 0.85 }\n    }\n});\nconst service = optimizer.getBestServiceForLanguagePair(&#x27;en&#x27;, &#x27;fr&#x27;, {\n    priority: &#x27;quality&#x27;,\n    serviceHealth: {\n        deepl: { healthy: true },\n        gpt4o: { healthy: true },\n        google: { healthy: true },\n        azure: { healthy: true }\n    }\n});\n// Should select deepl as it has highest quality\nexpect(service).to.equal(&#x27;deepl&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;set&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;set&#x27;)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/language-pair-optimizer.test.js:80:37)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;eca95e45-7b74-4a5b-936c-95a8f8761c1f&quot;,&quot;parentUUID&quot;:&quot;d0cf0464-912d-4c3a-97a7-8d5e24d60801&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should prioritize based on speed&quot;,&quot;fullTitle&quot;:&quot;LanguagePairOptimizer getBestServiceForLanguagePair should prioritize based on speed&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock a language pair with google having highest speed\noptimizer.languagePairs.set(&#x27;en-fr&#x27;, {\n    source: &#x27;en&#x27;,\n    target: &#x27;fr&#x27;,\n    services: {\n        deepl: { quality: 0.95, speed: 0.8 },\n        gpt4o: { quality: 0.9, speed: 0.7 },\n        google: { quality: 0.85, speed: 0.9 }, // Highest speed\n        azure: { quality: 0.8, speed: 0.85 }\n    }\n});\nconst service = optimizer.getBestServiceForLanguagePair(&#x27;en&#x27;, &#x27;fr&#x27;, {\n    priority: &#x27;speed&#x27;, // Prioritize speed\n    serviceHealth: {\n        deepl: { healthy: true },\n        gpt4o: { healthy: true },\n        google: { healthy: true },\n        azure: { healthy: true }\n    }\n});\n// Should select google as it has highest speed\nexpect(service).to.equal(&#x27;google&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;set&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;set&#x27;)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/language-pair-optimizer.test.js:107:37)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;85400a74-bb8c-4767-b99c-ff92ff7c1737&quot;,&quot;parentUUID&quot;:&quot;d0cf0464-912d-4c3a-97a7-8d5e24d60801&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should respect service health status&quot;,&quot;fullTitle&quot;:&quot;LanguagePairOptimizer getBestServiceForLanguagePair should respect service health status&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Mock a language pair with deepl having highest quality but unhealthy\noptimizer.languagePairs.set(&#x27;en-fr&#x27;, {\n    source: &#x27;en&#x27;,\n    target: &#x27;fr&#x27;,\n    services: {\n        deepl: { quality: 0.95, speed: 0.8 },\n        gpt4o: { quality: 0.9, speed: 0.7 },\n        google: { quality: 0.85, speed: 0.9 },\n        azure: { quality: 0.8, speed: 0.85 }\n    }\n});\nconst service = optimizer.getBestServiceForLanguagePair(&#x27;en&#x27;, &#x27;fr&#x27;, {\n    priority: &#x27;quality&#x27;,\n    serviceHealth: {\n        deepl: { healthy: false }, // Unhealthy\n        gpt4o: { healthy: true },\n        google: { healthy: true },\n        azure: { healthy: true }\n    }\n});\n// Should select gpt4o as it has second highest quality\nexpect(service).to.equal(&#x27;gpt4o&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;set&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;set&#x27;)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/language-pair-optimizer.test.js:134:37)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;d24745fe-70ad-451b-a1c9-383fe27f017a&quot;,&quot;parentUUID&quot;:&quot;d0cf0464-912d-4c3a-97a7-8d5e24d60801&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle unconfigured language pairs&quot;,&quot;fullTitle&quot;:&quot;LanguagePairOptimizer getBestServiceForLanguagePair should handle unconfigured language pairs&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Unconfigured language pair\nconst service = optimizer.getBestServiceForLanguagePair(&#x27;it&#x27;, &#x27;ru&#x27;, {\n    priority: &#x27;quality&#x27;,\n    serviceHealth: {\n        deepl: { healthy: true },\n        gpt4o: { healthy: true },\n        google: { healthy: true },\n        azure: { healthy: true }\n    }\n});\n// Should still select a service\nexpect([&#x27;deepl&#x27;, &#x27;gpt4o&#x27;, &#x27;google&#x27;, &#x27;azure&#x27;]).to.include(service);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;general&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;general&#x27;)\n    at LanguagePairOptimizer.getBestServiceForLanguagePair (src/services/translation/utils/language-pair-optimizer.js:112:57)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/language-pair-optimizer.test.js:161:39)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;8e8e69b8-0024-4110-8528-dcffd683b620&quot;,&quot;parentUUID&quot;:&quot;d0cf0464-912d-4c3a-97a7-8d5e24d60801&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should prefer DeepL for European languages&quot;,&quot;fullTitle&quot;:&quot;LanguagePairOptimizer getBestServiceForLanguagePair should prefer DeepL for European languages&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Both Italian and French are European languages\nconst service = optimizer.getBestServiceForLanguagePair(&#x27;it&#x27;, &#x27;fr&#x27;, {\n    priority: &#x27;quality&#x27;,\n    serviceHealth: {\n        deepl: { healthy: true },\n        gpt4o: { healthy: true },\n        google: { healthy: true },\n        azure: { healthy: true }\n    }\n});\n// Should select DeepL for European language pair\nexpect(service).to.equal(&#x27;deepl&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;general&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;general&#x27;)\n    at LanguagePairOptimizer.getBestServiceForLanguagePair (src/services/translation/utils/language-pair-optimizer.js:112:57)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/language-pair-optimizer.test.js:177:39)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;17e87e0a-4d03-4fa3-981f-866ef51e4738&quot;,&quot;parentUUID&quot;:&quot;d0cf0464-912d-4c3a-97a7-8d5e24d60801&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should prefer GPT-4o for Asian languages&quot;,&quot;fullTitle&quot;:&quot;LanguagePairOptimizer getBestServiceForLanguagePair should prefer GPT-4o for Asian languages&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Japanese is in the adaptation languages list\nconst service = optimizer.getBestServiceForLanguagePair(&#x27;en&#x27;, &#x27;ja&#x27;, {\n    priority: &#x27;quality&#x27;,\n    serviceHealth: {\n        deepl: { healthy: true },\n        gpt4o: { healthy: true },\n        google: { healthy: true },\n        azure: { healthy: true }\n    }\n});\n// Should select GPT-4o for Asian language\nexpect(service).to.equal(&#x27;gpt4o&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;general&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;general&#x27;)\n    at LanguagePairOptimizer.getBestServiceForLanguagePair (src/services/translation/utils/language-pair-optimizer.js:112:57)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/language-pair-optimizer.test.js:193:39)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;83a5da8b-f02a-4adf-8409-0c20644f64db&quot;,&quot;parentUUID&quot;:&quot;d0cf0464-912d-4c3a-97a7-8d5e24d60801&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should respect user preference&quot;,&quot;fullTitle&quot;:&quot;LanguagePairOptimizer getBestServiceForLanguagePair should respect user preference&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Even though deepl might be better for this pair\nconst service = optimizer.getBestServiceForLanguagePair(&#x27;en&#x27;, &#x27;fr&#x27;, {\n    priority: &#x27;quality&#x27;,\n    serviceHealth: {\n        deepl: { healthy: true },\n        gpt4o: { healthy: true },\n        google: { healthy: true },\n        azure: { healthy: true }\n    },\n    userPreference: &#x27;google&#x27; // User prefers Google\n});\n// Should respect user preference\nexpect(service).to.equal(&#x27;google&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;google&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;google&#x27;)\n    at LanguagePairOptimizer.isServiceSupportingLanguagePair (src/services/translation/utils/language-pair-optimizer.js:208:74)\n    at LanguagePairOptimizer.getBestServiceForLanguagePair (src/services/translation/utils/language-pair-optimizer.js:72:36)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/language-pair-optimizer.test.js:209:39)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;9010de0f-0250-466e-aaee-070b81993550&quot;,&quot;parentUUID&quot;:&quot;d0cf0464-912d-4c3a-97a7-8d5e24d60801&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should ignore unhealthy user preference&quot;,&quot;fullTitle&quot;:&quot;LanguagePairOptimizer getBestServiceForLanguagePair should ignore unhealthy user preference&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// User prefers Google but it&#x27;s unhealthy\nconst service = optimizer.getBestServiceForLanguagePair(&#x27;en&#x27;, &#x27;fr&#x27;, {\n    priority: &#x27;quality&#x27;,\n    serviceHealth: {\n        deepl: { healthy: true },\n        gpt4o: { healthy: true },\n        google: { healthy: false }, // Unhealthy\n        azure: { healthy: true }\n    },\n    userPreference: &#x27;google&#x27; // Unhealthy\n});\n// Should not use user preference as it&#x27;s unhealthy\nexpect(service).to.not.equal(&#x27;google&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;google&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;google&#x27;)\n    at LanguagePairOptimizer.isServiceSupportingLanguagePair (src/services/translation/utils/language-pair-optimizer.js:208:74)\n    at LanguagePairOptimizer.getBestServiceForLanguagePair (src/services/translation/utils/language-pair-optimizer.js:72:36)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/language-pair-optimizer.test.js:226:39)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;48d33c50-52ed-4945-987d-59e9241db50d&quot;,&quot;parentUUID&quot;:&quot;d0cf0464-912d-4c3a-97a7-8d5e24d60801&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should prioritize context-aware services when context is required&quot;,&quot;fullTitle&quot;:&quot;LanguagePairOptimizer getBestServiceForLanguagePair should prioritize context-aware services when context is required&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const service = optimizer.getBestServiceForLanguagePair(&#x27;en&#x27;, &#x27;fr&#x27;, {\n    priority: &#x27;speed&#x27;, // Would normally select Google\n    serviceHealth: {\n        deepl: { healthy: true },\n        gpt4o: { healthy: true },\n        google: { healthy: true },\n        azure: { healthy: true }\n    },\n    requiresContext: true // Requires context\n});\n// Should prioritize a context-aware service (based on defaultRanking.context)\nexpect(service).to.equal(optimizer.defaultRanking.context[0]);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;gpt4o&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;gpt4o&#x27;)\n    at LanguagePairOptimizer.isServiceSupportingLanguagePair (src/services/translation/utils/language-pair-optimizer.js:208:74)\n    at LanguagePairOptimizer.getBestServiceForLanguagePair (src/services/translation/utils/language-pair-optimizer.js:80:22)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/language-pair-optimizer.test.js:242:39)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;71d14375-82fd-4e76-9117-e7c65be70393&quot;,&quot;parentUUID&quot;:&quot;d0cf0464-912d-4c3a-97a7-8d5e24d60801&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return a healthy service when all preferred services are unhealthy&quot;,&quot;fullTitle&quot;:&quot;LanguagePairOptimizer getBestServiceForLanguagePair should return a healthy service when all preferred services are unhealthy&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// All main services unhealthy\nconst service = optimizer.getBestServiceForLanguagePair(&#x27;en&#x27;, &#x27;fr&#x27;, {\n    priority: &#x27;quality&#x27;,\n    serviceHealth: {\n        deepl: { healthy: false },\n        gpt4o: { healthy: false },\n        google: { healthy: false },\n        azure: { healthy: true } // Only Azure is healthy\n    }\n});\n// Should select the only healthy service\nexpect(service).to.equal(&#x27;azure&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;general&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;general&#x27;)\n    at LanguagePairOptimizer.getBestServiceForLanguagePair (src/services/translation/utils/language-pair-optimizer.js:112:57)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/language-pair-optimizer.test.js:259:39)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;071b389e-9588-4689-a321-6fc3ef3f302d&quot;,&quot;parentUUID&quot;:&quot;d0cf0464-912d-4c3a-97a7-8d5e24d60801&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;5960a420-d02d-4b09-b911-d45b6dba5476&quot;,&quot;eca95e45-7b74-4a5b-936c-95a8f8761c1f&quot;,&quot;85400a74-bb8c-4767-b99c-ff92ff7c1737&quot;,&quot;d24745fe-70ad-451b-a1c9-383fe27f017a&quot;,&quot;8e8e69b8-0024-4110-8528-dcffd683b620&quot;,&quot;17e87e0a-4d03-4fa3-981f-866ef51e4738&quot;,&quot;83a5da8b-f02a-4adf-8409-0c20644f64db&quot;,&quot;9010de0f-0250-466e-aaee-070b81993550&quot;,&quot;48d33c50-52ed-4945-987d-59e9241db50d&quot;,&quot;71d14375-82fd-4e76-9117-e7c65be70393&quot;,&quot;071b389e-9588-4689-a321-6fc3ef3f302d&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;63b5b84a-2485-44cc-b5b6-a866134a9d95&quot;,&quot;title&quot;:&quot;updateQualityScore&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/utils/language-pair-optimizer.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/utils/language-pair-optimizer.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should update quality score with smoothing&quot;,&quot;fullTitle&quot;:&quot;LanguagePairOptimizer updateQualityScore should update quality score with smoothing&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Set up initial quality score\noptimizer.languagePairs.set(&#x27;en-es&#x27;, {\n    source: &#x27;en&#x27;,\n    target: &#x27;es&#x27;,\n    services: {\n        deepl: { quality: 0.8, speed: 0.8 }\n    }\n});\n// Update quality score\noptimizer.updateQualityScore(&#x27;deepl&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, 1.0); // Perfect score\n// Get updated pair\nconst pair = optimizer.languagePairs.get(&#x27;en-es&#x27;);\n// Should update with smoothing (0.8 * 0.9 + 1.0 * 0.1 = 0.82)\nexpect(pair.services.deepl.quality).to.be.closeTo(0.82, 0.001);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;set&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;set&#x27;)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/language-pair-optimizer.test.js:277:37)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;fc40d367-4c3d-402d-a361-d880426e16af&quot;,&quot;parentUUID&quot;:&quot;63b5b84a-2485-44cc-b5b6-a866134a9d95&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle non-existent language pair&quot;,&quot;fullTitle&quot;:&quot;LanguagePairOptimizer updateQualityScore should handle non-existent language pair&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// This should not throw\noptimizer.updateQualityScore(&#x27;deepl&#x27;, &#x27;nonexistent&#x27;, &#x27;pair&#x27;, 1.0);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;153f7ecc-5b43-406c-9fb3-e7c4b95ee136&quot;,&quot;parentUUID&quot;:&quot;63b5b84a-2485-44cc-b5b6-a866134a9d95&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle non-existent service&quot;,&quot;fullTitle&quot;:&quot;LanguagePairOptimizer updateQualityScore should handle non-existent service&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// This should not throw\noptimizer.updateQualityScore(&#x27;nonexistent&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, 1.0);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a47873fd-e49c-4f32-a674-e5ca217a615d&quot;,&quot;parentUUID&quot;:&quot;63b5b84a-2485-44cc-b5b6-a866134a9d95&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;153f7ecc-5b43-406c-9fb3-e7c4b95ee136&quot;,&quot;a47873fd-e49c-4f32-a674-e5ca217a615d&quot;],&quot;failures&quot;:[&quot;fc40d367-4c3d-402d-a361-d880426e16af&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;929953a6-d483-459d-be8a-cb4245b778bd&quot;,&quot;title&quot;:&quot;edge cases&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/utils/language-pair-optimizer.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/utils/language-pair-optimizer.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should handle all services being unhealthy&quot;,&quot;fullTitle&quot;:&quot;LanguagePairOptimizer edge cases should handle all services being unhealthy&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const service = optimizer.getBestServiceForLanguagePair(&#x27;en&#x27;, &#x27;fr&#x27;, {\n    priority: &#x27;quality&#x27;,\n    serviceHealth: {\n        deepl: { healthy: false },\n        gpt4o: { healthy: false },\n        google: { healthy: false },\n        azure: { healthy: false }\n    }\n});\n// Should return a default service\nexpect(service).to.equal(&#x27;google&#x27;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;general&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;general&#x27;)\n    at LanguagePairOptimizer.getBestServiceForLanguagePair (src/services/translation/utils/language-pair-optimizer.js:112:57)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/language-pair-optimizer.test.js:308:39)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;16281ba8-d009-4fff-b6c0-81abdea40239&quot;,&quot;parentUUID&quot;:&quot;929953a6-d483-459d-be8a-cb4245b778bd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle empty serviceHealth object&quot;,&quot;fullTitle&quot;:&quot;LanguagePairOptimizer edge cases should handle empty serviceHealth object&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const service = optimizer.getBestServiceForLanguagePair(&#x27;en&#x27;, &#x27;fr&#x27;, {\n    priority: &#x27;quality&#x27;,\n    serviceHealth: {}\n});\n// Should return a service based on default ranking\nexpect([&#x27;deepl&#x27;, &#x27;gpt4o&#x27;, &#x27;google&#x27;, &#x27;azure&#x27;]).to.include(service);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;general&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;general&#x27;)\n    at LanguagePairOptimizer.getBestServiceForLanguagePair (src/services/translation/utils/language-pair-optimizer.js:112:57)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/language-pair-optimizer.test.js:323:39)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;524a2836-059f-4754-9f7c-1c545d7557c4&quot;,&quot;parentUUID&quot;:&quot;929953a6-d483-459d-be8a-cb4245b778bd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle missing options&quot;,&quot;fullTitle&quot;:&quot;LanguagePairOptimizer edge cases should handle missing options&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const service = optimizer.getBestServiceForLanguagePair(&#x27;en&#x27;, &#x27;fr&#x27;);\n// Should return a service without throwing\nexpect([&#x27;deepl&#x27;, &#x27;gpt4o&#x27;, &#x27;google&#x27;, &#x27;azure&#x27;]).to.include(service);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;general&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;general&#x27;)\n    at LanguagePairOptimizer.getBestServiceForLanguagePair (src/services/translation/utils/language-pair-optimizer.js:112:57)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/language-pair-optimizer.test.js:333:39)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;abd13cee-f980-4a88-ac3d-3edcd7ebf4da&quot;,&quot;parentUUID&quot;:&quot;929953a6-d483-459d-be8a-cb4245b778bd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;16281ba8-d009-4fff-b6c0-81abdea40239&quot;,&quot;524a2836-059f-4754-9f7c-1c545d7557c4&quot;,&quot;abd13cee-f980-4a88-ac3d-3edcd7ebf4da&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;7700bcf3-0cd5-43d3-858a-3f56e8ecbb48&quot;,&quot;title&quot;:&quot;TranslationCache&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/utils/translation-cache.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/utils/translation-cache.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;TranslationCache\&quot;&quot;,&quot;fullTitle&quot;:&quot;TranslationCache \&quot;before each\&quot; hook in \&quot;TranslationCache\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox = sinon.createSandbox();\ncache = new TranslationCache({\n    maxCacheSize: 10,\n    defaultExpirySeconds: 60\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3691d8bf-fe66-4551-aab7-13d8361c7c2c&quot;,&quot;parentUUID&quot;:&quot;7700bcf3-0cd5-43d3-858a-3f56e8ecbb48&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;TranslationCache\&quot;&quot;,&quot;fullTitle&quot;:&quot;TranslationCache \&quot;after each\&quot; hook in \&quot;TranslationCache\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sandbox.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d391b922-86ef-4e95-9fce-15a0b65a1c9e&quot;,&quot;parentUUID&quot;:&quot;7700bcf3-0cd5-43d3-858a-3f56e8ecbb48&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3dc26192-e87c-4714-a3fc-52a449b2e5d8&quot;,&quot;title&quot;:&quot;initialization&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/utils/translation-cache.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/utils/translation-cache.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should initialize with default settings&quot;,&quot;fullTitle&quot;:&quot;TranslationCache initialization should initialize with default settings&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const defaultCache = new TranslationCache();\nexpect(defaultCache.config.maxCacheSize).to.be.greaterThan(0);\nexpect(defaultCache.config.defaultExpirySeconds).to.be.greaterThan(0);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;maxCacheSize&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;maxCacheSize&#x27;)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/translation-cache.test.js:28:40)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;177b72c0-44ee-4d41-84eb-3613f523367e&quot;,&quot;parentUUID&quot;:&quot;3dc26192-e87c-4714-a3fc-52a449b2e5d8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should initialize with custom settings&quot;,&quot;fullTitle&quot;:&quot;TranslationCache initialization should initialize with custom settings&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(cache.config.maxCacheSize).to.equal(10);\nexpect(cache.config.defaultExpirySeconds).to.equal(60);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;maxCacheSize&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;maxCacheSize&#x27;)\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/translation-cache.test.js:33:33)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;b781e728-a285-4e6c-95e9-c1b8680945f0&quot;,&quot;parentUUID&quot;:&quot;3dc26192-e87c-4714-a3fc-52a449b2e5d8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should initialize stats with zero values&quot;,&quot;fullTitle&quot;:&quot;TranslationCache initialization should initialize stats with zero values&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(cache.stats.hits).to.equal(0);\nexpect(cache.stats.misses).to.equal(0);\nexpect(cache.stats.totalRequests).to.equal(0);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected undefined to equal +0&quot;,&quot;estack&quot;:&quot;AssertionError: expected undefined to equal +0\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/translation-cache.test.js:40:50)\n    at process.processImmediate (node:internal/timers:491:21)&quot;},&quot;uuid&quot;:&quot;9d576d2e-492a-4710-92ee-c503835dfec6&quot;,&quot;parentUUID&quot;:&quot;3dc26192-e87c-4714-a3fc-52a449b2e5d8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;177b72c0-44ee-4d41-84eb-3613f523367e&quot;,&quot;b781e728-a285-4e6c-95e9-c1b8680945f0&quot;,&quot;9d576d2e-492a-4710-92ee-c503835dfec6&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;dafdf7f2-866e-475e-bfb3-48c4ca9dd02f&quot;,&quot;title&quot;:&quot;generateKey&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/utils/translation-cache.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/utils/translation-cache.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should generate unique keys for different text&quot;,&quot;fullTitle&quot;:&quot;TranslationCache generateKey should generate unique keys for different text&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const key1 = cache.generateKey(&#x27;Hello&#x27;, &#x27;en&#x27;, &#x27;es&#x27;);\nconst key2 = cache.generateKey(&#x27;World&#x27;, &#x27;en&#x27;, &#x27;es&#x27;);\nexpect(key1).to.not.equal(key2);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b4f31643-043d-4612-a84d-b49a81390203&quot;,&quot;parentUUID&quot;:&quot;dafdf7f2-866e-475e-bfb3-48c4ca9dd02f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should generate unique keys for different language pairs&quot;,&quot;fullTitle&quot;:&quot;TranslationCache generateKey should generate unique keys for different language pairs&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const key1 = cache.generateKey(&#x27;Hello&#x27;, &#x27;en&#x27;, &#x27;es&#x27;);\nconst key2 = cache.generateKey(&#x27;Hello&#x27;, &#x27;en&#x27;, &#x27;fr&#x27;);\nexpect(key1).to.not.equal(key2);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2c149feb-e3aa-4b25-80f3-b3b529a76402&quot;,&quot;parentUUID&quot;:&quot;dafdf7f2-866e-475e-bfb3-48c4ca9dd02f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should generate unique keys for different services&quot;,&quot;fullTitle&quot;:&quot;TranslationCache generateKey should generate unique keys for different services&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const key1 = cache.generateKey(&#x27;Hello&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;);\nconst key2 = cache.generateKey(&#x27;Hello&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;google&#x27;);\nexpect(key1).to.not.equal(key2);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;051a3bca-4fc0-4eff-95fe-5a094e3b963c&quot;,&quot;parentUUID&quot;:&quot;dafdf7f2-866e-475e-bfb3-48c4ca9dd02f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should include options in key generation&quot;,&quot;fullTitle&quot;:&quot;TranslationCache generateKey should include options in key generation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const key1 = cache.generateKey(&#x27;Hello&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;, { formality: &#x27;formal&#x27; });\nconst key2 = cache.generateKey(&#x27;Hello&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;, { formality: &#x27;informal&#x27; });\nexpect(key1).to.not.equal(key2);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;98e60143-3b03-44fc-bf61-df30a7f823ec&quot;,&quot;parentUUID&quot;:&quot;dafdf7f2-866e-475e-bfb3-48c4ca9dd02f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b4f31643-043d-4612-a84d-b49a81390203&quot;,&quot;2c149feb-e3aa-4b25-80f3-b3b529a76402&quot;,&quot;051a3bca-4fc0-4eff-95fe-5a094e3b963c&quot;,&quot;98e60143-3b03-44fc-bf61-df30a7f823ec&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;164eb181-ac21-4b3e-a95e-9a1cea4c425a&quot;,&quot;title&quot;:&quot;set and get&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/utils/translation-cache.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/utils/translation-cache.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should store and retrieve translations&quot;,&quot;fullTitle&quot;:&quot;TranslationCache set and get should store and retrieve translations&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const text = &#x27;Hello world&#x27;;\nconst fromLang = &#x27;en&#x27;;\nconst toLang = &#x27;es&#x27;;\nconst service = &#x27;deepl&#x27;;\nconst result = {\n    translation: &#x27;Hola mundo&#x27;,\n    confidence: 0.95\n};\nawait cache.set(text, fromLang, toLang, service, result);\nconst cached = await cache.get(text, fromLang, toLang, service);\nexpect(cached).to.deep.equal(result);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected { translation: &#x27;Hola mundo&#x27;, (2) } to deeply equal { translation: &#x27;Hola mundo&#x27;, (1) }&quot;,&quot;estack&quot;:&quot;AssertionError: expected { translation: &#x27;Hola mundo&#x27;, (2) } to deeply equal { translation: &#x27;Hola mundo&#x27;, (1) }\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/translation-cache.test.js:84:36)&quot;,&quot;diff&quot;:&quot; {\n-   \&quot;cachedAt\&quot;: 1751670767134\n   \&quot;confidence\&quot;: 0.95\n   \&quot;translation\&quot;: \&quot;Hola mundo\&quot;\n }\n&quot;},&quot;uuid&quot;:&quot;9daf6d8a-91f2-4b99-b612-47e74dd64ad7&quot;,&quot;parentUUID&quot;:&quot;164eb181-ac21-4b3e-a95e-9a1cea4c425a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should also store service-agnostic entries&quot;,&quot;fullTitle&quot;:&quot;TranslationCache set and get should also store service-agnostic entries&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const text = &#x27;Hello world&#x27;;\nconst fromLang = &#x27;en&#x27;;\nconst toLang = &#x27;es&#x27;;\nconst service = &#x27;deepl&#x27;;\nconst result = {\n    translation: &#x27;Hola mundo&#x27;,\n    confidence: 0.95\n};\nawait cache.set(text, fromLang, toLang, service, result);\n// Should be retrievable with &#x27;any&#x27; service\nconst cached = await cache.get(text, fromLang, toLang, &#x27;any&#x27;);\nexpect(cached).to.deep.equal(result);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected null to deeply equal { translation: &#x27;Hola mundo&#x27;, (1) }&quot;,&quot;estack&quot;:&quot;AssertionError: expected null to deeply equal { translation: &#x27;Hola mundo&#x27;, (1) }\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/translation-cache.test.js:101:36)&quot;},&quot;uuid&quot;:&quot;4225636d-06c6-4c8f-a8fa-6023b9e95477&quot;,&quot;parentUUID&quot;:&quot;164eb181-ac21-4b3e-a95e-9a1cea4c425a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return null for non-existent entries&quot;,&quot;fullTitle&quot;:&quot;TranslationCache set and get should return null for non-existent entries&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const cached = await cache.get(&#x27;Not in cache&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;);\nexpect(cached).to.be.null;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6b8595ef-12fc-450d-a474-0235cc5a1b05&quot;,&quot;parentUUID&quot;:&quot;164eb181-ac21-4b3e-a95e-9a1cea4c425a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should update stats when retrieving entries&quot;,&quot;fullTitle&quot;:&quot;TranslationCache set and get should update stats when retrieving entries&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// First access (miss)\nawait cache.get(&#x27;Not in cache&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;);\nexpect(cache.stats.totalRequests).to.equal(1);\nexpect(cache.stats.misses).to.equal(1);\nexpect(cache.stats.hits).to.equal(0);\n// Add to cache\nawait cache.set(&#x27;Hello&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;, { translation: &#x27;Hola&#x27; });\n// Second access (hit)\nawait cache.get(&#x27;Hello&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;);\nexpect(cache.stats.totalRequests).to.equal(2);\nexpect(cache.stats.misses).to.equal(1);\nexpect(cache.stats.hits).to.equal(1);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected undefined to equal 1&quot;,&quot;estack&quot;:&quot;AssertionError: expected undefined to equal 1\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/translation-cache.test.js:112:50)&quot;},&quot;uuid&quot;:&quot;47e5eabd-dfa9-4790-9e6d-f325e34d34f7&quot;,&quot;parentUUID&quot;:&quot;164eb181-ac21-4b3e-a95e-9a1cea4c425a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should respect expiry times&quot;,&quot;fullTitle&quot;:&quot;TranslationCache set and get should respect expiry times&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Set with a very short expiry (1ms)\nawait cache.set(&#x27;Hello&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;, { translation: &#x27;Hola&#x27; }, 0.001);\n// Wait for expiry\nawait new Promise(resolve =&gt; setTimeout(resolve, 10));\n// Should return null after expiry\nconst cached = await cache.get(&#x27;Hello&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;);\nexpect(cached).to.be.null;\nexpect(cache.stats.misses).to.equal(1);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected { translation: &#x27;Hola&#x27;, (1) } to be null&quot;,&quot;estack&quot;:&quot;AssertionError: expected { translation: &#x27;Hola&#x27;, (1) } to be null\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/translation-cache.test.js:135:33)&quot;},&quot;uuid&quot;:&quot;33158081-a12e-4ff2-84dd-b31cecd5a786&quot;,&quot;parentUUID&quot;:&quot;164eb181-ac21-4b3e-a95e-9a1cea4c425a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6b8595ef-12fc-450d-a474-0235cc5a1b05&quot;],&quot;failures&quot;:[&quot;9daf6d8a-91f2-4b99-b612-47e74dd64ad7&quot;,&quot;4225636d-06c6-4c8f-a8fa-6023b9e95477&quot;,&quot;47e5eabd-dfa9-4790-9e6d-f325e34d34f7&quot;,&quot;33158081-a12e-4ff2-84dd-b31cecd5a786&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:14,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;52038ac7-3d38-4614-82d1-8e1c11b848d1&quot;,&quot;title&quot;:&quot;pruneCache&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/utils/translation-cache.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/utils/translation-cache.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should remove expired entries&quot;,&quot;fullTitle&quot;:&quot;TranslationCache pruneCache should remove expired entries&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Add some entries with very short expiry\nawait cache.set(&#x27;Entry1&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;, { translation: &#x27;Test1&#x27; }, 0.001);\nawait cache.set(&#x27;Entry2&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;, { translation: &#x27;Test2&#x27; }, 0.001);\n// Wait for expiry\nawait new Promise(resolve =&gt; setTimeout(resolve, 10));\n// Prune cache\ncache.pruneCache();\n// Should be removed\nconst cached1 = await cache.get(&#x27;Entry1&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;);\nconst cached2 = await cache.get(&#x27;Entry2&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;);\nexpect(cached1).to.be.null;\nexpect(cached2).to.be.null;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: cache.pruneCache is not a function&quot;,&quot;estack&quot;:&quot;TypeError: cache.pruneCache is not a function\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/translation-cache.test.js:150:19)&quot;},&quot;uuid&quot;:&quot;bf3fe420-0f50-4f4a-a3d9-29ee33e248e8&quot;,&quot;parentUUID&quot;:&quot;52038ac7-3d38-4614-82d1-8e1c11b848d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should respect maxCacheSize&quot;,&quot;fullTitle&quot;:&quot;TranslationCache pruneCache should respect maxCacheSize&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Cache is configured with maxCacheSize of 10\n// Add 15 entries (exceeds maxCacheSize)\nfor (let i = 0; i &lt; 15; i++) {\n    await cache.set(`Entry${i}`, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;, { translation: `Test${i}` });\n}\n// Cache should prune automatically\nexpect(cache.cache.size).to.be.at.most(10);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected undefined to be a number or a date&quot;,&quot;estack&quot;:&quot;AssertionError: expected undefined to be a number or a date\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/translation-cache.test.js:168:47)&quot;},&quot;uuid&quot;:&quot;775743f9-45e1-4f18-891f-995dfb742f0c&quot;,&quot;parentUUID&quot;:&quot;52038ac7-3d38-4614-82d1-8e1c11b848d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;bf3fe420-0f50-4f4a-a3d9-29ee33e248e8&quot;,&quot;775743f9-45e1-4f18-891f-995dfb742f0c&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:13,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;c1da7030-2a09-4b1f-a769-4d53f520a60c&quot;,&quot;title&quot;:&quot;getStats&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/utils/translation-cache.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/utils/translation-cache.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return accurate statistics&quot;,&quot;fullTitle&quot;:&quot;TranslationCache getStats should return accurate statistics&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Add some cache hits and misses\nawait cache.get(&#x27;Miss1&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;);\nawait cache.get(&#x27;Miss2&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;);\nawait cache.set(&#x27;Hit1&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;, { translation: &#x27;Test1&#x27; });\nawait cache.get(&#x27;Hit1&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;);\nawait cache.set(&#x27;Hit2&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;, { translation: &#x27;Test2&#x27; });\nawait cache.get(&#x27;Hit2&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;);\nconst stats = cache.getStats();\nexpect(stats.hits).to.equal(2);\nexpect(stats.misses).to.equal(2);\nexpect(stats.totalRequests).to.equal(4);\nexpect(stats.size).to.be.greaterThan(0);\nexpect(stats.hitRate).to.equal(0.5); // 2 hits out of 4 requests&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected undefined to equal 4&quot;,&quot;estack&quot;:&quot;AssertionError: expected undefined to equal 4\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/translation-cache.test.js:188:44)&quot;},&quot;uuid&quot;:&quot;2d1fcf99-8836-419e-b508-3da3c1660929&quot;,&quot;parentUUID&quot;:&quot;c1da7030-2a09-4b1f-a769-4d53f520a60c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;2d1fcf99-8836-419e-b508-3da3c1660929&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;42d09e08-0f2f-4478-9085-b11ac24f48c8&quot;,&quot;title&quot;:&quot;clear&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/utils/translation-cache.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/utils/translation-cache.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should remove all entries&quot;,&quot;fullTitle&quot;:&quot;TranslationCache clear should remove all entries&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Add some entries\nawait cache.set(&#x27;Entry1&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;, { translation: &#x27;Test1&#x27; });\nawait cache.set(&#x27;Entry2&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;, { translation: &#x27;Test2&#x27; });\n// Verify they exist\nexpect(await cache.get(&#x27;Entry1&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;)).to.not.be.null;\nexpect(await cache.get(&#x27;Entry2&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;)).to.not.be.null;\n// Clear cache\nawait cache.clear();\n// Verify they&#x27;re gone\nexpect(await cache.get(&#x27;Entry1&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;)).to.be.null;\nexpect(await cache.get(&#x27;Entry2&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;)).to.be.null;\nexpect(cache.cache.size).to.equal(0);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: cache.clear is not a function&quot;,&quot;estack&quot;:&quot;TypeError: cache.clear is not a function\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/translation-cache.test.js:205:25)&quot;},&quot;uuid&quot;:&quot;0f5becbc-397c-43be-b147-36d8fc53a34f&quot;,&quot;parentUUID&quot;:&quot;42d09e08-0f2f-4478-9085-b11ac24f48c8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;0f5becbc-397c-43be-b147-36d8fc53a34f&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;8c9bfe47-0fcf-455f-9fa6-c6fba57dbcf8&quot;,&quot;title&quot;:&quot;edge cases&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/services/translation/utils/translation-cache.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/services/translation/utils/translation-cache.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should handle empty text&quot;,&quot;fullTitle&quot;:&quot;TranslationCache edge cases should handle empty text&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await cache.set(&#x27;&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;, { translation: &#x27;&#x27; });\nconst cached = await cache.get(&#x27;&#x27;, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;);\nexpect(cached).to.deep.equal({ translation: &#x27;&#x27; });&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected { translation: &#x27;&#x27;, (1) } to deeply equal { translation: &#x27;&#x27; }&quot;,&quot;estack&quot;:&quot;AssertionError: expected { translation: &#x27;&#x27;, (1) } to deeply equal { translation: &#x27;&#x27; }\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/translation-cache.test.js:218:36)&quot;,&quot;diff&quot;:&quot; {\n-   \&quot;cachedAt\&quot;: 1751670767167\n   \&quot;translation\&quot;: \&quot;\&quot;\n }\n&quot;},&quot;uuid&quot;:&quot;1bd6a62f-00e6-4562-9c8e-dc5f74e1419b&quot;,&quot;parentUUID&quot;:&quot;8c9bfe47-0fcf-455f-9fa6-c6fba57dbcf8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle special characters&quot;,&quot;fullTitle&quot;:&quot;TranslationCache edge cases should handle special characters&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const text = &#x27;Special: !@#$%^&amp;*()_+{}[]|\\\\:;\&quot;\\&#x27;&lt;&gt;,.?/&#x27;;\nconst result = { translation: &#x27;Translated special chars&#x27; };\nawait cache.set(text, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;, result);\nconst cached = await cache.get(text, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;);\nexpect(cached).to.deep.equal(result);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected { (2) } to deeply equal { Object (translation) }&quot;,&quot;estack&quot;:&quot;AssertionError: expected { (2) } to deeply equal { Object (translation) }\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/translation-cache.test.js:227:36)&quot;,&quot;diff&quot;:&quot; {\n-   \&quot;cachedAt\&quot;: 1751670767168\n   \&quot;translation\&quot;: \&quot;Translated special chars\&quot;\n }\n&quot;},&quot;uuid&quot;:&quot;423ce68d-bc7f-40fd-81cb-46c1ac6772e9&quot;,&quot;parentUUID&quot;:&quot;8c9bfe47-0fcf-455f-9fa6-c6fba57dbcf8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle very long text&quot;,&quot;fullTitle&quot;:&quot;TranslationCache edge cases should handle very long text&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Generate a long string\nconst longText = &#x27;A&#x27;.repeat(10000);\nconst result = { translation: &#x27;Long text translation&#x27; };\nawait cache.set(longText, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;, result);\nconst cached = await cache.get(longText, &#x27;en&#x27;, &#x27;es&#x27;, &#x27;deepl&#x27;);\nexpect(cached).to.deep.equal(result);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected { (2) } to deeply equal { Object (translation) }&quot;,&quot;estack&quot;:&quot;AssertionError: expected { (2) } to deeply equal { Object (translation) }\n    at Context.&lt;anonymous&gt; (tests/unit/services/translation/utils/translation-cache.test.js:237:36)&quot;,&quot;diff&quot;:&quot; {\n-   \&quot;cachedAt\&quot;: 1751670767171\n   \&quot;translation\&quot;: \&quot;Long text translation\&quot;\n }\n&quot;},&quot;uuid&quot;:&quot;c32766be-5c08-4b00-a782-4fd8d69ab9bd&quot;,&quot;parentUUID&quot;:&quot;8c9bfe47-0fcf-455f-9fa6-c6fba57dbcf8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;1bd6a62f-00e6-4562-9c8e-dc5f74e1419b&quot;,&quot;423ce68d-bc7f-40fd-81cb-46c1ac6772e9&quot;,&quot;c32766be-5c08-4b00-a782-4fd8d69ab9bd&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;f82de611-e7a3-463b-8498-5943546f82a1&quot;,&quot;title&quot;:&quot;formatTextForDisplay&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/utils/format-text.unit.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/utils/format-text.unit.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should trim whitespace from text&quot;,&quot;fullTitle&quot;:&quot;formatTextForDisplay should trim whitespace from text&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(formatTextForDisplay(&#x27;  hello  &#x27;)).to.equal(&#x27;hello&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6ef4ae2b-b5f2-45ab-8a93-f06386412f9f&quot;,&quot;parentUUID&quot;:&quot;f82de611-e7a3-463b-8498-5943546f82a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return empty string for non-string input&quot;,&quot;fullTitle&quot;:&quot;formatTextForDisplay should return empty string for non-string input&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(formatTextForDisplay(null)).to.equal(&#x27;&#x27;);\nexpect(formatTextForDisplay(undefined)).to.equal(&#x27;&#x27;);\nexpect(formatTextForDisplay(123)).to.equal(&#x27;&#x27;);\nexpect(formatTextForDisplay({})).to.equal(&#x27;&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e4d01eca-3411-4461-8698-a1e8b2e0ab18&quot;,&quot;parentUUID&quot;:&quot;f82de611-e7a3-463b-8498-5943546f82a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should truncate long text with ellipsis&quot;,&quot;fullTitle&quot;:&quot;formatTextForDisplay should truncate long text with ellipsis&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const longText = &#x27;a&#x27;.repeat(150);\nconst result = formatTextForDisplay(longText, 100);\nexpect(result).to.have.lengthOf(103); // 100 + &#x27;...&#x27;\nexpect(result).to.match(/\\.\\.\\.$/);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0d138614-091b-41d8-a615-5a91f41fe690&quot;,&quot;parentUUID&quot;:&quot;f82de611-e7a3-463b-8498-5943546f82a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not truncate text shorter than max length&quot;,&quot;fullTitle&quot;:&quot;formatTextForDisplay should not truncate text shorter than max length&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const text = &#x27;Hello, world!&#x27;;\nexpect(formatTextForDisplay(text, 50)).to.equal(text);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6b0cc0ba-242d-4821-898e-aced54f153db&quot;,&quot;parentUUID&quot;:&quot;f82de611-e7a3-463b-8498-5943546f82a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6ef4ae2b-b5f2-45ab-8a93-f06386412f9f&quot;,&quot;e4d01eca-3411-4461-8698-a1e8b2e0ab18&quot;,&quot;0d138614-091b-41d8-a615-5a91f41fe690&quot;,&quot;6b0cc0ba-242d-4821-898e-aced54f153db&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;69c9f546-f1ce-45e4-b1e9-fab7fad89cde&quot;,&quot;title&quot;:&quot;String Utils&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/utils/string-utils.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/utils/string-utils.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;511c3721-b17c-4a80-8d49-8137c8ee4848&quot;,&quot;title&quot;:&quot;capitalize&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/utils/string-utils.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/utils/string-utils.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should capitalize the first letter of a string&quot;,&quot;fullTitle&quot;:&quot;String Utils capitalize should capitalize the first letter of a string&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(capitalize(&#x27;hello&#x27;)).to.equal(&#x27;Hello&#x27;);\nexpect(capitalize(&#x27;world&#x27;)).to.equal(&#x27;World&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c0decac7-196d-4729-b64a-c4be04a1afb7&quot;,&quot;parentUUID&quot;:&quot;511c3721-b17c-4a80-8d49-8137c8ee4848&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle empty string&quot;,&quot;fullTitle&quot;:&quot;String Utils capitalize should handle empty string&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(capitalize(&#x27;&#x27;)).to.equal(&#x27;&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;137f0f09-ceb6-4559-81c7-2a8f847f8de4&quot;,&quot;parentUUID&quot;:&quot;511c3721-b17c-4a80-8d49-8137c8ee4848&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle non-string inputs&quot;,&quot;fullTitle&quot;:&quot;String Utils capitalize should handle non-string inputs&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(capitalize(null)).to.equal(&#x27;&#x27;);\nexpect(capitalize(undefined)).to.equal(&#x27;&#x27;);\nexpect(capitalize(123)).to.equal(&#x27;&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8a3f5b24-c0be-4d1f-971c-85ecc2123e84&quot;,&quot;parentUUID&quot;:&quot;511c3721-b17c-4a80-8d49-8137c8ee4848&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c0decac7-196d-4729-b64a-c4be04a1afb7&quot;,&quot;137f0f09-ceb6-4559-81c7-2a8f847f8de4&quot;,&quot;8a3f5b24-c0be-4d1f-971c-85ecc2123e84&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;ffa0f1da-58fb-4516-8132-824f133b3b1a&quot;,&quot;title&quot;:&quot;truncate&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/utils/string-utils.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/utils/string-utils.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should truncate strings longer than maxLength&quot;,&quot;fullTitle&quot;:&quot;String Utils truncate should truncate strings longer than maxLength&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(truncate(&#x27;Hello, world!&#x27;, 5)).to.equal(&#x27;Hello...&#x27;);\nexpect(truncate(&#x27;Testing&#x27;, 4, &#x27;***&#x27;)).to.equal(&#x27;Test***&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a18bf642-4241-4e6b-b3c8-67d1d713c902&quot;,&quot;parentUUID&quot;:&quot;ffa0f1da-58fb-4516-8132-824f133b3b1a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not truncate strings shorter than maxLength&quot;,&quot;fullTitle&quot;:&quot;String Utils truncate should not truncate strings shorter than maxLength&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(truncate(&#x27;Hi&#x27;, 5)).to.equal(&#x27;Hi&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8ab25442-797a-4d49-a522-f6c08a5b1b1a&quot;,&quot;parentUUID&quot;:&quot;ffa0f1da-58fb-4516-8132-824f133b3b1a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle custom ellipsis&quot;,&quot;fullTitle&quot;:&quot;String Utils truncate should handle custom ellipsis&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(truncate(&#x27;Hello&#x27;, 3, &#x27;...&#x27;)).to.equal(&#x27;Hel...&#x27;);\nexpect(truncate(&#x27;Hello&#x27;, 3, &#x27;&#x27;)).to.equal(&#x27;Hel&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8716e326-b209-40be-b5d3-1541ecdb8438&quot;,&quot;parentUUID&quot;:&quot;ffa0f1da-58fb-4516-8132-824f133b3b1a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a18bf642-4241-4e6b-b3c8-67d1d713c902&quot;,&quot;8ab25442-797a-4d49-a522-f6c08a5b1b1a&quot;,&quot;8716e326-b209-40be-b5d3-1541ecdb8438&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;394b7995-d025-418c-b0da-d25feeb78848&quot;,&quot;title&quot;:&quot;safeJsonParse&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/unit/utils/string-utils.test.js&quot;,&quot;file&quot;:&quot;/tests/unit/utils/string-utils.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should parse valid JSON strings&quot;,&quot;fullTitle&quot;:&quot;String Utils safeJsonParse should parse valid JSON strings&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(safeJsonParse(&#x27;{\&quot;key\&quot;: \&quot;value\&quot;}&#x27;)).to.deep.equal({ key: &#x27;value&#x27; });\nexpect(safeJsonParse(&#x27;[1, 2, 3]&#x27;)).to.deep.equal([1, 2, 3]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c573ac87-11a2-43ea-8cd4-be5b5edcea30&quot;,&quot;parentUUID&quot;:&quot;394b7995-d025-418c-b0da-d25feeb78848&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return default value for invalid JSON&quot;,&quot;fullTitle&quot;:&quot;String Utils safeJsonParse should return default value for invalid JSON&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(safeJsonParse(&#x27;not json&#x27;, { default: &#x27;value&#x27; }))\n  .to.deep.equal({ default: &#x27;value&#x27; });\nexpect(safeJsonParse(&#x27;&#x27;, &#x27;fallback&#x27;)).to.equal(&#x27;fallback&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2d85b330-c734-41d0-894a-645c14f90342&quot;,&quot;parentUUID&quot;:&quot;394b7995-d025-418c-b0da-d25feeb78848&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return empty object by default when parsing fails&quot;,&quot;fullTitle&quot;:&quot;String Utils safeJsonParse should return empty object by default when parsing fails&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(safeJsonParse(&#x27;invalid&#x27;)).to.deep.equal({});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;83f7c79d-acd9-47c0-9f3c-d82c7e51ada7&quot;,&quot;parentUUID&quot;:&quot;394b7995-d025-418c-b0da-d25feeb78848&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c573ac87-11a2-43ea-8cd4-be5b5edcea30&quot;,&quot;2d85b330-c734-41d0-894a-645c14f90342&quot;,&quot;83f7c79d-acd9-47c0-9f3c-d82c7e51ada7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;37cd220c-f7e6-4fad-a8c1-d558d8760572&quot;,&quot;title&quot;:&quot;Test Utilities&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/utils/test-utils.test.js&quot;,&quot;file&quot;:&quot;/tests/utils/test-utils.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;cc9973a4-26fc-4652-88d5-21cc1a5dc765&quot;,&quot;title&quot;:&quot;mockT&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/utils/test-utils.test.js&quot;,&quot;file&quot;:&quot;/tests/utils/test-utils.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return the key as the translation&quot;,&quot;fullTitle&quot;:&quot;Test Utilities mockT should return the key as the translation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(mockT(&#x27;test.key&#x27;)).to.equal(&#x27;test.key&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;db8cebc5-9b4d-45bb-8372-2fb4dcd75588&quot;,&quot;parentUUID&quot;:&quot;cc9973a4-26fc-4652-88d5-21cc1a5dc765&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;db8cebc5-9b4d-45bb-8372-2fb4dcd75588&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;170c7e73-f6f1-4a57-ad79-680bad6875fe&quot;,&quot;title&quot;:&quot;createMockAudioContext&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/utils/test-utils.test.js&quot;,&quot;file&quot;:&quot;/tests/utils/test-utils.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should create a mock AudioContext with expected methods&quot;,&quot;fullTitle&quot;:&quot;Test Utilities createMockAudioContext should create a mock AudioContext with expected methods&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const mock = createMockAudioContext();\n\nexpect(mock).to.have.property(&#x27;suspend&#x27;).that.is.a(&#x27;function&#x27;);\nexpect(mock).to.have.property(&#x27;resume&#x27;).that.is.a(&#x27;function&#x27;);\nexpect(mock).to.have.property(&#x27;close&#x27;).that.is.a(&#x27;function&#x27;);\nexpect(mock).to.have.property(&#x27;destination&#x27;);\nexpect(mock).to.have.property(&#x27;createMediaStreamSource&#x27;).that.is.a(&#x27;function&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;767e2dc5-520c-477b-a8e5-b59a124bc7fe&quot;,&quot;parentUUID&quot;:&quot;170c7e73-f6f1-4a57-ad79-680bad6875fe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow calling mocked methods&quot;,&quot;fullTitle&quot;:&quot;Test Utilities createMockAudioContext should allow calling mocked methods&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const mock = createMockAudioContext();\nawait mock.suspend();\n\nexpect(mock.suspend).to.have.been.calledOnce;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4a23a2cb-3274-4c40-961f-f3034b2f342a&quot;,&quot;parentUUID&quot;:&quot;170c7e73-f6f1-4a57-ad79-680bad6875fe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;767e2dc5-520c-477b-a8e5-b59a124bc7fe&quot;,&quot;4a23a2cb-3274-4c40-961f-f3034b2f342a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;b29607bb-f7e4-4837-b8f0-1a5281b4aa58&quot;,&quot;title&quot;:&quot;createMockMediaStream&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/utils/test-utils.test.js&quot;,&quot;file&quot;:&quot;/tests/utils/test-utils.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should create a mock MediaStream with expected methods&quot;,&quot;fullTitle&quot;:&quot;Test Utilities createMockMediaStream should create a mock MediaStream with expected methods&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const mock = createMockMediaStream();\n\nexpect(mock).to.have.property(&#x27;getTracks&#x27;).that.is.a(&#x27;function&#x27;);\nexpect(mock).to.have.property(&#x27;getAudioTracks&#x27;).that.is.a(&#x27;function&#x27;);\nexpect(mock).to.have.property(&#x27;getVideoTracks&#x27;).that.is.a(&#x27;function&#x27;);\nexpect(mock).to.have.property(&#x27;addTrack&#x27;).that.is.a(&#x27;function&#x27;);\nexpect(mock).to.have.property(&#x27;removeTrack&#x27;).that.is.a(&#x27;function&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4ce215ea-54f2-48cf-a74f-b93b47114aa4&quot;,&quot;parentUUID&quot;:&quot;b29607bb-f7e4-4837-b8f0-1a5281b4aa58&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4ce215ea-54f2-48cf-a74f-b93b47114aa4&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;ef877137-82a9-4b9d-8e24-3f70f511435a&quot;,&quot;title&quot;:&quot;MockResizeObserver&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/utils/test-utils.test.js&quot;,&quot;file&quot;:&quot;/tests/utils/test-utils.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should create a mock ResizeObserver with expected methods&quot;,&quot;fullTitle&quot;:&quot;Test Utilities MockResizeObserver should create a mock ResizeObserver with expected methods&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const callback = () =&gt; {};\nconst observer = new MockResizeObserver(callback);\n\nexpect(observer).to.have.property(&#x27;observe&#x27;).that.is.a(&#x27;function&#x27;);\nexpect(observer).to.have.property(&#x27;unobserve&#x27;).that.is.a(&#x27;function&#x27;);\nexpect(observer).to.have.property(&#x27;disconnect&#x27;).that.is.a(&#x27;function&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;44c59916-efcc-4e68-8ea8-c993ccdbe17e&quot;,&quot;parentUUID&quot;:&quot;ef877137-82a9-4b9d-8e24-3f70f511435a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;44c59916-efcc-4e68-8ea8-c993ccdbe17e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;f42d8b19-dfe4-40e9-bd8a-7cff50d0fde2&quot;,&quot;title&quot;:&quot;createComponentMock&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/utils/test-utils.test.js&quot;,&quot;file&quot;:&quot;/tests/utils/test-utils.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should create a mock React component&quot;,&quot;fullTitle&quot;:&quot;Test Utilities createComponentMock should create a mock React component&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const MockComponent = createComponentMock(&#x27;TestComponent&#x27;);\nconst element = MockComponent.TestComponent({ children: &#x27;test&#x27; });\n\nexpect(element.type).to.equal(&#x27;TestComponent&#x27;);\nexpect(element.props.children).to.equal(&#x27;test&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5ae688e6-2994-4513-a156-75413d2b6af2&quot;,&quot;parentUUID&quot;:&quot;f42d8b19-dfe4-40e9-bd8a-7cff50d0fde2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5ae688e6-2994-4513-a156-75413d2b6af2&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;e60cc876-d59c-4cf7-adad-63e8f5ac9249&quot;,&quot;title&quot;:&quot;createControllablePromise&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/utils/test-utils.test.js&quot;,&quot;file&quot;:&quot;/tests/utils/test-utils.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should create a promise with resolve and reject controls&quot;,&quot;fullTitle&quot;:&quot;Test Utilities createControllablePromise should create a promise with resolve and reject controls&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:102,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const { promise, resolve } = createControllablePromise();\nconst testValue = &#x27;test value&#x27;;\n\nsetTimeout(() =&gt; resolve(testValue), 100);\n\nconst result = await promise;\nexpect(result).to.equal(testValue);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3dc9044c-c682-40da-8006-938cb90f369a&quot;,&quot;parentUUID&quot;:&quot;e60cc876-d59c-4cf7-adad-63e8f5ac9249&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3dc9044c-c682-40da-8006-938cb90f369a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:102,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;663889b2-eb3c-4e08-9235-5f2308fc1f28&quot;,&quot;title&quot;:&quot;waitFor&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/utils/test-utils.test.js&quot;,&quot;file&quot;:&quot;/tests/utils/test-utils.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should wait for a condition to be true&quot;,&quot;fullTitle&quot;:&quot;Test Utilities waitFor should wait for a condition to be true&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:51,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let value = false;\nsetTimeout(() =&gt; { value = true; }, 50);\n\nawait waitFor(() =&gt; value === true, 200);\nexpect(value).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2857f45e-8b9c-4cef-941d-d98c26e3db45&quot;,&quot;parentUUID&quot;:&quot;663889b2-eb3c-4e08-9235-5f2308fc1f28&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should timeout if condition is not met&quot;,&quot;fullTitle&quot;:&quot;Test Utilities waitFor should timeout if condition is not met&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:52,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;try {\n  await waitFor(() =&gt; false, 50);\n  throw new Error(&#x27;Should have timed out&#x27;);\n} catch (error) {\n  expect(error.message).to.include(&#x27;Timeout&#x27;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f7aa9305-8ab6-457f-83e5-e7d848ccec68&quot;,&quot;parentUUID&quot;:&quot;663889b2-eb3c-4e08-9235-5f2308fc1f28&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2857f45e-8b9c-4cef-941d-d98c26e3db45&quot;,&quot;f7aa9305-8ab6-457f-83e5-e7d848ccec68&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:103,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;b12f0966-1f9c-4100-b541-16c768c38a47&quot;,&quot;title&quot;:&quot;useFakeTimers&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/utils/test-utils.test.js&quot;,&quot;file&quot;:&quot;/tests/utils/test-utils.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should mock timers&quot;,&quot;fullTitle&quot;:&quot;Test Utilities useFakeTimers should mock timers&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const clock = useFakeTimers();\nconst callback = sinon.stub();\n\nsetTimeout(callback, 1000);\nclock.tick(1000);\n\nexpect(callback).to.have.been.calledOnce;\nclock.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;641e7659-9bda-4f20-b421-440c7ce7f7f3&quot;,&quot;parentUUID&quot;:&quot;b12f0966-1f9c-4100-b541-16c768c38a47&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;641e7659-9bda-4f20-b421-440c7ce7f7f3&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000},{&quot;uuid&quot;:&quot;2d819fed-e355-4cf8-b9cd-f9ac2be8c41f&quot;,&quot;title&quot;:&quot;mockFetch&quot;,&quot;fullFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/tests/utils/test-utils.test.js&quot;,&quot;file&quot;:&quot;/tests/utils/test-utils.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;mockFetch\&quot;&quot;,&quot;fullTitle&quot;:&quot;Test Utilities mockFetch \&quot;after each\&quot; hook in \&quot;mockFetch\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (global.fetch &amp;&amp; global.fetch.restore) {\n  global.fetch.restore();\n} else {\n  delete global.fetch;\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4cfd8d25-3048-4fb9-9e52-70b9a4bfac84&quot;,&quot;parentUUID&quot;:&quot;2d819fed-e355-4cf8-b9cd-f9ac2be8c41f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should mock fetch with a successful response&quot;,&quot;fullTitle&quot;:&quot;Test Utilities mockFetch should mock fetch with a successful response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const testData = { id: 1, name: &#x27;Test&#x27; };\nconst mock = mockFetch(testData);\n\nconst response = await fetch(&#x27;https://api.example.com/test&#x27;);\nconst data = await response.json();\n\nexpect(mock).to.have.been.calledWith(&#x27;https://api.example.com/test&#x27;);\nexpect(response.ok).to.be.true;\nexpect(data).to.deep.equal(testData);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;932f4fc8-3003-45bf-bc89-0b56b08d4e46&quot;,&quot;parentUUID&quot;:&quot;2d819fed-e355-4cf8-b9cd-f9ac2be8c41f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should mock fetch with an error response&quot;,&quot;fullTitle&quot;:&quot;Test Utilities mockFetch should mock fetch with an error response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const mock = mockFetch(null, { status: 404, ok: false, statusText: &#x27;Not Found&#x27; });\n\nconst response = await fetch(&#x27;https://api.example.com/not-found&#x27;);\n\nexpect(mock).to.have.been.calledWith(&#x27;https://api.example.com/not-found&#x27;);\nexpect(response.ok).to.be.false;\nexpect(response.status).to.equal(404);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7edf2cce-c547-4f38-a52e-8c66b3f9e03b&quot;,&quot;parentUUID&quot;:&quot;2d819fed-e355-4cf8-b9cd-f9ac2be8c41f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;932f4fc8-3003-45bf-bc89-0b56b08d4e46&quot;,&quot;7edf2cce-c547-4f38-a52e-8c66b3f9e03b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:5000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:5000}],&quot;meta&quot;:{&quot;mocha&quot;:{&quot;version&quot;:&quot;10.8.2&quot;},&quot;mochawesome&quot;:{&quot;options&quot;:{&quot;quiet&quot;:false,&quot;reportFilename&quot;:&quot;mochawesome&quot;,&quot;saveHtml&quot;:true,&quot;saveJson&quot;:true,&quot;consoleReporter&quot;:&quot;spec&quot;,&quot;useInlineDiffs&quot;:false,&quot;code&quot;:true},&quot;version&quot;:&quot;7.1.3&quot;},&quot;marge&quot;:{&quot;version&quot;:&quot;6.2.0&quot;}}}" data-config="{&quot;reportFilename&quot;:&quot;mochawesome&quot;,&quot;reportDir&quot;:&quot;mochawesome-report&quot;,&quot;reportTitle&quot;:&quot;translation-app&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:false,&quot;enableCharts&quot;:false,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:true,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;mochawesome-report/assets&quot;,&quot;jsonFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/mochawesome-report/mochawesome.json&quot;,&quot;htmlFile&quot;:&quot;/Volumes/Project Disk/Multi-Platform-Translation-APP/translation-app/mochawesome-report/mochawesome.html&quot;}"><div id="report"></div><script src="assets/app.js"></script></body></html>